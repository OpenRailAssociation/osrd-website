<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=fr class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.100.2"><link rel=canonical type=text/html href=https://osrd.fr/fr/docs/explanation/><link rel=alternate type=application/rss+xml href=https://osrd.fr/fr/docs/explanation/index.xml><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Explications | OSRD</title><meta name=description content="Comprendre les concepts clés"><meta property="og:title" content="Explications"><meta property="og:description" content="Comprendre les concepts clés"><meta property="og:type" content="website"><meta property="og:url" content="https://osrd.fr/fr/docs/explanation/"><meta property="og:site_name" content="OSRD"><meta itemprop=name content="Explications"><meta itemprop=description content="Comprendre les concepts clés"><meta name=twitter:card content="summary"><meta name=twitter:title content="Explications"><meta name=twitter:description content="Comprendre les concepts clés"><link rel=preload href=/scss/main.min.93971a67efb8fbbfd5657ceacd027bfba27edd5178d67b10976b4d54420505b7.css as=style><link href=/scss/main.min.93971a67efb8fbbfd5657ceacd027bfba27edd5178d67b10976b4d54420505b7.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.6.0.min.js integrity=sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK crossorigin=anonymous></script>
<script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script></head><body class=td-section><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/fr/><span class=navbar-logo><svg xmlns="http://www.w3.org/2000/svg" id="svg36" width="110.767" height="22"><style id="style1">.st9{fill:#fff}</style><g id="ok" transform="scale(.1918)"><g id="g36"><g id="g29"><path id="path23" d="M38.5 83.4c-1.9 8.2-2.9 17-2.9 26.5v4.8h16.6c-2.8-13.2-7.8-23.4-13.7-31.3z" class="st9"/><path id="path24" d="M0 57.5v19.9c3.1 1.2 6.3 2.7 9.5 4.6 8.5 5.2 15 12.6 19.4 21.8v-31c-3.4-3-6.9-5.5-10.3-7.5-6.5-3.7-13-6.2-18.6-7.8z" class="st9"/><path id="path25" d="M35.6 69.9c4.3-11.3 10.6-21.1 18.9-29.4V0H35.6z" class="st9"/><path id="path26" d="M40.8 75.4c5.3 6.2 10.1 13.8 13.7 23.3V50.6C48.6 57.8 44 66.1 40.8 75.4z" class="st9"/><path id="path27" d="M100.7.0H61.3v34.5C73.1 25.2 86 20 96.9 17.2c1.8-.5 3.7.6 4.1 2.4.5 1.8-.6 3.6-2.4 4.1-11.4 2.9-25.3 8.6-37.2 19.7v31.8c2.9-6.3 6.7-11.7 11.4-16.4 9.4-9.3 21-14.1 30.5-16.6 1.8-.5 3.7.6 4.1 2.4.5 1.8-.6 3.6-2.4 4.1-4.7 1.2-10.1 3.1-15.3 6-19 10.3-28.2 28.4-28.2 55.2v4.8h39.3c7.8.0 14.1-6.3 14.1-14.1V14.1C114.7 6.3 108.4.0 100.7.0z" class="st9"/><path id="path28" d="M22 59.6c2.2 1.3 4.5 2.8 6.8 4.6V0H14.1C6.3.0.0 6.3.0 14.1v36.4c6.5 1.7 14.2 4.5 22 9.1z" class="st9"/><path id="path29" d="M5.4 87.5c-1.8-1.1-3.6-2-5.4-2.8v15.9c0 7.8 6.3 14.1 14.1 14.1h11.6c-3.6-12.2-10.4-21.3-20.3-27.2z" class="st9"/></g><g id="g30"><path id="path30" d="M201.7 109c-30.8.0-53.7-21.2-53.7-52.5.0-31.7 22.9-51.6 53.7-51.6 31 0 53.9 20 53.9 51.6-.1 31.3-23 52.5-53.9 52.5zm0-82.6c-16.7.0-28.2 12.8-28.2 30.1.0 17.9 11.6 30.7 28.2 30.7S230 74.4 230 56.6c0-17.3-11.6-30.2-28.3-30.2z" class="st9"/></g><g id="g32"><g id="g31"><path id="path31" d="M334.3 33.3c-4-5.2-11.4-8.5-17.6-8.5-6.2.0-13.8 2.1-13.8 9.9.0 6.6 5.9 8.7 15.2 11.6 13.4 4.3 30.7 10 30.7 29.7.0 22.7-18.3 32.9-37.8 32.9-14.1.0-28.3-5.2-37-14.2l15.6-15.9c4.7 6 13.5 10.5 21.3 10.5 7.3.0 13.7-2.8 13.7-10.7.0-7.5-7.5-9.9-20.5-14.1C291.6 60.3 279 53.9 279 36c0-21.9 19.8-31 38.2-31 11.2.0 23.7 4.2 32.4 12.1z" class="st9"/></g></g><g id="g34"><g id="g33"><path id="path32" d="m433.1 106.4-21.3-39.2h-8.1v39.2h-23.4V7.6H418c19 0 37.8 7.3 37.8 29.9.0 13.3-7.8 22.7-20.5 26.6l25.8 42.3zm-16.9-79.6h-12.7v23h11.3c7.7.0 17.3-2 17.3-12 0-9.2-8.7-11-15.9-11z" class="st9"/></g></g><g id="g35"><path id="path34" d="M522.2 106.4h-36.8V7.6H521c28 0 56.5 11.7 56.5 49.1.0 34.7-28.1 49.7-55.3 49.7zm-1.7-78.5h-11.9v57.8h11.3c17 0 32.8-7 32.8-29 0-22.2-15.8-28.8-32.2-28.8z" class="st9"/></g></g></g></svg></span><span class=font-weight-bold>OSRD</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/fr/about/><span>À propos</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class="nav-link active" href=/fr/docs/><span class=active>Documentation</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/fr/blog/><span>Blog</span></a></li><li class="nav-item dropdown mr-4 d-none d-lg-block"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>Français</a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/en/docs/explanation/>English</a></div></li></ul></div><div class="navbar-nav d-none d-lg-block"><input type=search class="form-control td-search-input" placeholder="&#xf002; Rechercher" aria-label=Rechercher autocomplete=off data-offline-search-index-json-src=/offline-search-index.3293b2639455fd13ffe6328a043d605d.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>Version imprimable multipages.
<a href=# onclick="return print(),!1">Cliquer ici pour imprimer</a>.</p><p><a href=/fr/docs/explanation/>Retour à la version par défaut</a>.</p></div><h1 class=title>Explications</h1><div class=lead>Comprendre les concepts clés</div><ul><li>1: <a href=#pg-1132ba5b43b2c68ba6b280525e58332e>Architecture des conteneurs</a></li><ul></ul><li>2: <a href=#pg-6a2d7ccacb0d6eb6f7e023be74630b6f>Modèles</a></li><ul><li>2.1: <a href=#pg-145314c0096b4062ee5195e1810ed8e0>Exemple d'infrastructure</a></li><li>2.2: <a href=#pg-f84103db6bad730c45fbfe4dc325576a>Zones neutres</a></li></ul><li>3: <a href=#pg-1fb257de0b4d19a8a1b31c950ac27f16>Calcul de marche</a></li><ul><li>3.1: <a href=#pg-61cab231921ddee36c8a138e2a6605b8>Modélisation physique</a></li><li>3.2: <a href=#pg-e1f75b5e8521a11c3f55859a7e224607>Intégration numérique</a></li><li>3.3: <a href=#pg-8adca5807826313222b06ebdda200d27>Le système d'enveloppes</a></li><li>3.4: <a href=#pg-396e33d6479b448e3938369013852b4a>Le processus de calcul de marche</a></li><li>3.5: <a href=#pg-aa03910eecb13f5d3e9053a632348bc2>Les marges</a></li></ul></ul><div class=content><p>Les explications abordent des thèmes et concepts clés d’un point de vue général et fournissent des informations et explications détaillées sur les éléments fondamentaux.</p></div></div><div class=td-content><h1 id=pg-1132ba5b43b2c68ba6b280525e58332e>1 - Architecture des conteneurs</h1><div class=lead>Comment les conteneurs fonctionnent ensemble et comment ils sont construits</div><p>Il y a 3 principaux conteneurs déployés dans une configuration OSRD standard :</p><ul><li><strong>Gateway</strong> <em>(inclut le frontend)</em> : Sert le front-end, gère l&rsquo;authentification et proxy les requêtes vers le backend.</li><li><strong>Editoast</strong> : Agit comme le backend qui interagit avec le front-end.</li><li><strong>Core</strong> : Gère les calculs et la logique métier, appelé par Editoast.</li></ul><h2 id=déploiement-standard>Déploiement standard</h2><p>Le déploiement standard peut être représenté par le diagramme suivant.</p><pre tabindex=0><code class=language-mermaid data-lang=mermaid>flowchart TD
    gw[&#34;gateway&#34;]
    front[&#34;fichiers statiques front-end&#34;]
    gw -- fichier local --&gt; front
    
    navigateur --&gt; gw
    gw -- HTTP --&gt; editoast
    editoast -- HTTP --&gt; core
</code></pre><p>Les requêtes externes sont reçues par le gateway. Si le chemin demandé commence par <code>/api</code>, il sera transféré en utilisant HTTP vers editoast, sinon il servira un fichier avec le chemin demandé. Editoast atteint le core en utilisant HTTP si nécessaire.</p><p>Le gateway n&rsquo;est pas seulement un proxy inverse avec le bundle front-end inclus, il fournit également tous les mécanismes d&rsquo;authentification : utilisant OIDC ou des tokens.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-6a2d7ccacb0d6eb6f7e023be74630b6f>2 - Modèles</h1><div class=lead>Ce qui est modélisé dans OSRD, et comment c&rsquo;est modélisé</div></div><div class=td-content><h1 id=pg-145314c0096b4062ee5195e1810ed8e0>2.1 - Exemple d'infrastructure</h1><div class=lead>Explique par l&rsquo;exemple comment les données d&rsquo;infrastructure sont structurées</div><font color=#aa026d><h3 id=introduction>Introduction</h3></font><p>Cette page donne un exemple de la manière dont les formats de données sont utilisés pour décrire une infrastructure dans <strong>OSRD</strong>.</p><p>À cette fin, prenons comme exemple l&rsquo;infrastructure-jouet suivante :</p><p><img src=svg_diagrams/small_infra_diagram.drawio.svg alt="Diagramme de l&amp;rsquo;Infrastructure"></p><div class="alert alert-info" role=alert><h4 class=alert-heading>Conseil</h4>Pour zoomer sur un diagramme, cliquez sur le bouton d&rsquo;édition qui apparaît au survol de celui-ci.</div><p>Ce diagramme est un aperçu de l&rsquo;infrastructure avec les lignes et les stations uniquement.</p><p>Cette infrastructure ne se veut pas réaliste, mais plutôt destinée à illustrer le modèle de données d&rsquo;OSRD.
Cet exemple sera créé étape par étape et expliqué en cours de route.</p><h4 id=le-générateur-dinfrastructures>Le générateur d&rsquo;infrastructures</h4><p>Dans le <a href=https://github.com/osrd-project/osrd>dépôt <em>OSRD</em></a> se trouve une <a href=https://github.com/osrd-project/osrd/tree/dev/python/railjson_generator>bibliothèque python</a> conçue pour aider à générer des infrastructures dans un format compris par <em>OSRD</em>.</p><p>L&rsquo;infrastructure discutée dans cette section peut être générée grâce au fichier <a href=https://github.com/osrd-project/osrd/blob/dev/python/railjson_generator/railjson_generator/scripts/examples/small_infra.py>small_infra.py</a>. Pour en savoir plus sur les scripts de génération, vous pouvez consulter le <a href=https://github.com/osrd-project/osrd/blob/dev/python/railjson_generator/README.md>README</a> correspondant.</p><font color=#aa026d><h3 id=voies>Voies</h3></font><h4 id=sections-de-voie-track-sections>Sections de voie (Track Sections)</h4><p>Les premiers objets que nous devons définir sont les <code>TrackSections</code>. La plupart des autres objets sont positionnés par rapport à celles-ci.</p><p>Une section de voie est une section de rail (sans aiguillages). On peut choisir de diviser les voies de son infrastructure en autant de sections qu&rsquo;on le souhaite. Ici, nous avons choisi d&rsquo;utiliser les sections de voie les plus longues possibles, ce qui signifie qu&rsquo;entre deux aiguillages, il y a toujours une seule section de voie.</p><p>Les sections de voie sont ce sur quoi les trains simulés roulent. Ils sont l&rsquo;équivalent abstrait des sections de rails physiques. Les sections de voie sont bidirectionnelles.</p><p>Dans cet exemple, nous définissons deux voies pour la ligne entre les stations Ouest et Nord-Est. Nous avons également des voies de contournement aux stations Nord et Centre-Ouest pour plus de réalisme. Enfin, nous avons trois voies distinctes dans la station Ouest, puisqu&rsquo;il s&rsquo;agit d&rsquo;une plaque tournante majeure dans notre infrastructure imaginaire.</p><p><img src=svg_diagrams/small_infra_rails.drawio.en.svg alt="Diagramme des sections de voies"></p><div class="alert alert-warning" role=alert><h4 class=alert-heading>Important</h4><p>Les <code>TrackSections</code> sont représentées par des flèches dans ce diagramme pour souligner le fait qu&rsquo;elles ont un <strong>début</strong> et une <strong>fin</strong>. C&rsquo;est important car les objets positionnés sur les sections de voie sont localisés en fonction de leur distance par rapport au <strong>début</strong> de leur section de voie.</p><p>Par conséquent, pour placer un objet au début de sa section de voie, définissez sa position à 0. Pour le déplacer à la fin de sa section de voie, définissez sa position à la <code>length</code> de la section de voie.</p></div><p>Ces attributs sont nécessaires pour que la section de voie soit complète :</p><ul><li><code>length</code> : la longueur de la section de voie en mètres.</li><li><code>geo</code> : les coordonnées dans la réalité (geo pour géographique), au format <a href=https://en.wikipedia.org/wiki/GeoJSON>GeoJSON</a>.</li><li><code>sch</code> : les coordonnées dans la vue schématique (sch pour schématique, représentation simplifiée), également au format <a href=https://en.wikipedia.org/wiki/GeoJSON>GeoJSON</a>.</li><li>attributs cosmétiques : <code>line_name</code>, <code>track_name</code>, <code>track_number</code> qui sont utilisés pour indiquer le nom et les étiquettes qui ont été donnés aux voies / lignes dans la réalité.</li></ul><p>Pour toutes les sections de voies de notre infrastructure, les attributs <code>geo</code> et <code>sch</code> sont identiques, et se rapprochent beaucoup au schéma donné.</p><p>Pour la plupart des sections de voies, leur <code>length</code> est proportionnelle à ce que l&rsquo;on peut voir sur le diagramme. Pour préserver la lisibilité, des exceptions ont été faites pour <em>TA6</em>, <em>TA7</em>, <em>TD0</em> et <em>TD1</em> (qui font 10km et 25km).</p><h4 id=noeud>Noeud</h4><p>Un <code>Node</code> représente un noeud dans l&rsquo;infrastructure. Dans une simulation OSRD, un train ne peut passer d&rsquo;une section de voie à une autre que si elles sont reliées par un noeud.
Un noeud peut se présenter de deux manières différentes :</p><p><strong>1) Aiguillages</strong></p><p>Les aiguillages peuvent être vus comme une collection de liens de sections de voies, partitionnés en groupes. Chaque groupe représente un état de l&rsquo;aiguillage. Passer d&rsquo;un groupe à un autre peut prendre du temps, et au maximum un lien peut être prêt à être utilisé à la fois.</p><p>Dans le monde réel, les aiguillages ne sont pas uniques, mais plutôt des instances de modèles existants.</p><p><strong>2) Liens de sections de voies</strong></p><p>Pour le moment, nous n&rsquo;avons créé que des sections de voies, qui ne sont pas interconnectées (les données géospatiales ne sont pas utilisées pour déduire quelles voies sont connectées).</p><p>Les <code>link</code> sont utilisés pour connecter deux sections de voie ensemble, tout comme un joint de soudure le ferait dans la vie réelle. Dans une simulation OSRD, un train ne peut passer d&rsquo;une section de voie à une autre que si elles sont reliées par ce type de noeud, le <code>link</code> (ou par un autre <code>NodeType</code>).</p><p>Que ce soit pour les aiguillages ou les liens de sections de voies, les liens et les groupes ne font pas partie du switch lui-même, mais d&rsquo;un objet <code>NodeType</code>, qui est partagé par les aiguillages du même modèle.</p><h6 id=types-de-noeud>Types de Noeud</h6><p>Les <code>NodeTypes</code> ont deux attributs obligatoires :</p><ul><li><code>ports</code> : Une liste de noms de ports. Un port est une extrémité du noeud qui peut être connecté à une section de voie.</li><li><code>groups</code> : Un table de correspondance entre le nom des groupes et les listes de branches (connexion entre 2 ports) qui caractérisent les différentes positions possibles du type de Noeud</li></ul><p>À tout moment, tous les noeuds <em>ont</em> un groupe actif, et <em>peuvent avoir</em> une branche active, qui appartient toujours au groupe actif. Pendant une simulation, le changement de branche active à l&rsquo;intérieur d&rsquo;un groupe est instantané, mais le changement de branche active entre les groupes prend un temps configurable.
Ceci est dû au fait qu&rsquo;un <code>Noeud</code> peut-être un objet physique (dans le cas des aiguillages), et que le changement de branche active peut impliquer le déplacement de certaines de ses parties. Les <code>groups</code> sont conçus pour représenter les différentes positions qu&rsquo;un <code>Noeud</code> peut avoir. Chaque groupe contient les liens qui peuvent être utilisés dans la position du <code>Noeud</code> associé.</p><p>Dans le cas des aiguilles, la durée nécessaire pour changer de groupe est stockée à l&rsquo;intérieur du <code>Noeud</code>, car elle peut varier en fonction de l&rsquo;implémentation physique du modèle d&rsquo;aiguillage.</p><p>Nos exemples utilisent actuellement cinq <code>NodeTypes</code>. Il est possible d&rsquo;ajouter un type de noeud si nécessaire via le champ <code>extended_node_type</code>.</p><p><strong>1) Le lien entre deux sectionx de voies</strong></p><p>Celui-ci représente le lien entre deux sections de voies. Il possède deux ports : <em>A</em> et <em>B</em>.</p><p><img src=svg_diagrams/link.svg alt="Diagramme d&amp;rsquo;un lien"></p><p>Il permet de créer un lien entre deux sections de voies tel que définis dans OSRD. Ce n&rsquo;est pas un objet physique.</p><p><strong>2) L&rsquo;aiguille</strong></p><p>L&rsquo;omniprésent aiguillage en Y, qui peut être considéré comme la fusion de deux voies ou la séparation d&rsquo;une voie.</p><p>Ce type d&rsquo;aiguillage possède trois ports : <em>A</em>, <em>B1</em> et <em>B2</em>.</p><p><img src=svg_diagrams/point_switch.svg alt="Diagramme d&amp;rsquo;aiguillage"></p><p>Il y a deux groupes, chacun avec une connexion dans leur liste : <code>A_B1</code>, qui connecte <em>A</em> à <em>B1</em>, et <code>A_B2</code> qui connecte <em>A</em> à <em>B2</em>.</p><p>Ainsi, à tout moment (sauf lorsque l&rsquo;aiguille bouge pour changer de groupe), un train peut aller de <em>A</em> à <em>B1</em> ou de <em>A</em> à <em>B2</em> mais jamais aux deux en même temps. Un train ne peut pas aller de <em>B1</em> à <em>B2</em>.</p><p>Une aiguille n&rsquo;a que deux positions :</p><ul><li><em>A</em> vers <em>B1</em></li><li><em>A</em> vers <em>B2</em></li></ul><p><img src=svg_diagrams/PointSwitch_AtoB1.svg alt="Diagramme des positions de l&amp;rsquo;aiguillage"> <img src=svg_diagrams/PointSwitch_AtoB2.svg alt="Diagramme des positions de l&amp;rsquo;aiguillage"></p><p><strong>3) L&rsquo;aiguillage de croisement</strong></p><p>Il s&rsquo;agit simplement de deux voies qui se croisent.</p><p>Ce type a quatre ports : <em>A1</em>, <em>B1</em>, <em>A2</em> et <em>B2</em>.</p><p><img src=svg_diagrams/crossing.svg alt="Diagramme de l&amp;rsquo;aiguillage croisé"></p><p>Il ne comporte qu&rsquo;un seul groupe contenant deux connexions : <em>A1</em> vers <em>B1</em> et <em>A2</em> vers <em>B2</em>. En effet, ce type d&rsquo;aiguillage est <em>passif</em> : il n&rsquo;a pas de pièces mobiles. Bien qu&rsquo;il n&rsquo;ait qu&rsquo;un seul groupe, il est tout de même utilisé par la simulation pour faire respecter les réservations de route.</p><p>Voici les deux connexions différentes que ce type d&rsquo;aiguillage possède :</p><ul><li><em>A1</em> vers <em>B1</em></li><li><em>A2</em> vers <em>B2</em></li></ul><p><img src=svg_diagrams/Crossing_A1toB1.svg alt="Diagramme des positions des aiguillages croisés"> <img src=svg_diagrams/Crossing_A2toB2.svg alt="Diagramme des positions des aiguillages croisés"></p><p><strong>4) L&rsquo;aiguillage de croisement double</strong></p><p>Celui-ci ressemble plus à deux aiguilles dos à dos. Il possède quatre ports : <em>A1</em>, <em>A2</em>, <em>B1</em> et <em>B2</em>.</p><p><img src=svg_diagrams/double_slip_crossing.svg alt="Diagramme d&amp;rsquo;un aiguillage de croisement double"></p><p>Cependant, il comporte quatre groupes, chacun avec une connexion. Les quatre connexions possibles sont les suivantes :</p><ul><li><em>A1</em> vers <em>B1</em></li><li><em>A1</em> vers <em>B2</em></li><li><em>A2</em> vers <em>B1</em></li><li><em>A2</em> vers <em>B2</em></li></ul><p><img src=svg_diagrams/DoubleSlipCrossing_A1toB1.svg alt="Diagramme des positions de l&amp;rsquo;aiguillage de croisement double"> <img src=svg_diagrams/DoubleSlipCrossing_A1toB2.svg alt="Diagramme des positions de l&amp;rsquo;aiguillage de croisement double"></p><p><img src=svg_diagrams/DoubleSlipCrossing_A2toB1.svg alt="Diagramme des positions de l&amp;rsquo;aiguillage de croisement double"> <img src=svg_diagrams/DoubleSlipCrossing_A2toB2.svg alt="Diagramme des positions de l&amp;rsquo;aiguillage de croisement double"></p><p><strong>5) L&rsquo;aiguillage de croisement simple</strong></p><p>Celui-ci ressemble plus à un mélange entre une aiguille simple et un croisement. Il possède quatre ports : <em>A1</em>, <em>A2</em>, <em>B1</em> et <em>B2</em>.</p><p><img src=svg_diagrams/DoubleSlipCrossing_A1toB1.svg alt="Diagramme d&amp;rsquo;un aiguillage de croisement simple"></p><p>Voici les trois connexions que peut réaliser cet aiguillage :</p><ul><li><em>A1</em> vers <em>B1</em></li><li><em>A1</em> vers <em>B2</em></li><li><em>A2</em> vers <em>B2</em></li></ul><p><img src=svg_diagrams/SingleSlipCrossing_A1toB1.svg alt="Diagramme des positions de l&amp;rsquo;aiguillage de croisement simple"> <img src=svg_diagrams/SingleSlipCrossing_A1toB2.svg alt="Diagramme des positions de l&amp;rsquo;aiguillage de croisement simple">
<img src=svg_diagrams/SingleSlipCrossing_A2toB2.svg alt="Diagramme des positions de l&amp;rsquo;aiguillage de croisement simple"></p><h5 id=retour-aux-noeuds>Retour aux noeuds</h5><p>Un <code>Node</code> possède trois attributs :</p><ul><li><code>node_type</code> : l&rsquo;identifiant <a href=#types-daiguillages><code>NodeType</code></a> de ce noeud.</li><li><code>ports</code> : une correspondance entre les noms de port et les extrémités des sections de voie.</li><li><code>group_change_delay</code> : le temps qu&rsquo;il faut pour changer le groupe de l&rsquo;aiguillage qui est actif.</li></ul><p>Les noms des ports doivent correspondre aux ports du type du noeud choisi. Les extrémités de la section de voie peuvent être début ou fin, faites attention à choisir les bonnes.</p><p>La plupart des noeuds de notre exemple sont des noeuds habituels. Le chemin de la gare du Nord à la gare du Sud a deux aiguillages de croisement. Enfin, il y a un aiguillage de croisement double juste avant que la ligne principale ne se divise en lignes Nord-Est et Sud-Est.</p><p><img src=svg_diagrams/small_infra_rails_n_points.drawio.en.svg alt="Diagramme des sections de voie et des aiguillages"></p><p>Il est important de noter que ces noeuds sont présents par défaut dans le code du projet. Seuls les <code>extended_switch_type</code> ajoutés par l&rsquo;utilisateur apparaîtront dans le railjson.</p><h4 id=courbes-et-pentes>Courbes et pentes</h4><p>Les <code>Courbes</code> et les <code>Pentes</code> sont essentielles pour des simulations réalistes. Ces objets sont définis comme une plage entre une position de début (<code>begin</code>) et de fin (<code>end</code>) sur une section de voie. Si une courbe / pente s&rsquo;étend sur plus d&rsquo;une section de voie, elle doit être ajoutée à toutes les sections.</p><p>Les valeurs des courbes / pentes sont constantes sur toute leur étendue. Pour des courbes / pentes variables, il faut créer plusieurs objets.</p><p>Les valeurs de pente sont mesurées en <em>mètres par kilomètres</em>, et les valeurs de courbe sont mesurées en <em>mètres</em> (le rayon de la courbe).</p><div class="alert alert-primary" role=alert>N&rsquo;oubliez pas que la valeur <code>begin</code> doit toujours être inférieure à la valeur <code>end</code>. C&rsquo;est pourquoi les valeurs de courbe/pente peuvent être négatives : une pente ascendante de 1 allant du décalage 10 à 0 est identique à une pente descendante de -1 allant des décalages 0 à 10.</div><p>Dans le fichier <a href=https://github.com/osrd-project/osrd/blob/dev/python/railjson_generator/railjson_generator/scripts/examples/small_infra.py>small_infra.py</a>, nous avons des pentes sur les sections de voie <em>TA6</em>, <em>TA7</em>, <em>TD0</em> et <em>TD1</em>.</p><p>Il y a également des courbes sur les sections de voie <em>TE0</em>, <em>TE1</em>, <em>TE3</em> et <em>TF1</em>.</p><font color=#aa026d><h3 id=enclenchement>Enclenchement</h3></font><p>Jusqu&rsquo;à présent, tous les objets ont contribué à la topologie (forme) des voies. La topologie serait suffisante pour que les trains puissent naviguer sur le réseau, mais pas assez pour le faire en toute sécurité. pour assurer la sécurité, deux systèmes collaborent :</p><ul><li>L&rsquo;enclenchement garantit que les trains sont autorisés à avancer</li><li>La signalisation est le moyen par lequel l&rsquo;enclenchement communique avec le train</li></ul><h4 id=détecteurs>Détecteurs</h4><p>Ces objets sont utilisés pour créer des sections <a href="https://ressources.data.sncf.com/explore/dataset/lexique-des-acronymes-sncf/table/?sort=abreviation&q=TVD">TVD</a> (Track Vacancy Detection) : la zone de la voie située entre deux détecteurs est une section TVD. Lorsqu&rsquo;un train rencontre un détecteur, la section dans laquelle il entre est occupée. La seule fonction des sections TVD est de localiser les trains.</p><p>Dans la réalité, les détecteurs peuvent être des <a href=https://en.wikipedia.org/wiki/Axle_counter>compteurs d&rsquo;essieux</a> ou des <a href=https://en.wikipedia.org/wiki/Track_circuit>circuits de voie</a> par exemple.</p><p>Pour que cette méthode de localisation soit efficace, les détecteurs doivent être placés régulièrement le long de vos voies, pas trop nombreux pour des raisons de coût, mais pas trop peu, car les sections TVD seraient alors très grandes et les trains devraient être très éloignés les uns des autres pour être distingués, ce qui réduirait la capacité.</p><p>Il y a souvent des détecteurs à proximité de tous les extrémités des aiguillages. De cette façon, l&rsquo;enclenchement est averti presque immédiatement lorsqu&rsquo;un aiguillage est libéré, qui est alors libre d&rsquo;être utilisé à nouveau.</p><div class="alert alert-info" role=alert>Prenons l&rsquo;exemple d&rsquo;un aiguillage de croisement : si le train A le franchit du <em>nord</em> au <em>sud</em> et que le train B arrive pour le franchir de l&rsquo;<em>ouest</em> à l&rsquo;<em>est</em>, dès que le dernier wagon du train A a franchi l&rsquo;aiguillage, B devrait pouvoir partir, puisque A se trouve maintenant sur une section de voie complètement indépendante.</div><p>Dans <em>OSRD</em>, les détecteurs sont des objets ponctuels. Les attributs dont ils ont besoin sont leur <code>id</code> et leur localisation sur la voie (<code>track</code> et <code>offset</code>).</p><p><img src=svg_diagrams/small_infra_detectors.drawio.en.svg alt="Diagramme d&amp;rsquo;infra avec tous les détecteurs"></p><div class="alert alert-info" role=alert>Les carrés agglutinés représentent plusieurs détecteurs à la fois. En effet, certains tronçons de voie n&rsquo;étant pas représentés sur toute leur longueur, nous n&rsquo;avons pas pu représenter tous les détecteurs du tronçon de voie correspondant.</div><p>Quelques notes :</p><ul><li>Entre certains points, nous n&rsquo;avons ajouté qu&rsquo;un seul détecteur (et non pas deux), car ils étaient très proches les uns des autres, et cela n&rsquo;aurait eu aucun sens de créer une minuscule section TVD entre eux. Cette situation s&rsquo;est produite sur des sections de voies (<em>TA3</em>, <em>TA4</em>, <em>TA5</em>, <em>TF0</em> et <em>TG3</em>).</li><li>Dans notre infrastructure, il y a relativement peu de sections de voie qui sont assez longues pour nécessiter plus de détecteurs que ceux liés aux aiguillages. Ce sont, <em>TA6</em>, <em>TA7</em>, <em>TDO</em>, <em>TD1</em>, <em>TF1</em>, <em>TG1</em> et <em>TH1</em>. Par exemple, <em>TD0</em>, qui mesure 25 km, compte en fait 17 détecteurs au total.</li></ul><h4 id=butoirs-bufferstops>Butoirs (<code>BufferStops</code>)</h4><p>Les <code>BufferStops</code> sont des obstacles destinés à empêcher les trains de dérailler en bout des voies.</p><p>Dans notre infrastructure, il y a un butoir sur chaque section de voie qui est un cul-de-sac. Il y a donc 8 butoirs au total.</p><p>Avec les détecteurs, ils définissent les limites des sections <a href="https://ressources.data.sncf.com/explore/dataset/lexique-des-acronymes-sncf/table/?sort=abreviation&q=TVD">TVD</a> (voir <a href=#d%C3%A9tecteurs>Détecteurs</a>).</p><h4 id=itinéraires-routes>Itinéraires (<code>Routes</code>)</h4><p>Une <code>Route</code> est un itinéraire dans l&rsquo;infrastructure. Un sillon est une séquence de routes. Les itinéraires sont utilisés pour réserver des sections de sillon avec l&rsquo;enclenchement. Voir la <a href=/fr/docs/reference/design-docs/interlocking/>documentation dédiée</a>.</p><p>Il est représenté avec les attributs suivants :</p><ul><li><code>entry_point</code> et <code>exit_point</code> : Références de détecteurs ou de butées qui marquent le début et la fin de l&rsquo;itinéraire.</li><li><code>entry_point_direction</code> : Direction à prendre sur la section de voie depuis <code>entry_point</code> pour commencer l&rsquo;itinéraire.</li><li><code>switches_direction</code> : Un ensemble de directions à suivre lorsqu&rsquo;on rencontre un aiguillage sur notre itinéraire, de manière à reconstituer cet itinéraire de <code>entry_point</code> jusqu&rsquo;à <code>exit_point</code>.</li><li><code>release_detectors</code> : Lorsqu&rsquo;un train franchit un détecteur de libération, les ressources réservées depuis le début de la route jusqu&rsquo;à ce détecteur sont libérées.</li></ul><font color=#aa026d><h3 id=signalisation>Signalisation</h3></font><p>Grâce à l&rsquo;enclenchement, les trains sont localisés et autorisés à se déplacer. C&rsquo;est un bon début, mais c&rsquo;est inutile tant que les trains n&rsquo;en sont pas informés. C&rsquo;est là que les &ldquo;signaux&rdquo; entrent en jeu : les signaux réagissent aux enclenchements et peuvent être vus par les trains.</p><p>La façon dont les trains réagissent aux signaux dépend de l&rsquo;aspect, du type de signal et du système de signalisation.</p><p>Voici les attributs les plus importants des signaux :</p><ul><li><code>linked_detector</code> : Le <a href=#d%C3%A9tecteurs>détecteur</a> lié.</li><li><code>type_code</code> : Le type de signal.</li><li><code>direction</code> : La direction qu&rsquo;il protège, qui peut être simplement interprétée comme la façon dont il peut être vu par un train entrant (puisqu&rsquo;il n&rsquo;y a des feux que d&rsquo;un côté&mldr;). La direction est relative à l&rsquo;orientation de la section de voie.</li><li>Des attributs cosmétiques comme <code>angle_geo</code> and <code>side</code> qui contrôlent la manière dont les signaux sont affichés dans le front-end.</li></ul><p>Voici une visualisation de comment on peut représenter un signal, et quelle direction il protège.</p><p><img src=svg_diagrams/signal_dir.en.svg alt="Exemple de signal de direction"></p><br><p>La manière dont les signaux sont disposés dépend fortement du système de signalisation et du gestionnaire de l&rsquo;infrastructure.</p><p>Voici les règles de base utilisées pour cet exemple d&rsquo;infrastructure :</p><ul><li>Nous ajoutons deux signaux d&rsquo;espacement (un par direction) pour chaque détecteur qui découpe une longue section de TVD en plus petites sections.</li><li>Les entrées d&rsquo;aiguillage où un train pourrait devoir s&rsquo;arrêter sont protégées par un signal (qui est situé à l&rsquo;extérieur de la section TVD de l&rsquo;aiguillage). Il doit être visible depuis la direction utilisée pour approcher l&rsquo;aiguillage. Lorsqu&rsquo;il y a plusieurs aiguillages dans une rangée, seul le premier a généralement besoin d&rsquo;être protégé, car l&rsquo;enclenchement est généralement conçu pour ne pas encourager les trains à s&rsquo;arrêter au milieu des intersections.</li></ul><p>Notez que les détecteurs liés à au moins un signal ne sont pas représentés, car il n&rsquo;y a pas de signaux sans détecteurs associés dans cet exemple.</p><p>Pour obtenir le <code>id</code> d&rsquo;un détecteur lié à un signal, prenez le <code>id</code> du signal et remplacez <em>S</em> par <em>D</em> (par exemple SA0 -> DA0).</p><p><img src=svg_diagrams/small_infra_signals.drawio.en.svg alt="Diagramme d&amp;rsquo;infra avec tous les signaux"></p><div class="alert alert-info" role=alert>Sur <em>TA6</em>, <em>TA7</em>, <em>TD0</em> et <em>TD1</em> nous n&rsquo;avons pas pu représenter tous les signaux car ces sections de voie sont très longues et comportent de nombreux détecteurs, donc de nombreux signaux.</div><font color=#aa026d><h3 id=électrification>Électrification</h3></font><p>Pour permettre à des trains électriques de circuler sur notre infrastructure, nous devons spécifier les parties de celle-ci qui sont électrifiées.</p><h4 id=caténaires-catenaries>Caténaires (<code>Catenaries</code>)</h4><p>Les <code>Catenaries</code> représentent les câbles d&rsquo;alimentation qui alimentent les trains électriques. Ils sont représentés avec les attributs suivants :</p><ul><li><code>voltage</code> : Une chaîne de caractères représentant le type d&rsquo;alimentation électrique utilisée pour l&rsquo;électrification.</li><li><code>track_ranges</code> : Une liste de portions de sections de voie (<code>TrackRanges</code>) couvertes par cette caténaire. Une <code>TrackRange</code> est composée d&rsquo;un identifiant de section de voie, d&rsquo;une position <code>begin</code> et d&rsquo;une position <code>end</code>.</li></ul><p>Dans notre exemple, nous avons deux <code>Catenaries</code>:</p><ul><li>Une avec <code>voltage</code> défini sur <code>"1500"</code>, qui couvre uniquement <em>TA0</em>.</li><li>Une avec <code>voltage</code> défini sur <code>"25000"</code>, qui couvre tous les autres sauf <em>TD1</em>.</li></ul><p>Cela signifie que seuls les trains thermiques peuvent traverser la section de voie <em>TD1</em>.</p><p>Notre exemple montre également que, contrairement à son homologue réel, une seule <code>Catenary</code> peut couvrir toute l&rsquo;infrastructure.</p><h4 id=sections-neutres-neutralsections>Sections Neutres (<code>NeutralSections</code>)</h4><p>Dans certaines parties d&rsquo;une infrastructure, les conducteurs de train sont sommés - principalement pour des raisons de sécurité - de couper l&rsquo;alimentation électrique du train.</p><p>Pour représenter de telles parties, nous utilisons des <code>NeutralSections</code>. Elles sont représentées avec principalement les attributs suivants :</p><ul><li><code>track_ranges</code> : Une liste de <code>DirectedTrackRanges</code> (portions de sections de voie associées à une direction) couvertes par cette section neutre.</li><li><code>lower_pantograph</code> : Un booléen indiquant si le pantographe du train doit être abaissé pendant la traversée de cette section.</li></ul><p>Dans notre exemple, nous avons trois <code>NeutralSections</code> : une à la jonction des caténaires <code>"1500"</code> et <code>"25000"</code>, une sur <em>TA6</em> et une sur <em>TG1</em> et <em>TG4</em>.</p><p>Pour plus de détails sur le modèle, voir la <a href=../neutral_sections>page dédiée</a>.</p><font color=#aa026d><h3 id=divers>Divers</h3></font><h4 id=points-opérationnels-operationalpoints>Points opérationnels (<code>OperationalPoints</code>)</h4><p>Les <code>OperationalPoints</code> sont des collections de points (<code>OperationalPointParts</code>) d&rsquo;intérêt.</p><p>Par exemple, il peut être pratique de stocker l&rsquo;emplacement des plateformes en tant que parties et de les regrouper par station dans des points opérationnels.</p><p>Dans l&rsquo;exemple de l&rsquo;infrastructure, nous n&rsquo;avons utilisé que des points opérationnels pour représenter les stations. Les parties de points opérationnels sont représentées par des diamants violets. Gardez à l&rsquo;esprit qu&rsquo;un seul point opérationnel peut contenir plusieurs parties.</p><p><img src=svg_diagrams/small_infra_op_points.drawio.en.svg alt="Exemples de points opérationnels"></p><h4 id=limites-de-gabarit-loading-gauge-limits>Limites de gabarit (<code>Loading Gauge Limits</code>)</h4><p>Cet objet s&rsquo;apparente aux <code>Pentes</code> et aux <code>Courbes</code> : il couvre une plage de section de voie, avec une position de début (<code>begin</code>) et de fin (<code>end</code>). Il représente une restriction sur les trains qui peuvent circuler sur la plage donnée, par poids ou par type de train (fret ou passagers).</p><p>Nous n&rsquo;en avons pas mis dans nos exemples.</p><h4 id=sections-de-vitesse-speedsections>Sections de vitesse (<code>SpeedSections</code>)</h4><p>Les <code>SpeedSections</code> représentent les limites de vitesse (en mètres par seconde) qui sont appliquées sur certaines parties des voies. Une <code>SpeedSection</code> peut s&rsquo;étendre sur plusieurs sections de voie, et ne couvre pas nécessairement la totalité des sections de voie. Les sections de vitesse peuvent se chevaucher.</p><p>Dans notre exemple d&rsquo;infrastructure, nous avons une section de vitesse couvrant l&rsquo;ensemble de l&rsquo;infrastructure, limitant la vitesse à 300 km/h. Sur une plus petite partie de l&rsquo;infrastructure, nous avons appliqué des sections de vitesse plus restrictives.</p><p><img src=svg_diagrams/speed_sections.en.svg alt="Exemples de sections de vitesse"></p></div><div class=td-content style=page-break-before:always><h1 id=pg-f84103db6bad730c45fbfe4dc325576a>2.2 - Zones neutres</h1><div class=lead>Documentation des zones neutres et de leur implémentation</div><h2 id=objet-physique-que-lon-cherche-à-modéliser>Objet physique que l&rsquo;on cherche à modéliser</h2><h3 id=introduction>Introduction</h3><p>Pour qu&rsquo;un train puisse circuler, il faut soit qu&rsquo;il ait une source d&rsquo;énergie à bord (fuel, batterie, hydrogène, &mldr;) soit qu&rsquo;on l&rsquo;alimente en énergie tout au long de son parcours.</p><p>Pour fournir cette énergie, des câbles électriques sont suspendus au dessus des voies: les <em>caténaires</em>. Le train assure ensuite un contact avec ces câbles grâce à un patin conducteur monté sur un bras mécanique: le <em>pantographe</em>.</p><h3 id=zones-neutres>Zones neutres</h3><p>Avec ce système il est difficile d&rsquo;assurer l&rsquo;alimentation électrique d&rsquo;un train en continu sur toute la longueur d&rsquo;une ligne: sur certaines portions de voie, il est nécessaire de couper l&rsquo;alimentation électrique du train. Ce sont ces portions que l&rsquo;on appelle <strong>zones neutres</strong>.</p><p>En effet, pour éviter les pertes énergétiques le long des caténaires, le courant est fourni par plusieurs sous-stations réparties le long des voies. Deux portions de caténaires alimentées par des sous-stations différentes doivent être isolées électriquement pour éviter les courts-circuits.</p><p>Par ailleurs, la façon dont les voies sont électrifiées (courant continu ou non par exemple) peut changer selon les us locaux et l&rsquo;époque d&rsquo;installation. Il faut également isoler électriquement les portions de voies qui sont électrifiées différemment. Le train doit aussi (sauf cas particuliers) changer de pantographe lorsqu&rsquo;il change de type d&rsquo;électrification.</p><p>Dans ces deux cas on indique alors au conducteur de couper la traction du train, et parfois même d&rsquo;en baisser le pantographe.</p><p>Dans l&rsquo;infrastructure française, ces zones sont signalées par des panneaux d&rsquo;annonce, d&rsquo;exécution et de fin. Ces panneaux portent par ailleurs l&rsquo;indication de baisser le pantographe ou non. Les portions de voies entre l&rsquo;exécution et la fin peuvent ne pas être électrifiées entièrement, et même ne pas posséder de caténaire (dans ce cas la zone nécessite forcément de baisser le pantographe).<br>Parfois, des pancartes <em>REV</em> (pour réversible) sont placées en aval des panneaux de fin de zone. Elles sont destinées aux trains qui circulent avec un pantographe à l&rsquo;arrière du train. Ces pancartes indiquent que le conducteur peut reprendre la traction en toute sécurité.</p><p>Par ailleurs il peut parfois être impossible sur une courte portion de voie de placer une caténaire ou bien de lever le pantographe du train. Dans ce cas la ligne est tout de même considérée électrifiée, et la zone sans électrification (passage sous un pont par exemple) est considérée comme une zone neutre.</p><h3 id=matériel-roulant>Matériel roulant</h3><p>Après avoir traversé une zone neutre, un train doit reprendre la traction. Ce n&rsquo;est pas immédiat (quelques secondes), et la durée nécessaire dépend du matériel roulant.</p><p>Il doit également, le cas échéant, relever son pantographe, ce qui prend également du temps (quelques dizaines de secondes) et dépend également du matériel roulant.</p><p>Ainsi la marche sur l&rsquo;erre imposée au train s&rsquo;étend en dehors de la zone neutre, puisque ces temps systèmes sont à décompter à partir de la fin de la zone neutre.</p><h2 id=modèle-de-données>Modèle de données</h2><p>Nous avons choisi de modéliser les zones neutres comme l&rsquo;espace entre les panneaux liés à celle-ci (et non pas comme la zone précise où il n&rsquo;y a pas de caténaire ou bien où la caténaire n&rsquo;est pas électrifiée).</p><p>Cette zone est directionnelle, <em>i.e.</em> associée à un sens de circulation, pour pouvoir prendre en compte des placements de panneaux différents selon le sens. Le panneau d&rsquo;exécution d&rsquo;un sens donné n&rsquo;est pas nécessairement placé à la même position que le panneau de fin de zone du sens opposé.</p><p>Pour une voie à double sens, une zone neutre est donc représentée par deux objets.</p><p>Le schema est le suivant</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;lower_pantograph&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#a40000>boolean</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;track_ranges&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&#34;track&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#a40000>string</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&#34;start&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#a40000>number</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&#34;end&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#a40000>number</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&#34;direction&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#a40000>enum</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>],</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;announcement_track_ranges&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&#34;track&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#a40000>string</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&#34;start&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#a40000>number</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&#34;end&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#a40000>number</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&#34;direction&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#a40000>enum</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><ul><li><code>lower_pantograph</code> : indique si le pantographe doit être baissé dans cette zone</li><li><code>track_ranges</code> : liste des portions de voie où le train ne doit pas tractionner</li><li><code>announcement_track_ranges</code> : liste des portions de voie entre le panneau d&rsquo;annonce et le panneau d’exécution</li></ul><h2 id=affichage>Affichage</h2><h3 id=cartographie>Cartographie</h3><p>Les zones affichées dans la cartographie correspondent aux <code>track_ranges</code>, donc entre les panneaux d’exécution et de fin de zone. La couleur de la zone indique si le train doit baisser son pantographe dans la zone ou non.</p><p>La direction dans laquelle la zone s&rsquo;applique n&rsquo;est pas représentée.</p><h3 id=résultat-de-simulation>Résultat de simulation</h3><p>Dans l&rsquo;affichage linéaire, c&rsquo;est toujours la zone entre EXE et FIN qui est affichée.</p><h2 id=recherche-ditinéraire>Recherche d&rsquo;itinéraire</h2><p>Les zones neutres sont donc des portions de voie &ldquo;non électrifiées&rdquo; où un train électrique peut tout de même circuler (mais où il ne peut pas tractionner).</p><p>Lors de la recherche de chemin dans l&rsquo;infrastructure, une portion de voie qui n&rsquo;est pas couverte par les <code>track_ranges</code> d&rsquo;un objet caténaire (documentation à écrire) peut être empruntée par un train électrique seulement si elle est couverte par les <code>track_ranges</code> d&rsquo;une zone neutre.</p><h2 id=simulation>Simulation</h2><p>Dans la simulation, nous approximons le comportement du conducteur de la façon suivante :</p><ul><li>La marche sur l&rsquo;erre est entamée dès que la tête du train passe le panneau d&rsquo;annonce</li><li>Le décompte des temps systèmes (relevé du pantographe et reprise de la traction) commence dès que la tête du train passe le panneau de fin.</li></ul><p>Dans la simulation actuelle, il est plus facile de manier des bornes d&rsquo;intégration spatiales que temporelles. Nous effectuons l&rsquo;approximation suivante: lors de la sortie de la zone neutre, on multiplie les temps systèmes par la vitesse en sortie de zone. La marche sur l&rsquo;erre est alors prolongée de la distance obtenue. Cette approximation est raisonnable car l&rsquo;inertie du train et la quasi-absence de frottement garantissent que la vitesse varie peu sur cet intervalle de temps.</p><h2 id=potentielles-améliorations>Potentielles améliorations</h2><p>Plusieurs points pourraient être améliorés :</p><ul><li>On ne considère pas les pancartes <em>REV</em>, tous les trains ne possèdent donc qu&rsquo;un pantographe à l&rsquo;avant dans nos simulations.</li><li>Les temps systèmes sont approximés.</li><li>Le comportement conducteur est plutôt restrictif (la marche sur l&rsquo;erre pourrait commencer après le panneau d&rsquo;annonce).</li><li>L&rsquo;affichage des zones est limité: pas de représentation de la direction ou des zones d&rsquo;annonce.</li><li>Ces zones ne sont pas éditables.</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-1fb257de0b4d19a8a1b31c950ac27f16>3 - Calcul de marche</h1><p>OSRD peut être utilisé pour effectuer deux types de calculs :</p><ul><li><strong>Calcul de marche</strong> (standalone train simulation) : calcul du temps de parcours d&rsquo;un train sur un trajet donné,effectué sans interaction entre le train et le système de signalisation.</li><li><strong>Simulation</strong> : calcul &ldquo;dynamique&rdquo; de plusieurs trains interagissant entre eux via le système de signalisation.</li></ul><h4 id=1---les-données-dentrée>1 - Les données d&rsquo;entrée</h4><p>Un calcul de marche est basé sur 5 entrées :</p><ul><li><strong>L&rsquo;infrastructure :</strong> Topologie des lignes et des voies, position des gares et bâtiments voyageurs, position et type des aiguilles, signaux, vitesses maximales de ligne, profil de ligne corrigée (pentes, rampes et virages).</li></ul><p><img src=infrastructure.png alt=Infrastructure></p><blockquote><p>L’histogramme bleu est une représentation des déclivités en [‰] par position en [m]. Les déclivités sont positives pour les rampes et négatives pour les pentes.</p><p>La ligne orange représente le profil cumulé, c&rsquo;est-à-dire l&rsquo;altitude relative par rapport au point de départ.</p><p>La ligne bleue est une représentation des virages en termes de rayons des courbures en [m].</p></blockquote><ul><li><strong>Le matériel roulant :</strong> Dont les caractéristiques nécessaires pour effectuer la simulation sont représentées ci-dessous.</li></ul><p><img src=mat_roulant.png alt="Matériel roulant"></p><blockquote><p>La courbe orange, appelée courbe effort-vitesse du matériel, représente l&rsquo;effort moteur maximal en fonction de la
vitesse de circulation.</p><p>La longueur, la masse, et la vitesse max du train sont représentées en bas de l&rsquo;encadré.</p></blockquote><ul><li><p><strong>L&rsquo;horaire de départ</strong> permettant ensuite de calculer les horaires de passage aux différents points remarquables (dont gares).</p></li><li><p><strong>Les marges :</strong> Temps ajouté au trajet du train pour détendre sa marche (voir <a href=./allowances>page sur les marges</a>).</p></li></ul><p><img src=marges.png alt=Marge></p><ul><li><strong>Le pas de temps</strong> pour le calcul de <a href=./numerical_integration>l&rsquo;intégration numérique</a>.</li></ul><h4 id=2---les-résultats>2 - Les résultats</h4><p>Les résultats d&rsquo;un calcul de marche peuvent se représenter sous différentes formes :</p><ul><li><strong>Le graphique espace/temps (GET) :</strong> représente le parcours des trains dans l&rsquo;espace et dans le temps, sous la forme de traits globalement diagonaux dont la pente est la vitesse. Les arrêts apparaissent sous la forme de plateaux horizontaux.</li></ul><p><img src=graph_espace_temps.jpg alt="Graphique Espace/Temps"></p><blockquote><p>Exemple de GET avec plusieurs trains espacés d&rsquo;environ 30mn.</p><p>L’axe <strong>x</strong> est l’horaire de passage du train, l’axe <strong>y</strong> est la position du train en [m].</p><p>La ligne bleue représente le calcul de marche le plus tendu pour le train, la ligne verte représente un calcul de marche détendu, dit « économique ».</p><p>Les rectangles pleins entourant les trajets représentent les portions de la voie successivement reservées au passage du train (appelées cantons).</p></blockquote><ul><li><strong>Le graphique espace/vitesse (GEV) :</strong> représente le parcours d&rsquo;un seul train, cette fois-ci en terme de vitesse. Les arrêts apparaissent donc sous forme de décrochages de la courbe jusqu&rsquo;à zéro, suivis d&rsquo;un réaccélération.</li></ul><p><img src=graph_espace_vitesse.png alt="Graphique Espace/Vitesse"></p><blockquote><p>L’axe <strong>x</strong> est la position du train en [m], l’axe <strong>y</strong> est la vitesse du train en [km/h] .</p><p>La ligne violette représente la vitesse maximale autorisée.</p><p>La ligne bleue représente la vitesse dans le cas du calcul de marche le plus tendu.</p><p>La ligne verte représente la vitesse dans le cas du calcul de marche « économique ».</p></blockquote><ul><li><strong>Les horaires de passage du train aux différents points remarquables</strong></li></ul><p><img src="timetables.png?style=time" alt="Horaire de départ"></p><style>img[src$=time]{height:70%;width:70%}</style></div><div class=td-content style=page-break-before:always><h1 id=pg-61cab231921ddee36c8a138e2a6605b8>3.1 - Modélisation physique</h1><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css integrity=sha384-KiWOvVjnN8qwAZbuQyWDIbfCLFhLXNETzBQjA/92pIowpC0d2O3nppDGQVgwd2nB crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js integrity=sha384-0fdwu/T/EQMsQlrHCCHoH10pkPLlKA1jL5dFyUOvB3lfeT2540/2g6YgSi2BL14p crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous onload=renderMathInElement(document.body)></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><p>La modélisation physique joue un rôle important dans le cœur de calcul d&rsquo;OSRD. C&rsquo;est elle qui nous permet de simuler la circulation des trains, et elle doit être aussi réaliste que possible.</p><font color=#aa026d><h3 id=bilan-des-forces>Bilan des forces</h3></font><p>Pour calculer le déplacement du train au cours du temps, il faut d&rsquo;abord calculer sa vitesse à chaque instant.
Une manière simple d&rsquo;obtenir cette vitesse est de passer par le calcul de l&rsquo;accélération.
Grâce au principe fondamental de la dynamique, l&rsquo;accélération du train à chaque instant est directement dépendant
des différentes forces qui lui sont appliquées : $$ \sum \vec{F}=m\vec{a} $$</p><p><img src=../forces.png alt=Marche></p><ul><li><p><strong>Traction</strong> : La valeur de la force de traction \(F_{mot}\) dépend de plusieurs facteurs :</p><ul><li>du matériel roulant</li><li>de la vitesse du train \(v^{\prime}x\), selon la courbe effort-vitesse ci-dessous :</li></ul><p>$$ {\vec{F_{mot}}(v_{x^{\prime}}, x^{\prime})=F_{mot}(v_{x^{\prime}}, x^{\prime})\vec{e_x^{\prime}}} $$</p><p><img src=../effort-vitesse.png alt=Marche title="Exemple de courbe effort-vitesse d'un train"></p><blockquote><p>L&rsquo;axe <strong>x</strong> représente la vitesse du train en [km/h], l&rsquo;axe <strong>y</strong>, la valeur de la force de traction en [kN].</p></blockquote><ul><li>de l&rsquo;action du conducteur, qui accélère plus ou moins fort en fonction de l&rsquo;endroit où il se trouve sur son trajet</li></ul></li></ul><br><ul><li><strong>Freinage</strong> : La valeur de la force de freinage \(F_{brk}\) dépend elle aussi du matériel roulant et de l&rsquo;action du conducteur mais possède une valeur constante pour un matériel donné. Dans l&rsquo;état actuel de la modélisation, le freinage est soit nul, soit à sa valeur maximale.</li></ul><p>$$ \vec{F_{brk}}(x^{\prime})=-F_{brk}(x^{\prime}){\vec{e_{x^{\prime}}}} $$</p><p>Une seconde approche de la modélisation du freinage est l&rsquo;approche dite horaire, car utilisée pour la production horaire à la SNCF. Dans ce cas, la décélération est fixe et le freinage ne dépend plus des différentes forces appliquées au train. Les valeurs de décélération typiques vont de 0.4 à 0.7m/s².</p><br><ul><li><strong>Résistance à l&rsquo;avancement</strong> : Pour modéliser la résistance à l’avancement du train on utilise la formule de Davis qui prend en compte tous les frottements et la résistance aérodynamique de l’air. La valeur de la resistance à l&rsquo;avancement dépend de la vitesse \(v^{\prime}_x\). Les coefficients \(A\), \(B\), et \(C\) dépendent du matériel roulant.</li></ul><p>$$ {\vec{R}(v_{x^{\prime}})}=-(A+Bv_{x^{\prime}}+{Cv_{x^{\prime}}}^2){\vec{e_{x^{\prime}}}} $$</p><br><ul><li><strong>Poids (pentes + virages)</strong> : La force du poids donnée par le produit entre la masse \(m\) du train et la constante gravitationnelle \(g\) est projetée sur les axes \(\vec{e_x}^{\prime}\) et \(\vec{e_y}^{\prime}\).Pour la projection, on utilise l&rsquo;angle \(i(x^{\prime})\), qui est calculé à partir de l&rsquo;angle de déclivité \(s(x^{\prime})\) corrigé par un facteur qui prend en compte l&rsquo;effet du rayon de virage \(r(x^{\prime})\).</li></ul><p>$$
\vec{P(x^{\prime})}=-mg\vec{e_y}(x^{\prime})=
-mg\Big[sin\big(i(x^{\prime})\big){\vec{e_{x^{\prime}}}(x^{\prime})}+cos\big(i(x^{\prime})\big){\vec{e_{{\prime}}}(x^{\prime})}\Big]
$$</p><p>$$ i(x^{\prime})= s(x^{\prime})+\frac{800m}{r(x^{\prime})} $$</p><br><ul><li><strong>Réaction du sol</strong> : La force de réaction du sol compense simplement la composante verticale du poids, mais n&rsquo;a pas d&rsquo;impact sur la dynamique du train car elle n&rsquo;a aucune composante selon l&rsquo;axe \({\vec{e_x}^{\prime}}\).</li></ul><p>$$ \vec{R_{gnd}}=R_{gnd}{\vec{e_{y^{\prime}}}} $$</p><font color=#aa026d><h3 id=equilibre-des-forces>Equilibre des forces</h3></font><p>L&rsquo;équation du principe fondamental de la dynamique projetée sur l&rsquo;axe \({\vec{e_x}^{\prime}}\) (dans le référentiel du train) donne l&rsquo;équation scalaire suivante :</p><p>$$
a_{x^{\prime}}(t) = \frac{1}{m}\Big
[F_{mot}(v_{x^{\prime}}, x^{\prime})-F_{brk}(x^{\prime})-(A+Bv_{x^{\prime}}+{Cv_{x^{\prime}}}^2)-mgsin(i(x^{\prime}))\Big]
$$</p><p>Celle-ci est ensuite simplifiée en considérant que malgré la pente le train se déplace sur un plan et en amalgamant
\(\vec{e_x}\) et \(\vec{e_x}^{\prime}\). La pente a toujours un impact sur le bilan des forces mais on considère que le train ne se déplace qu&rsquo;horizontalement, ce qui donne l&rsquo;équation simplifiée suivante :</p><p>$$ a_{x}(t) = \frac{1}{m}\Big[F_{mot}(v_{x}, x)-F_{brk}(x)-(A+Bv_{x}+{Cv_{x}}^2)-mgsin(i(x))\Big] $$</p><font color=#aa026d><h3 id=résolution>Résolution</h3></font><p>La force motrice et la force de freinage dépendent de l&rsquo;action du conducteur (il décide d&rsquo;accélérer ou de freiner plus ou moins fort en fonction de la situation). Cette dépendance se traduit donc par une dépendance de ces deux forces à la position du train. La composante du poids dépend elle aussi de la position du train, car provenant directement des pentes et des virages situées sous ce dernier.</p><p>De plus, la force motrice dépend de la vitesse du train (selon la courbe effort vitesse) tout comme la résistance à
l&rsquo;avancement.</p><p>Ces différentes dépendances rendent impossible la résolution analytique de cette équation, et l&rsquo;accélération du train à chaque instant doit être calculée par intégration numérique.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-e1f75b5e8521a11c3f55859a7e224607>3.2 - Intégration numérique</h1><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css integrity=sha384-KiWOvVjnN8qwAZbuQyWDIbfCLFhLXNETzBQjA/92pIowpC0d2O3nppDGQVgwd2nB crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js integrity=sha384-0fdwu/T/EQMsQlrHCCHoH10pkPLlKA1jL5dFyUOvB3lfeT2540/2g6YgSi2BL14p crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous onload=renderMathInElement(document.body)></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script>
<font color=#aa026d><h3 id=introduction>Introduction</h3></font><p>La modélisation physique ayant montré que l&rsquo;accélération du train était influencée par différents facteurs variant le long du trajet (pente, courbure, force de traction du moteur&mldr;), le calcul doit passer par une méthode d&rsquo;intégration numérique. Le trajet est alors séparé en étapes suffisamment courtes pour considérer tous ces facteurs comme constants, ce qui permet cette fois ci d&rsquo;utiliser l&rsquo;équation du mouvement pour calculer le déplacement et la vitesse du train.</p><p>La méthode d&rsquo;intégration numérique d&rsquo;Euler est la plus simple pour effectuer ce genre de calcul, mais elle présente un certain nombre d&rsquo;inconvénients. Cet article explique la méthode d&rsquo;Euler, pourquoi elle ne convient pas aux besoins d&rsquo;OSRD et quelle méthode d&rsquo;intégration doit être utilisée à la place.</p><font color=#aa026d><h3 id=la-méthode-deuler>La méthode d&rsquo;Euler</h3></font><p>La méthode d&rsquo;Euler appliquée à l&rsquo;intégration de l&rsquo;équation du mouvement d&rsquo;un train est :</p><p>$$v(t+dt) = a(v(t), x(t))dt + v(t)$$</p><p>$$x(t+dt) = \frac{1}{2}a(v(t), x(t))dt^2 + v(t)dt + x(t)$$</p><center><p><img src="../euler.png?style=method" alt="Méthode d&amp;rsquo;Euler"></p></center><p>&nbsp;</p><h4 id=les-avantages-de-la-méthode-deuler><strong>Les avantages de la méthode d&rsquo;Euler</strong></h4><p>La méthode d&rsquo;Euler a pour avantages d&rsquo;être très simple à implémenter et d&rsquo;avoir un calcul plutôt rapide pour un pas de temps donné, en comparaison avec d&rsquo;autres méthodes d&rsquo;intégration numérique (voir <a href=#le-choix-de-la-m%C3%A9thode-dint%C3%A9gration-pour-osrd>annexe</a>)</p><h4 id=les-inconvénients-de-la-méthode-deuler><strong>Les inconvénients de la méthode d&rsquo;Euler</strong></h4><p>La méthode d&rsquo;intégration d&rsquo;Euler présente un certain nombre de problèmes pour OSRD :</p><ul><li>Elle est relativement imprécise, et donc nécessite un faible pas de temps, ce qui génère beaucoup de données.</li><li>En intégrant dans le temps, on ne connaît que les conditions du point de départ du pas d&rsquo;intégration (pente, paramètres d&rsquo;infrastructure, etc.) car on ne peut pas prédire précisément l&rsquo;endroit où il se termine.</li><li>On ne peut pas anticiper les futurs changements de directive : le train ne réagit qu&rsquo;en comparant son état actuel à sa consigne au même instant. Pour illustrer c&rsquo;est un peu comme si le conducteur était incapable de voir devant lui, alors que dans la réalité il anticipe en fonction des signaux, pentes, virages qu&rsquo;il voit devant lui.</li></ul><font color=#aa026d><h3 id=la-méthode-runge-kutta-4>La méthode Runge-Kutta 4</h3></font><p>La méthode Runge-Kutta 4 appliquée à l&rsquo;intégration de l&rsquo;équation du mouvement d&rsquo;un train est :</p><p>$$v(t+dt) = v(t) + \frac{1}{6}(k_1 + 2k_2 + 2k_3 + k_4)dt$$</p><p>Avec :</p><p>$$k_1 = a(v(t), x(t))$$</p><p>$$k_2 = a\Big(v(t+k_1\frac{dt}{2}), x(t) + v(t)\frac{dt}{2} + k_1\frac{dt^2}{8}\Big)$$</p><p>$$k_3 = a\Big(v(t+k_2\frac{dt}{2}), x(t) + v(t)\frac{dt}{2} + k_2\frac{dt^2}{8}\Big)$$</p><p>$$k_4 = a\Big(v(t+k_3dt), x(t) + v(t)dt + k_3\frac{dt^2}{2}\Big)$$</p><center><p><img src="../rk4.png?style=method" alt="Méthode de Runge-Kutta 4"></p></center><p>&nbsp;</p><h4 id=les-avantages-de-la-méthode-de-runge-kutta-4><strong>Les avantages de la méthode de Runge Kutta 4</strong></h4><p>La méthode d&rsquo;intégration de Runge Kutta 4 permet de répondre aux différents problèmes soulevés par celle d&rsquo;Euler :</p><ul><li>Elle permet d&rsquo;anticiper les changements de directive au sein d&rsquo;un pas de calcul, représentant ainsi davantage la réalité de conduite d&rsquo;un train.</li><li>Elle est plus précise pour le même temps de calcul (voir <a href=#le-choix-de-la-m%C3%A9thode-dint%C3%A9gration-pour-osrd>annexe</a>), permettant des étapes d&rsquo;intégration plus grandes, donc moins de points de données.</li></ul><h4 id=les-inconvénients-de-la-méthode-de-runge-kutta-4><strong>Les inconvénients de la méthode de Runge Kutta 4</strong></h4><p>Le seul inconvénient notable de la méthode de Runge Kutta 4 rencontré pour l&rsquo;instant est sa difficulté d&rsquo;implémentation.</p><font color=#aa026d><h3 id=le-choix-de-la-méthode-dintégration-pour-osrd>Le choix de la méthode d&rsquo;intégration pour OSRD</h3></font><h4 id=étude-de-la-précision-et-de-la-vitesse-de-calcul><strong>Étude de la précision et de la vitesse de calcul</strong></h4><p>Différentes méthodes d&rsquo;intégration auraient pu remplacer l&rsquo;intégration d&rsquo;Euler de base dans l&rsquo;algorithme d&rsquo;OSRD. Afin de décider quelle méthode conviendrait le mieux, une étude sur la précision et la vitesse de calcul de différentes méthodes a été menée. Cette étude sert à comparé les méthodes suivantes :</p><ul><li>Euler</li><li>Euler-Cauchy</li><li>Runge-Kutta 4</li><li>Adams 2</li><li>Adams 3</li></ul><p>Toutes les explications sur ces méthodes peuvent être trouvées dans <a href=https://github.com/osrd-project/osrd/wiki/documents/integration/MethodesNumeriques_EricGoncalves.pdf>ce document</a>, et le code python utilisé pour la simulation est <a href=https://raw.githubusercontent.com/wiki/osrd-project/osrd/code/integration/Tests_precision.py>ici</a>.</p><p>La simulation calcule la position et la vitesse d&rsquo;un TGV accélérant sur une ligne droite plate.</p><h4 id=simulations-à-pas-de-temps-équivalent><strong>Simulations à pas de temps équivalent</strong></h4><p>Une courbe de référence a été simulée en utilisant la méthode d&rsquo;Euler avec un pas de temps de 0,1s, puis le même parcours a été simulé en utilisant les autres méthodes avec un pas de temps de 1s. Il est alors possible de comparer simplement chaque courbe à la courbe de référence, en calculant la valeur absolue de la différence à chaque point calculé. Voici l&rsquo;erreur absolue résultante de la position du train sur sa distance parcourue :</p><p><img src=../precisions_h_equivalent.png alt=precisions_h_equivalent></p><p>Il apparaît immédiatement que la méthode d&rsquo;Euler est moins précise que les quatre autres d&rsquo;environ un ordre de grandeur. Chaque courbe présente un pic où la précision est extrêmement élevée (erreur extrêmement faible), ce qui s&rsquo;explique par le fait que toutes les courbes commencent légèrement au-dessus de la courbe de référence, la croisent en un point et finissent légèrement en dessous, ou <em>vice versa</em>.</p><p>Comme la précision n’est pas le seul indicateur important, le temps de calcul de chaque méthode a été mesuré. Voici ce que nous obtenons pour les mêmes paramètres d’entrée :</p><table><thead><tr><th style=text-align:left>Méthode d&rsquo;intégration</th><th style=text-align:right>Temps de calcul (s)</th></tr></thead><tbody><tr><td style=text-align:left>Euler</td><td style=text-align:right>1.86</td></tr><tr><td style=text-align:left>Euler-Cauchy</td><td style=text-align:right>3.80</td></tr><tr><td style=text-align:left>Runge-Kutta 4</td><td style=text-align:right>7.01</td></tr><tr><td style=text-align:left>Adams 2</td><td style=text-align:right>3.43</td></tr><tr><td style=text-align:left>Adams 3</td><td style=text-align:right>5.27</td></tr></tbody></table><p>Ainsi, Euler-Cauchy et Adams 2 sont environ deux fois plus lents que Euler, Adams 3 est environ trois fois plus lent, et RK4 est environ quatre fois plus lent. Ces résultats ont été vérifiés sur des simulations beaucoup plus longues, et les différents ratios sont maintenus.</p><h4 id=simulation-à-temps-de-calcul-équivalent><strong>Simulation à temps de calcul équivalent</strong></h4><p>Comme les temps de calcul de toutes les méthodes dépendent linéairement du pas de temps, il est relativement simple de comparer la précision pour un temps de calcul à peu près identique. En multipliant le pas de temps d&rsquo;Euler-Cauchy et d&rsquo;Adams 2 par 2, le pas de temps d&rsquo;Adams 3 par 3, et le pas de temps de RK4 par 4, voici les courbes d&rsquo;erreur absolue résultantes :</p><p><img src=../precisions_time_equivalent.png alt=precisions_time_equivalent></p><p>Et voici les temps de calcul :</p><table><thead><tr><th style=text-align:left>Méthode d&rsquo;intégration</th><th style=text-align:right>Temps de calcul (s)</th></tr></thead><tbody><tr><td style=text-align:left>Euler</td><td style=text-align:right>1.75</td></tr><tr><td style=text-align:left>Euler-Cauchy</td><td style=text-align:right>2.10</td></tr><tr><td style=text-align:left>Runge-Kutta 4</td><td style=text-align:right>1.95</td></tr><tr><td style=text-align:left>Adams 2</td><td style=text-align:right>1.91</td></tr><tr><td style=text-align:left>Adams 3</td><td style=text-align:right>1.99</td></tr></tbody></table><p>Après un certain temps, RK4 tend à être la méthode la plus précise, légèrement plus précise que Euler-Cauchy, et toujours bien plus précise que la méthode d&rsquo;Euler.</p><font color=#aa026d><h3 id=conclusions-de-létude>Conclusions de l&rsquo;étude</h3></font><p>L&rsquo;étude de la précision et de la vitesse de calcul présentée ci-dessus montre que RK4 et Euler-Cauchy seraient de bons candidats pour remplacer l&rsquo;algorithme d&rsquo;Euler dans OSRD : les deux sont rapides, précis, et pourraient remplacer la méthode d&rsquo;Euler sans nécessiter de gros changements d&rsquo;implémentation car ils ne font que des calculs au sein du pas de temps en cours de calcul.
<strong>Il a été décidé qu&rsquo;OSRD utiliserait la méthode Runge-Kutta 4 parce qu&rsquo;elle est légèrement plus précise que Euler-Cauchy et que c&rsquo;est une méthode bien connue pour ce type de calcul, donc très adaptée à un simulateur open-source.</strong></p><style>img[src$=method]{height:50%;width:50%}</style><blockquote></blockquote></div><div class=td-content style=page-break-before:always><h1 id=pg-8adca5807826313222b06ebdda200d27>3.3 - Le système d'enveloppes</h1><p>Le système d&rsquo;enveloppes est une interface créée spécifiquement pour le calcul de marche d&rsquo;OSRD. Il permet de manipuler différentes courbes espace/vitesse, de les découper, de les mettre bout à bout, d&rsquo;interpoler des points spécifiques, et d&rsquo;adresser beaucoup d&rsquo;autres besoins nécessaires au calcul de marche.</p><font color=#aa026d><h3 id=une-interface-spécifique-dans-le-service-osrd-core>Une interface spécifique dans le service OSRD Core</h3></font><p>Le système d&rsquo;enveloppes fait partie du service core d&rsquo;OSRD (voir <a href=../architecture/_index>l&rsquo;architecture du logiciel</a>).</p><p>Ses principaux composants sont :</p><p><strong>1 - EnvelopePart :</strong> courbe espace/vitesse, définie comme une séquence des points et possédant des métadonnées indiquant par exemple s&rsquo;il s&rsquo;agit d&rsquo;une courbe d&rsquo;accélération, de freinage, de maintien de vitesse, etc.</p><p><strong>2 - Envelope :</strong> liste d&rsquo;EnvelopeParts mises bout-à-bout et sur laquelle il est possible d&rsquo;effectuer certaines opérations :</p><ul><li>vérifier la continuité dans l’espace (obligatoire) et dans la vitesse (facultative)</li><li>chercher la vitesse minimale et/ou maximale de l&rsquo;enveloppe</li><li>couper une partie de l’enveloppe entre deux points de l&rsquo;espace</li><li>effectuer une interpolation de vitesse à une certaine position</li><li>calculer le temps écoulé entre deux positions de l’enveloppe</li></ul><p><img src=../envelopes_scheme.png alt=envelope_scheme></p><p><strong>3 - Overlays :</strong> système permettant d’ajouter des EnvelopePart plus contraignantes (c&rsquo;est-à-dire dont la vitesse est plus faible) à une enveloppe existante.</p><font color=#aa026d><h3 id=enveloppes-données-vs-enveloppes-calculées>Enveloppes données vs enveloppes calculées</h3></font><p>Pendant la simulation, le train est censé suivre certaines instructions de vitesse. Celles-ci sont modélisées dans OSRD par des enveloppes sous forme de courbes espace/vitesse. On en distingue deux types :</p><ul><li>Les enveloppes provenant <strong>des données d&rsquo;infrastructure et de matériel roulant</strong>, comme la vitesse maximale de la ligne et la vitesse maximale du train. Etant des données d&rsquo;entrée de notre calcul, elles ne correspondent pas à des courbes ayant un sens physique, car elles ne sont pas issues des résultats d&rsquo;une intégration réelle des équations physiques du mouvement.</li><li>Les enveloppes résultant <strong>d&rsquo;une intégration réelle</strong> des équations du mouvement physique. Elles correspondent à une courbe physiquement tenable par le train et contiennent également des informations sur le temps.</li></ul><p>Un exemple simple pour illustrer cette différence : si l&rsquo;on simule un trajet de TER sur une ligne de montagne, une des données d&rsquo;entrée va être une enveloppe de vitesse maximale à 160km/h, correspondant à la vitesse maximale de notre TER. Mais cette enveloppe ne correspond pas à une réalité physique, car il se peut que sur certaines portions la rampe soit trop raide pour que le train arrive effectivement à maintenir cette vitesse maximale de 160km/h. L&rsquo;enveloppe calculée présentera donc dans cet exemple un décrochage de vitesse dans les zones de fortes rampes, là où l&rsquo;enveloppe donnée était parfaitement plate.</p><font color=#aa026d><h3 id=simulation-de-plusieurs-trains>Simulation de plusieurs trains</h3></font><p>Dans le cas de la simulation de nombreux trains, le système de signalisation doit assurer <strong>la sécurité</strong>. L&rsquo;effet de la signalisation sur le calcul de marche d&rsquo;un train est reproduit en superposant des enveloppes dynamiques à l&rsquo;enveloppe statique. Une nouvelle enveloppe dynamique est introduite par exemple lorsqu&rsquo;un signal se ferme. Le train suit l&rsquo;enveloppe économique statique superposée aux enveloppes dynamiques, s&rsquo;il y en a. Dans ce mode de simulation, un contrôle du temps est effectué par rapport à un temps théorique provenant de l&rsquo;information temporelle de l&rsquo;enveloppe économique statique. Si le train est en retard par rapport à l&rsquo;heure prévue, il cesse de suivre l&rsquo;enveloppe économique et essaie d&rsquo;aller plus vite. Sa courbe espace/vitesse sera donc limitée par l&rsquo;enveloppe d&rsquo;effort maximum.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-396e33d6479b448e3938369013852b4a>3.4 - Le processus de calcul de marche</h1><p>Le calcul de marche dans OSRD est un processus à 4 étapes, utilisant chacune <a href=../envelopes_system>le système d&rsquo;enveloppes</a> :</p><ol><li><a href=#calcul-du-profil-de-vitesse-le-plus-restrictif>Construction du profil de vitesse le plus restrictif</a></li><li><a href=#calcul-du-profil-de-vitesse-maximale>Ajout des différentes courbes de freinage</a></li><li><a href=#calcul-du-profil-deffort-maximal>Ajout des différentes courbes d&rsquo;accélération et vérification des courbes de vitesse constante</a></li><li><a href=#application-de-marges>Application de marge(s)</a></li></ol><p>&nbsp;</p><font color=#aa026d><h3 id=calcul-du-profil-de-vitesse-le-plus-restrictif>Calcul du profil de vitesse le plus restrictif</h3></font><p>Une première enveloppe est calculée au début de la simulation en regroupant toutes les limites de vitesse statiques :</p><ul><li>vitesse maximale de la ligne</li><li>vitesse maximale du matériel roulant</li><li>limitations temporaires de vitesse (en cas de travaux sur une ligne par exemple)</li><li>limitations de vitesse par catégorie de train</li><li>limitations de vitesse selon la charge du train</li><li>limitations de vitesse correspondant à des panneaux de signalisation</li></ul><p>La longueur du train est également prise en compte pour s&rsquo;assurer que le train n&rsquo;accélère qu&rsquo;une fois sa queue ayant quitté la zone de plus faible vitesse. Un décalage est alors appliqué à la courbe en pointillée rouge. L&rsquo;enveloppe résultante (courbe noire) est appelée <strong>MRSP (Most Restricted Speed Profile)</strong> correspondant donc au profil de vitesse le plus restrictif. C&rsquo;est sur cette enveloppe que seront calculées les étapes suivantes.</p><p><img src=../mrsp.png alt="Most Restricted Speed Profile"></p><blockquote><p>La ligne pointillée rouge représente la vitesse maximale autorisée en fonction de la position.
La ligne noire représente le MRSP où la longueur du train a été prise en compte.</p></blockquote><p>Il est à noter que les différentes envelopeParts composant le MRSP sont des données d&rsquo;entrée, elles ne correspondent donc pas à des courbes avec une réalité physique.</p><font color=#aa026d><h3 id=calcul-du-profil-de-vitesse-maximale>Calcul du profil de vitesse maximale</h3></font><p>En partant du MRSP, toutes les courbes de freinage sont calculées grâce au système d&rsquo;overlay (voir <a href=../envelopes_system/#une-interface-sp%C3%A9cifique-dans-le-service-osrd-core>ici</a> pour plus de détails sur les overlays), c&rsquo;est-à-dire en créant des envelopeParts qui seront plus restrictives que le MRSP. La courbe ainsi obtenue est appelée <strong>Max Speed Profile</strong> (profil de vitesse maximale). Il s&rsquo;agit de l&rsquo;enveloppe de vitesse maximale du train, tenant compte de ses capacités de freinage.</p><p>Etant donné que les courbes de freinage ont un point de fin imposé et que l&rsquo;équation de freinage n&rsquo;a pas de solution analytique, il est impossible de prédire leur point de départ. Les courbes de freinage sont donc calculées à rebours en partant de leur point cible, c&rsquo;est-à-dire le point dans l&rsquo;espace où une certaine limite de vitesse est imposée (vitesse cible finie) ou le point d&rsquo;arrêt (vitesse cible nulle).</p><p><img src=../msp.png alt="Max Speed Profile"></p><p>Pour des raisons historiques en production horaire, les courbes de freinages sont calculées avec une décélération forfaitaire, dite décélération horaire (typiquement ~0,5m/s²) sans prendre en compte les autres forces. Cette méthode a donc également été implémentée dans OSRD, permettant ainsi de calculer les freinages de deux manières différentes : avec ce taux horaire ou avec une force de freinage qui vient simplement s&rsquo;ajouter aux autres forces.</p><font color=#aa026d><h3 id=calcul-du-profil-deffort-maximal>Calcul du profil d&rsquo;effort maximal</h3></font><p>Pour chaque point correspondant à une augmentation de vitesse dans le <strong>MRSP</strong> ou à la fin d&rsquo;une courbe de freinage d&rsquo;arrêt, une courbe d&rsquo;accélération est calculée. Les courbes d&rsquo;accélération sont calculées en tenant compte de toutes les forces actives (force de traction, résistance à l&rsquo;avancement, poids) et ont donc un sens physique.</p><p>Pour les envelopeParts dont le sens physique n&rsquo;a pas encore été vérifié (qui à ce stade sont les phases de circulation à vitesse constante, provenant toujours du MRSP), une nouvelle intégration des équations de mouvement est effectuée. Ce dernier calcul est nécessaire pour prendre en compte d&rsquo;éventuels décrochages de vitesse dans le cas où le train serait physiquement incapable de tenir sa vitesse, typiquement en présence de fortes rampes (voir <a href=../envelopes_system/#enveloppes-donn%C3%A9es-vs-enveloppes-calcul%C3%A9es>cet exemple</a>).</p><p>L&rsquo;enveloppe qui résulte de ces ajouts de courbes d&rsquo;accélérations et de la vérification des plateaux de vitesse est appelée <strong>Max Effort Profile</strong> (profil d&rsquo;effort maximal).</p><p><img src=../mep.png alt="Max Effort Profile"></p><p>A ce stade, l&rsquo;enveloppe obtenue est continue et a un sens physique du début à fin. Le train accélère au maximum, roule aussi vite que possible en fonction des différentes limites de vitesse et de ses capacités motrices, et freine au maximum. Le calcul de marche obtenu s&rsquo;appelle la <strong>marche de base</strong>. Elle correspond au trajet le plus rapide possible pour le matériel roulant donné sur le parcours donné.</p><font color=#aa026d><h3 id=application-de-marges>Application de marge(s)</h3></font><p>Après avoir effectué le calcul de la marche de base (correspondant au Max Effort Profile dans OSRD), il est possible d&rsquo;y appliquer des marges (allowances). Les marges sont des ajouts de temps supplémentaire au parcours du train. Elles servent notamment à lui permettre de rattraper son retard si besoin ou à d&rsquo;autres besoins opérationnels (plus de détails sur les marges <a href=../allowances>ici</a>).</p><p>Une nouvelle enveloppe <strong>Allowances</strong> est donc calculée grâce à des overlays pour distribuer la marge demandée par l&rsquo;utilisateur sur l&rsquo;enveloppe d&rsquo;effort maximal calculée précédemment.</p><p><img src=../allowances.png alt=Marges></p><p>Dans le calcul de marche d&rsquo;OSRD, il est possible de distribuer les marges d&rsquo;une manière linéaire, en abaissant toutes les vitesses d&rsquo;un certain facteur, ou économique, c&rsquo;est-à-dire en minimisant la consommation d&rsquo;énergie pendant le parcours du train.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-aa03910eecb13f5d3e9053a632348bc2>3.5 - Les marges</h1><font color=#aa026d><h3 id=la-raison-dêtre-des-marges>La raison d&rsquo;être des marges</h3></font><p>Comme expliqué dans le <a href=../pipeline/#calcul-du-profil-deffort-maximal>calcul du Max Effort Profile</a>, la <strong>marche de base</strong> représente la marche la plus tendue normalement réalisable, c&rsquo;est-à-dire le trajet le plus rapide possible du matériel donné sur le parcours donné. Le train accélère au maximum, roule aussi vite que possible en fonction des différentes limites de vitesse et de ses capacités motrices, et freine au maximum.</p><p>Cette marche de base présente un inconvénient majeur : si un train part avec 10min de retard, il arrivera au mieux avec 10min de retard, car par définition il lui est impossible de rouler plus vite que la marche de base. Par conséquent, les trains sont programmés avec un ajout d&rsquo;une ou de plusieurs marges. Les marges sont une détente du trajet du train, un ajout de temps à l&rsquo;horaire prévu, qui se traduit inévitablement par un abaissement des vitesses de circulation.</p><blockquote><p>Un train circulant en marche de base est incapable de rattraper son retard !</p></blockquote><font color=#aa026d><h3 id=le-type-de-marge>Le type de marge</h3></font><p>On distingue deux types de marges :</p><ul><li><strong>La marge de régularité</strong> : il s&rsquo;agit du temps complémentaire ajouté à la marche de base pour tenir compte de l’imprécision de la mesure de la vitesse, pour pallier les conséquences des incidents extérieurs venant perturber la marche théorique des trains, et pour maintenir la régularité de la circulation. La marge de régularité s&rsquo;applique sur l&rsquo;ensemble du trajet, bien que sa valeur puisse changer sur certains intervalles.</li><li><strong>La marge de construction</strong> : il s&rsquo;agit du temps ajouté / retiré sur un intervalle spécifique, en plus de la marge de régularité, mais cette fois pour des raisons opérationnelles (esquiver un autre train, libérer une voie plus rapidement, etc.)</li></ul><p>Une marche de base à laquelle on vient ajouter une marge de régularité donne ce que l&rsquo;on appelle une <strong>marche type</strong>.</p><font color=#aa026d><h3 id=la-distribution-de-la-marge>La distribution de la marge</h3></font><p>L&rsquo;ajout de marge se traduisant par un abaissement des vitesses le long du trajet, plusieurs marches types sont possibles. En effet, il existe une infinité de solutions aboutissant au même temps de parcours.</p><p>En guise d&rsquo;exemple simple, pour détendre la marche d&rsquo;un train de 10% de son temps de parcours, il est possible de prolonger n&rsquo;importe quel arrêt de l&rsquo;équivalent en temps de ces 10%, tout comme il est possible de rouler à 1/1,1 = 90,9% des capacités du train sur l&rsquo;ensemble du parcours, ou encore de rouler moins vite, mais seulement aux vitesses élevées&mldr;</p><p>Il y a pour l&rsquo;instant deux algorithmes de distribution de la marge dans OSRD : linéaire et économique.</p><font color=#aa026d><h3 id=la-distribution-linéaire>La distribution linéaire</h3></font><p>La distribution de marge linéaire consiste simplement à abaisser les vitesses d&rsquo;un même facteur sur la zone où l&rsquo;utilisateur applique la marge. En voici un exemple d&rsquo;application :</p><p><img src=../python_plot_linear.png alt="Python plot linear"></p><p>Cette distribution a pour avantage de répartir la marge de la même manière sur tout le trajet. Un train prenant du retard à 30% de son trajet disposera de 70% de sa marge pour les 70% de trajets restants.</p><font color=#aa026d><h3 id=la-distribution-économique>La distribution économique</h3></font><p>La distribution économique de la marge, présentée en détail dans <a href=/pdf/MARECO.pdf>ce document</a> (<strong>MARECO</strong> est un algorithme conçu par la direction de la recherche SNCF), consiste à répartir la marge de la manière la plus économe possible en énergie. Elle est basée sur deux principes :</p><ol><li>une vitesse plafond, évitant les vitesses les plus consommatrices en énergie</li><li>des zones de marche sur l&rsquo;erre, situées avant les freinages et les fortes pentes, où le train circule à moteur coupé grâce à son inertie, permettant de ne consommer aucune énergie pendant ce laps de temps</li></ol><p><img src=../python_plot_eco_w_slopes.png alt="Python plot eco with slopes"></p><blockquote><p>Un exemple de marche économique. En haut, les pentes/rampes rencontrées par le train. Les zones de marche sur l&rsquo;erre sont représentées en bleu.</p></blockquote></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel=noopener href=https://github.com/osrd-project/osrd aria-label=GitHub><i class="fab fa-github"></i></a></li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2023 Contributeurs à OSRD. Tous droits réservés</small></div></div></div></footer></div><script src=https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js integrity=sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js integrity="sha512-UR25UO94eTnCVwjbXozyeVd6ZqpaAE9naiEUBK/A+QDbfSTQFhPGj5lOR6d8tsgbBk84Ggb5A3EkjsOgPRPcKA==" crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/mermaid@8.13.4/dist/mermaid.min.js integrity="sha512-JERecFUBbsm75UpkVheAuDOE8NdHjQBrPACfEQYPwvPG+fjgCpHAz1Jw2ci9EXmd3DdfiWth3O3CQvcfEg8gsA==" crossorigin=anonymous></script><style>.markmap>svg{width:100%;height:300px}</style><script>window.markmap={autoLoader:{manual:!0}}</script><script src=https://cdn.jsdelivr.net/npm/markmap-autoloader></script>
<script src=/js/tabpane-persist.js></script>
<script src=/js/main.min.928c8c2d8b4f463998503da833bc465b748d40b80287e0398a7e1a38ab1c87a2.js integrity="sha256-koyMLYtPRjmYUD2oM7xGW3SNQLgCh+A5in4aOKsch6I=" crossorigin=anonymous></script></body></html>