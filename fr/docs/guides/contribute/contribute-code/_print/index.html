<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=fr class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=canonical type=text/html href=https://osrd.fr/fr/docs/guides/contribute/contribute-code/><link rel=alternate type=application/rss+xml href=https://osrd.fr/fr/docs/guides/contribute/contribute-code/index.xml><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Contribuer au code | OSRD</title>
<meta name=description content="Apporter des modifications au code d'OSRD"><meta property="og:url" content="https://osrd.fr/fr/docs/guides/contribute/contribute-code/"><meta property="og:site_name" content="OSRD"><meta property="og:title" content="Contribuer au code"><meta property="og:description" content="Apporter des modifications au code d'OSRD"><meta property="og:locale" content="fr"><meta property="og:type" content="website"><meta itemprop=name content="Contribuer au code"><meta itemprop=description content="Apporter des modifications au code d'OSRD"><meta itemprop=wordCount content="62"><meta name=twitter:card content="summary"><meta name=twitter:title content="Contribuer au code"><meta name=twitter:description content="Apporter des modifications au code d'OSRD"><link rel=preload href=/scss/main.min.5c45ececdbdfc535ee5253f678cfd68edfba69407b82367ff2e289cdf3db5514.css as=style integrity="sha256-XEXs7NvfxTXuUlP2eM/Wjt+6aUB7gjZ/8uKJzfPbVRQ=" crossorigin=anonymous><link href=/scss/main.min.5c45ececdbdfc535ee5253f678cfd68edfba69407b82367ff2e289cdf3db5514.css rel=stylesheet integrity="sha256-XEXs7NvfxTXuUlP2eM/Wjt+6aUB7gjZ/8uKJzfPbVRQ=" crossorigin=anonymous><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script></head><body class=td-section><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="container-fluid flex-column flex-md-row"><a class=navbar-brand href=/fr/><span class="navbar-brand__logo navbar-logo"><svg id="svg36" width="110.767" height="22"><style id="style1">.st9{fill:#fff}</style><g id="ok" transform="scale(.1918)"><g id="g36"><g id="g29"><path id="path23" d="M38.5 83.4c-1.9 8.2-2.9 17-2.9 26.5v4.8h16.6c-2.8-13.2-7.8-23.4-13.7-31.3z" class="st9"/><path id="path24" d="M0 57.5v19.9c3.1 1.2 6.3 2.7 9.5 4.6 8.5 5.2 15 12.6 19.4 21.8v-31c-3.4-3-6.9-5.5-10.3-7.5-6.5-3.7-13-6.2-18.6-7.8z" class="st9"/><path id="path25" d="M35.6 69.9c4.3-11.3 10.6-21.1 18.9-29.4V0H35.6z" class="st9"/><path id="path26" d="M40.8 75.4c5.3 6.2 10.1 13.8 13.7 23.3V50.6C48.6 57.8 44 66.1 40.8 75.4z" class="st9"/><path id="path27" d="M100.7.0H61.3v34.5C73.1 25.2 86 20 96.9 17.2c1.8-.5 3.7.6 4.1 2.4.5 1.8-.6 3.6-2.4 4.1-11.4 2.9-25.3 8.6-37.2 19.7v31.8c2.9-6.3 6.7-11.7 11.4-16.4 9.4-9.3 21-14.1 30.5-16.6 1.8-.5 3.7.6 4.1 2.4.5 1.8-.6 3.6-2.4 4.1-4.7 1.2-10.1 3.1-15.3 6-19 10.3-28.2 28.4-28.2 55.2v4.8h39.3c7.8.0 14.1-6.3 14.1-14.1V14.1C114.7 6.3 108.4.0 100.7.0z" class="st9"/><path id="path28" d="M22 59.6c2.2 1.3 4.5 2.8 6.8 4.6V0H14.1C6.3.0.0 6.3.0 14.1v36.4c6.5 1.7 14.2 4.5 22 9.1z" class="st9"/><path id="path29" d="M5.4 87.5c-1.8-1.1-3.6-2-5.4-2.8v15.9c0 7.8 6.3 14.1 14.1 14.1h11.6c-3.6-12.2-10.4-21.3-20.3-27.2z" class="st9"/></g><g id="g30"><path id="path30" d="M201.7 109c-30.8.0-53.7-21.2-53.7-52.5.0-31.7 22.9-51.6 53.7-51.6 31 0 53.9 20 53.9 51.6-.1 31.3-23 52.5-53.9 52.5zm0-82.6c-16.7.0-28.2 12.8-28.2 30.1.0 17.9 11.6 30.7 28.2 30.7S230 74.4 230 56.6c0-17.3-11.6-30.2-28.3-30.2z" class="st9"/></g><g id="g32"><g id="g31"><path id="path31" d="M334.3 33.3c-4-5.2-11.4-8.5-17.6-8.5-6.2.0-13.8 2.1-13.8 9.9.0 6.6 5.9 8.7 15.2 11.6 13.4 4.3 30.7 10 30.7 29.7.0 22.7-18.3 32.9-37.8 32.9-14.1.0-28.3-5.2-37-14.2l15.6-15.9c4.7 6 13.5 10.5 21.3 10.5 7.3.0 13.7-2.8 13.7-10.7.0-7.5-7.5-9.9-20.5-14.1C291.6 60.3 279 53.9 279 36c0-21.9 19.8-31 38.2-31 11.2.0 23.7 4.2 32.4 12.1z" class="st9"/></g></g><g id="g34"><g id="g33"><path id="path32" d="m433.1 106.4-21.3-39.2h-8.1v39.2h-23.4V7.6H418c19 0 37.8 7.3 37.8 29.9.0 13.3-7.8 22.7-20.5 26.6l25.8 42.3zm-16.9-79.6h-12.7v23h11.3c7.7.0 17.3-2 17.3-12 0-9.2-8.7-11-15.9-11z" class="st9"/></g></g><g id="g35"><path id="path34" d="M522.2 106.4h-36.8V7.6H521c28 0 56.5 11.7 56.5 49.1.0 34.7-28.1 49.7-55.3 49.7zm-1.7-78.5h-11.9v57.8h11.3c17 0 32.8-7 32.8-29 0-22.2-15.8-28.8-32.2-28.8z" class="st9"/></g></g></g></svg></span><span class=navbar-brand__name>OSRD</span></a><div class="td-navbar-nav-scroll ms-md-auto" id=main_navbar><ul class=navbar-nav><li class=nav-item><a class=nav-link href=/fr/about/><span>À propos</span></a></li><li class=nav-item><a class="nav-link active" href=/fr/docs/><span>Documentation</span></a></li><li class=nav-item><a class=nav-link href=/fr/blog/><span>Blog</span></a></li><li class=nav-item><a class=nav-link href=/fr/join-us/><span>Rejoignez-nous</span></a></li><li class="nav-item dropdown d-none d-lg-block"><div class=dropdown><a class="nav-link dropdown-toggle" href=# role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false>Français</a><ul class=dropdown-menu><li><a class=dropdown-item href=/en/docs/guides/contribute/contribute-code/>English</a></li></ul></div></li></ul></div><div class="d-none d-lg-block"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder=Rechercher aria-label=Rechercher autocomplete=off data-offline-search-index-json-src=/offline-search-index.12175a96ac22fb18c0e038474465b0e3.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>Version imprimable multipages.
<a href=# onclick="return print(),!1">Cliquer ici pour imprimer</a>.</p><p><a href=/fr/docs/guides/contribute/contribute-code/>Retour à la version par défaut</a>.</p></div><h1 class=title>Contribuer au code</h1><div class=lead>Apporter des modifications au code d&rsquo;OSRD</div><ul><li>1: <a href=#pg-b3865e3b665eac02431c0e1a2b49dbde>Principes généraux</a></li><li>2: <a href=#pg-28c5c56e84e8a12ef3e3824e0c15eda3>Conventions back-end</a></li><li>3: <a href=#pg-14c3b96b1f8a7ac7ac971afe801849db>Conventions front-end</a></li><li>4: <a href=#pg-baa7dfe57fa41f763127154fe6dc4e7b>Écrire du code</a></li><li>5: <a href=#pg-1c2be5f2cd6600262d973426390f5a3b>Conventions de commits</a></li><li>6: <a href=#pg-6334dadf8018c47abf554cd3015be6bd>Partagez vos changements</a></li><li>7: <a href=#pg-c9ed9175ac241f91b9cc8c4412a1e488>Tests</a></li></ul><div class=content><p>Ce chapitre décrit le processus aboutissant à l&rsquo;intégration de code au sein du projet. <strong>Si vous avez besoin d&rsquo;aide, ouvrez une issue ou envoyez un message instantané.</strong></p><p>L&rsquo;application OSRD est divisée en plusieurs services écrits dans plusieurs langues. Nous essayons de suivre les bonnes pratiques générales en matière de code et de respecter les spécificités de chaque langage lorsque cela est nécessaire.</p></div></div><div class=td-content style=page-break-before:always><h1 id=pg-b3865e3b665eac02431c0e1a2b49dbde>1 - Principes généraux</h1><div class=lead>À lire en premier !</div><ul><li>Expliquez ce que vous faites et pourquoi.</li><li>Documentez le nouveau code.</li><li>Ajoutez des tests clairs et simples.</li><li>Décomposez le travail en morceaux intelligibles.</li><li>Prenez le temps de choisir de bons noms.</li><li>Évitez les abréviations peu connues.</li><li><strong>Contrôle et cohérence de la réutilisation du code de tiers</strong> : une dépendance est ajoutée seulement si elle est absolument nécessaire.</li><li>Chaque dépendance ajoutée diminue notre autonomie et notre cohérence.</li><li>Nous essayons de limiter à un petit nombre les PRs de mise à jour des dépendances chaque semaine
dans chaque composant, donc regrouper les montées de version dans une même PR est une bonne option
(reportez-vous au <code>README.md</code> de chaque composant).</li><li><strong>Ne pas réinventer la roue</strong> : en opposition au point précédent, ne réinventez pas tout à tout prix.</li><li>S&rsquo;il existe une dépendance dans l&rsquo;écosystème qui est le standard « de facto », nous devrions fortement envisager de l&rsquo;utiliser.</li><li>Plus de code et de recommandations générales dans le dépôt principal <a href=https://github.com/OpenRailAssociation/osrd/blob/dev/CONTRIBUTING.md>CONTRIBUTING.md</a>.</li><li>Demandez toute l&rsquo;aide dont vous avez besoin !</li></ul><p><em><a href=https://osrd.fr/fr/docs/guides/contribute/contribute-code/backend-conventions/>Consulter les conventions pour le back-end ‣</a></em></p><p><em><a href=https://osrd.fr/fr/docs/guides/contribute/contribute-code/frontend-conventions/>Consulter les conventions pour le front-end ‣</a></em></p><p><em><a href=https://osrd.fr/fr/docs/guides/contribute/contribute-code/write-code/>Continuer vers l&rsquo;écriture de code ‣</a></em></p><p><em><a href=https://osrd.fr/fr/docs/guides/contribute/contribute-code/tests/>Continuer vers l&rsquo;écriture de tests ‣</a></em></p></div><div class=td-content style=page-break-before:always><h1 id=pg-28c5c56e84e8a12ef3e3824e0c15eda3>2 - Conventions back-end</h1><div class=lead>Conventions de codes et bonnes pratiques pour le back-end</div><h1 id=python>Python</h1><p>Le code Python est utilisé pour certains paquets et pour les tests d&rsquo;intégration.</p><ul><li>Suivez le <a href=https://www.python.org/dev/peps/pep-0020/>Zen of Python</a>.</li><li>Les projets sont organisés avec <a href=https://docs.astral.sh/uv/>uv</a></li><li>Le code est linté avec <a href=https://docs.astral.sh/ruff/>ruff</a>.</li><li>Le code est formaté avec <a href=https://docs.astral.sh/ruff/>ruff</a>.</li><li>Les tests sont écrits avec <a href=https://docs.pytest.org/>pytest</a>.</li><li>Les types sont vérifiés avec <a href=https://microsoft.github.io/pyright/>pyright</a>.</li></ul><h1 id=rust>Rust</h1><ul><li>Comme référence pour le développement de notre API, nous utilisons les <a href=https://rust-lang.github.io/api-guidelines/about.html>Rust API guidelines</a>.
D&rsquo;une manière générale, il convient de les respecter.</li><li>Préférer les importations granulaires aux importations globales comme <code>diesel::*</code>.</li><li>Les tests sont écrits avec le <a href=https://doc.rust-lang.org/book/ch11-01-writing-tests.html>framework de base</a>.</li><li>Utilisez l&rsquo;<a href=https://doc.rust-lang.org/rust-by-example/meta/doc.html>exemple de documentation</a> pour savoir comment formuler et formater votre documentation.</li><li>Utilisez un style de commentaire cohérent :<ul><li><code>///</code> les commentaires de la documentation sont au-dessus des invocations <code>#[derive(Trait)]</code>.</li><li>Les commentaires <code>//</code> doivent généralement être placés au-dessus de la ligne en question, plutôt qu&rsquo;en ligne.</li><li>Les commentaires commencent par des lettres majuscules.
Terminez-les par un point s&rsquo;ils ressemblent à une phrase.</li></ul></li><li>Utilisez les commentaires pour organiser des portions de code longues et complexes qui ne peuvent être raisonnablement remaniées en fonctions distinctes.</li><li>Le code est linté avec <a href=https://github.com/rust-lang/rust-clippy>clippy</a>.</li><li>Le code est formaté avec <a href=https://github.com/rust-lang/rustfmt>fmt</a>.</li></ul><h1 id=java>Java</h1><ul><li>Le code est formaté avec <a href=https://checkstyle.sourceforge.io/>checkstyle</a>.</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-14c3b96b1f8a7ac7ac971afe801849db>3 - Conventions front-end</h1><div class=lead>Conventions de codes et bonnes pratiques pour le front-end</div><p>Nous utilisons <strong>ReactJS</strong> et tous les fichiers doivent être écrits en <strong>Typescript</strong>.</p><p>Le code est <em>linté</em> avec <a href=https://eslint.org/>eslint</a>, et <strong>formaté</strong> avec <a href=https://prettier.io/>prettier</a>.</p><h2 id=nomenclature>Nomenclature</h2><p><img src=/images/docs/contribute/nomenclature-front-end.svg alt="Diagramme de l’Infrastructure"></p><p>Les <strong>applications</strong> (osrd eex, osrd stdcm, éditeur infra, éditeur matériel) proposent des <strong>vues</strong> (gestion des projets, gestions des études, etc.) liées à des <strong>modules</strong> (projet, étude, etc.) qui contiennent les composants.</p><p>Ces <strong>vues</strong> sont constituées de <strong>composants</strong> et sous-composants <u>tous issus des modules</u>.
En plus de contenir les fichiers de <strong>vues</strong> des applications, elles peuvent contenir un répertoire <strong>scripts</strong> qui propose des scripts liés à ces vues. Les <strong>vues</strong> déterminent la logique et l&rsquo;<u>accès au store</u>.</p><p>Les <strong>modules</strong> sont des collections de <strong>composants</strong> rattachés à un <strong>objet</strong> (un scénario, un matériel roulant, un TrainSchedule). Ils contiennent :</p><ul><li>un répertoire <em>components</em> qui héberge <u>tous</u> les composants</li><li>un répertoire <em>styles</em> optionnel <u>par module</u> pour le style des composants en scss</li><li>un répertoire <em>assets</em> optionnel <u>par module</u> (qui contient les assets, de jeux de données par défaut par ex, spécifiques au module)</li><li>un fichier <em>reducers</em> optionnel <u>par module</u></li><li>un fichier <em>types</em> optionnel <u>par module</u></li><li>un fichier <em>consts</em> optionnel <u>par module</u></li></ul><p>Un répertoire <strong>assets</strong> (qui contient les images et autre fichiers).</p><p>Enfin, un répertoire <strong>common</strong> qui propose :</p><ul><li>un répertoire <em>utils</em> pour les fonctions utilitaires communes à l&rsquo;ensemble du projet</li><li>un fichier <em>types</em> pour les types communs à l&rsquo;ensemble du projet</li><li>un fichier <em>consts</em> pour les constantes communes à l&rsquo;ensemble du projet</li></ul><h2 id=principes-dimplémentation>Principes d&rsquo;implémentation</h2><h3 id=naming>Naming</h3><p>On utilise en général les conventions suivantes dans le code:</p><ul><li>les composants et les types sont en PascalCase</li><li>les variables sont en camelCase</li><li>les clés de traduction sont en camelCase également</li><li>les constantes sont en SCREAMING_SNAKE_CASE (sauf cas particulier)</li><li>les classes css sont en kebab-case</li></ul><h3 id=styles--scss>Styles & SCSS</h3><blockquote><p>ATTENTION : en CSS/React, le scope d&rsquo;une classe ne dépend pas de l&rsquo;endroit où le fichier est importé mais est valide pour toute l&rsquo;application. Si vous importez un fichier <code>scss</code> au fin fond d&rsquo;un composant (ce que nous déconseillons fortement par ailleurs), ses classes seront disponibles pour toute l&rsquo;application et peuvent donc provoquer des effets de bord.</p></blockquote><p>Il est donc très recommandé de pouvoir facilement suivre l&rsquo;arborescence des applications, vues, modules et composants également au sein du code SCSS, et notamment imbriquer les noms de classes pour éviter les effets de bord.</p><p>Quelques conventions supplémentaires:</p><ul><li>toutes les tailles sont exprimées en px, sauf pour les polices que l&rsquo;on exprime en rem.</li><li>nous utilisons la bibliothèque <a href=https://github.com/JedWatson/classnames>classnames</a> pour appliquer conditionnellement des classes : les classes sont <strong>séparées</strong> chacune dans un <code>string</code> et les opérations booléennes ou autres sont réalisées dans un objet qui retournera — ou pas — le nom de propriété comme nom de classe à utiliser dans le CSS.</li></ul><h3 id=storeredux>Store/Redux</h3><p>Le store permet de stocker des données qui seront accessibles à n&rsquo;importe quel endroit de l&rsquo;application. Il est découpé en slices, qui correspondent à nos applications.</p><p>Attention cependant à ce que notre store ne devienne pas un fourre-tout.
L&rsquo;ajout de nouvelles propriétés dans le store doit être justifié par le fait que la donnée en question est &ldquo;haut-niveau&rdquo; et devra être accessible depuis des endroits éloignés de la code base, et qu&rsquo;une simple variable de state ou de contexte ne soit pas pertinent pour stocker cette information.</p><p>Pour plus de détails, nous vous invitons à consulter la <a href=https://redux.js.org/>documentation officielle</a>.</p><h3 id=redux-toolkit-rtk>Redux ToolKit (RTK)</h3><p>Nous utilisons <a href=https://redux-toolkit.js.org/>Redux ToolKit</a> pour réaliser nos appels au backend.</p><p>RTK permet notamment de faire des appels à l&rsquo;api et de mettre en cache les réponses. Pour plus de détails, nous vous invitons à consulter la <a href=https://redux-toolkit.js.org/rtk-query/overview>documentation officielle</a>.</p><p>Les endpoints et les types du backend sont générés directement à partir de l&rsquo;open-api d&rsquo;editoast et stockés dans <code>generatedOsrdApi</code> (avec la commande <code>npm run generate-types</code>). Ce fichier généré est ensuite enrichi par d&rsquo;autres endpoints ou types dans <code>osrdEditoastApi</code>, qui peuvent être utilisés dans l&rsquo;application.
A noter qu&rsquo;il est possible de transformer des mutations en queries lors de la génération de generatedOsrdApi en modifiant le fichier <code>openapi-editoast-config</code>.</p><p>Lorsqu&rsquo;un appel d&rsquo;endpoint doit être skip parce qu&rsquo;une variable n&rsquo;est pas définie, on utilise <a href=https://redux-toolkit.js.org/rtk-query/usage-with-typescript#skipping-queries-with-typescript-using-skiptoken>skipToken</a> de RTK pour éviter de devoir mettre des casts.</p><h3 id=traduction-de-lapplication>Traduction de l&rsquo;application</h3><p>La traduction de l&rsquo;application est effectuée sur <a href=https://hosted.weblate.org/projects/osrd/>Weblate</a>.</p><h3 id=imports>Imports</h3><p>Il est recommandé d&rsquo;utiliser le chemin complet pour chaque import, sauf si votre fichier à importer est dans le même répertoire.</p><p>ESLint est configuré pour trier automatiquement les imports en 4 groupes, séparés par une ligne vide et chacun trié alphabétiquement :</p><ul><li>React</li><li>Librairies externes</li><li>Fichiers internes en chemin absolu</li><li>Fichiers internes en chemin relatif</li></ul><p>Concernant l&rsquo;import/export de types, ESLint et Typescript sont configurés de manière à ajouter automatiquement <code>type</code> devant un import de types, ce qui permet de:</p><ul><li>Améliorer les performances et le travail d’analyse du compilateur et du linter.</li><li>Rendre ces déclarations plus lisibles, on voit clairement ce qu’on est en train d’importer.</li><li>Alléger le bundle final (tous les types disparaissent à la compilation).</li><li>Éviter des cycles de dépendances (ex: l&rsquo;erreur disparaît avec le mot clé <code>type</code>)
<img src=/images/docs/contribute/dependency-cycle.png alt="dependency cycle"> <img src=/images/docs/contribute/dependency-cycle-gone.png alt="dependency cycle gone"></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-baa7dfe57fa41f763127154fe6dc4e7b>4 - Écrire du code</h1><div class=lead>Apporter des modifications au code d&rsquo;OSRD</div><ol><li><p>Si vous n&rsquo;être pas un habitué de Git, <a href=https://learngitbranching.js.org/>suivez ce tutoriel</a></p></li><li><p><strong>Créez une branche</strong><br>Si vous comptez contribuer régulièrement, vous pouvez demander accès au <a href=https://github.com/OpenRailAssociation/osrd>dépôt principal</a>. Sinon, <a href=https://github.com/OpenRailAssociation/osrd/fork>créez un fork</a>.</p></li><li><p><strong>Ajoutez des changements sur votre branche</strong><br>Essayez de découper votre travail en étapes macroscopiques, et sauvegardez vos changements dans un commit à la fin de chaque étape. Essayez de suivre <a href=../conventions/>les conventions du projet</a>.</p></li><li><p><strong>Conservez votre branche à jour</strong></p><pre tabindex=0><code>git switch &lt;your_branch&gt;
git fetch
git rebase origin/dev
</code></pre></li></ol><p><em><a href=https://osrd.fr/fr/docs/guides/contribute/contribute-code/commit-conventions/>Continuer vers le style des commits ‣</a></em></p></div><div class=td-content style=page-break-before:always><h1 id=pg-1c2be5f2cd6600262d973426390f5a3b>5 - Conventions de commits</h1><div class=lead>Quelques bonnes pratiques et règles pour les messages de commits</div><h2 id=style-de-commits>Style de commits</h2><p>Le format général des commits est le suivant :</p><pre tabindex=0><code>composant1, composant2: description du changement à l&#39;impératif

Description détaillée ou technique du contenu et de la motivation du
changement, si le titre n&#39;est pas complètement évident.
</code></pre><ul><li><strong>le message comme le code doit être en anglais</strong> (seulement des caractères ASCII pour le titre)</li><li>il peut y avoir plusieurs composants, séparés par des <code>:</code> quand il y a une relation hiérarchique, ou des <code>,</code> sinon</li><li>les composants sont en minuscule, avec éventuellement <code>-</code>, <code>_</code> ou <code>.</code></li><li>la description du changement à l&rsquo;impératif commence par un verbe en minuscule</li><li>le titre ne doit pas comporter de lien (<code>#</code> est interdit)</li></ul><p>Idéalement :</p><ul><li>le titre doit être autonome : pas besoin de lire autre chose pour le comprendre</li><li>le titre du commit est entièrement en minuscule</li><li>le titre est clair pour une personne étrangère au code</li><li>le corps du commit contient une description du changement</li></ul><div class="alert alert-info" role=alert>Une vérification automatique est effectuée pour vérifier autant que possible ce formatage.</div><h3 id=contre-exemples-de-titres-de-commit>Contre-exemples de titres de commit</h3><p>A éviter absolument:</p><ul><li><code>component: update ./some/file.ext</code> : préciser la mise à jour en question plutôt que le fichier,
les fichiers sont des éléments techniques bienvenus dans le <em>corps</em> du commit</li><li><code>component: fix #42</code> : préciser le problème corrigé, les liens (vers l&rsquo;issue, etc.) sont
encouragés dans le <em>corps</em> du commit</li><li><code>wip</code> : décrire le travail (et le finir)</li></ul><p>Bienvenus pour faciliter la relecture, mais ne pas merger:</p><ul><li><code>fixup! previous commit</code> : un <a href=../share-changes>autosquash</a> devra être lancé avant le merge</li><li><code>Revert "previous commit of the same PR"</code> : les deux commits devront être retirés avant merge</li></ul><h2 id=le-developer-certificate-of-origin-dco>Le Developer Certificate of Origin (DCO)</h2><p>Tous les projets d&rsquo;OSRD utilisent le DCO (certificat du développeur d&rsquo;origine)
pour des raisons légales. Le DCO permet de confirmer que vous avez les droits
sur le code que vous contribuez. Pour en savoir plus sur l&rsquo;histoire et
l&rsquo;objectif du DCO, vous pouvez lire <a href=https://bssw.io/blog_posts/the-developer-certificate-of-origin>The Developer Certificate of Origin</a>
de Roscoe A. Bartlett.</p><p>Pour se conformer au DCO, <strong>tous les commits doivent inclure une ligne
Signed-off-by</strong>.</p><h3 id=comment-signer-un-commit-avec-git-dans-un-terminal->Comment signer un commit avec Git dans un terminal ?</h3><p>Pour signer un commit, il suffit d&rsquo;ajouter l&rsquo;option <code>-s</code> à votre commande <code>git commit</code>, comme ceci :</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>git commit -s -m <span style=color:#4e9a06>&#34;Your commit message&#34;</span>
</span></span></code></pre></div><p>Cela s&rsquo;applique également lors de l&rsquo;utilisation de la commande <code>git revert</code>.</p><h3 id=comment-signer-un-commit-avec-git-dans-visual-studio-code-vs-code->Comment signer un commit avec Git dans Visual Studio Code (VS Code) ?</h3><p>Allez dans <code>Fichiers</code> -> <code>Préférences</code> -> <code>Paramètres</code>, puis recherchez et
activez le paramètre <strong>Always Sign Off</strong>.</p><p>Ensuite, lorsque vous ferez un commit via l&rsquo;interface de VS Code, ils seront
automatiquement signés.</p><p><em><a href=https://osrd.fr/fr/docs/guides/contribute/contribute-code/share-changes/>Continuer vers le partage des changements ‣</a></em></p></div><div class=td-content style=page-break-before:always><h1 id=pg-6334dadf8018c47abf554cd3015be6bd>6 - Partagez vos changements</h1><div class=lead>Comment soumettre votre code pour qu&rsquo;il soit vérifié ?</div><p>L&rsquo;auteur d&rsquo;une <em>pull request (PR)</em> est responsable de son « cycle de vie ». Il se charge de contacter les différents acteurs, de suivre la revue de code, répondre aux commentaires et corriger le code suite à la revue de code (vous pouvez également consulter la <a href=https://osrd.fr/fr/docs/guides/contribute/code-review/>page dédiée à la revue de code</a>).</p><ol><li><p><strong>Ouvrez une <em>pull request</em></strong><br>Une fois que vos changements sont prêts, il est temps de proposer de les intégrer à la branche <code>dev</code>.
Cela se fait <a href=https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/proposing-changes-to-your-work-with-pull-requests/creating-a-pull-request>dans l&rsquo;interface web de Github</a>.</p><p>Si possible :</p><ul><li>Faites des PRs d&rsquo;unités logiques et atomiques également (évitez de mélanger le refactoring, les nouvelles fonctionnalités et la correction de bugs en même temps).</li><li>Ajoutez une description aux PR pour expliquer ce qu&rsquo;elles font et pourquoi.</li><li>Aidez le relecteur en suivant les conseils donnés dans <a href=https://mtlynch.io/code-review-love/>l&rsquo;article de mtlynch</a>.</li><li>Ajoutez les balises <code>area:&lt;affected_area></code> pour montrer quelle partie de l&rsquo;application a été impactée. Cela peut être fait via <a href=https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/proposing-changes-to-your-work-with-pull-requests/creating-a-pull-request>l&rsquo;interface web</a>.</li></ul></li><li><p><strong>Prenez en compte les retours</strong><br>Une fois que votre PR est ouverte, <a href=https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/reviewing-changes-in-pull-requests/about-pull-request-reviews>d&rsquo;autres contributeurs doivent donner leur avis sur votre proposition</a> :</p><ul><li>N&rsquo;importe qui peut donner son avis.</li><li>Il est nécessaire d&rsquo;obtenir l&rsquo;approbation d&rsquo;un <a href=https://github.com/OpenRailAssociation/osrd/blob/dev/.github/CODEOWNERS>contributeur familier avec le code</a>.</li><li>Il est d&rsquo;usage de prendre en compte tous les commentaires critiques.</li><li>Les commentaires sont souvent écrits dans un style plutôt direct, dans le souci de collaborer efficacement vers une solution acceptable par tous.</li><li>Une fois que tous les commentaires ont été pris en compte, un mainteneur intègre le changement.</li></ul></li></ol><blockquote><p>Dans l&rsquo;idéal, évitez les PR conséquentes et découpez le travail en plusieurs PR<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> :</p><ul><li>facilite la relecture et peut aussi l&rsquo;accélérer (plus facile de trouver 1 heure pour faire une relecture qu&rsquo;une demi-journée),</li><li>permet une approche plus agile avec des retours sur les premières itérations avant d&rsquo;enchaîner sur la suite,</li><li>garde un historique git plus simple à explorer (notamment lors d&rsquo;un <code>git bisect</code> à la recherche d&rsquo;une regression par exemple).</li></ul><p>En cas d&rsquo;impossibilité à éviter une PR conséquente, ne pas hésiter à solliciter plusieurs relecteurs qui pourront s&rsquo;organiser, voire de faire la relecture ensemble, relecteurs et auteur.</p><p>Sur les PR conséquentes et vouées à évoluer dans le temps, conserver les <em>corrections</em> suite à la
relecture dans des <em>commits séparés</em> facilite le travail de relecture. En cas de <code>rebase</code> et de
relectures multiples par la même personne ils sont le moyen d&rsquo;économiser une nouvelle relecture
complète (demandez de l&rsquo;aide au besoin) :</p><ul><li><em>Ajoutez des commits de fixup</em>, amend, squash ou reword à l&rsquo;aide de la
<a href=https://git-scm.com/docs/git-commit#Documentation/git-commit.txt---fixupamendrewordltcommitgt>documentation dédiée à git commit</a>.</li><li><em>Fusionnez automatiquement les corrections</em> dans les commits originaux de votre PR et vérifier le résultat , à l&rsquo;aide de
<a href=https://git-scm.com/docs/git-rebase#Documentation/git-rebase.txt---autosquash><code>git rebase -i --autosquash origin/dev</code></a>
(juste avant le merge et une fois les relectures terminées).</li><li><em>Poussez vos changements</em> avec
<a href=https://git-scm.com/docs/git-push#Documentation/git-push.txt---no-force-with-lease><code>git push --force-with-lease</code></a>
car vous ne poussez pas seulement de nouveaux commits, mais bien un changement des commits existants.</li></ul></blockquote><ol start=3><li><strong>N&rsquo;hésitez pas à relancer vos interlocuteurs, plusieurs fois si besoin est : vous êtes responsable de la vie de votre <em>pull request</em></strong>.</li></ol><h2 id=cycle-de-review>Cycle de review</h2><p>Une revue de code est un processus itératif.
Pour la fluidité d&rsquo;une review, il est impératif de <a href=https://docs.github.com/en/account-and-profile/managing-subscriptions-and-notifications-on-github/setting-up-notifications/configuring-notifications>configurer correctement ses notifications github</a>.</p><p>Il est conseillé de configurer les dépôts OSRD en <em>&ldquo;Participating and @mentions&rdquo;</em>. Cela permet d&rsquo;être notifié d&rsquo;activités uniquement sur les issues et PR auxquelles vous participez.</p><pre class=mermaid>sequenceDiagram
  actor A as Auteur PR
  actor R as Reviewer/mainteneur

  A-&gt;&gt;R: Demande une review en notifiant spécifiquement quelques personnes
  R-&gt;&gt;A: Répond à la demande par oui ou non

  loop Boucle entre auteur et reviewer
    R--&gt;&gt;A: Commente, demande des changements
    A--&gt;&gt;R: Répond à chaque commentaire/demande de changement
    A--&gt;&gt;R: Corrige le code si nécessaire dans des « fixups » dédiés
    R--&gt;&gt;A: Vérifie, teste, et commente à nouveau le code
    R--&gt;&gt;A: Résout les conversations/demandes de changement le cas échéant
  end

  A-&gt;&gt;R: Rebase si nécessaire
  R-&gt;&gt;A: Vérifie l&#39;historique des commits
  R-&gt;&gt;A: Approuve la PR
  Note right of A: Ajoute à la merge queue</pre><blockquote><p>Les mainteneurs sont automatiquement notifiés par le système de <code>CODEOWNERS</code>. L&rsquo;auteur d&rsquo;une PR est responsable de faire avancer sa PR dans le processus de review (quitte à notifier manuellement un mainteneur).</p></blockquote><p><em><a href=https://osrd.fr/fr/docs/guides/contribute/contribute-code/tests/>Continuer enfin vers les tests ‣</a></em></p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>si vous n&rsquo;êtes pas convaincus, cherchez &ldquo;Stacked Diff&rdquo; sur le web pour plus de détails sur le sujet, comme <a href=https://medium.com/@alexanderjukes/stacked-diffs-vs-trunk-based-development-f15c6c601f4b>Stacked Diffs vs. Trunk Based Development (en)</a>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div><div class=td-content style=page-break-before:always><h1 id=pg-c9ed9175ac241f91b9cc8c4412a1e488>7 - Tests</h1><div class=lead>Recommandations pour les tests</div><h2 id=back-end>Back-end</h2><ul><li>Les tests d&rsquo;intégration sont écrits avec <a href=https://docs.pytest.org/>pytest</a> dans le dossier <code>/tests</code>.</li><li>Chaque route décrite dans les fichiers <code>openapi.yaml</code> doit avoir un test d&rsquo;intégration.</li><li>Le test doit vérifier à la fois le format et le contenu des réponses valides et invalides.</li></ul><h2 id=front-end>Front-end</h2><p>L&rsquo;écriture fonctionnelle des tests est réalisée avec les <em>Product Owners</em>, et les développeurs choisissent une implémentation technique qui répond précisément aux besoins exprimés et qui s&rsquo;intègre dans les recommandations présentes ici.</p><p>Nous utilisons <a href=https://playwright.dev/>Playwright</a> pour écrire les tests bout en bout, et <a href=https://vitest.dev/>vitest</a> pour écrire les tests unitaires.</p><p>Les navigateurs testés sont pour l&rsquo;instant <a href=https://www.mozilla.org/fr/firefox/switch/>Firefox</a> et Chromium.</p><h3 id=principes-de-base>Principes de base</h3><ul><li>Les tests doivent être <strong>courts</strong> (1min max) et aller <strong>droit au but</strong>.</li><li>Les timeout arbitraires sont proscrits, un test doit systématiquement attendre un évènement spécifique. Il est possible d&rsquo;utiliser le <em>polling</em> (retenter une action — un clic par exemple — au bout d&rsquo;un certain temps) proposé dans l&rsquo;API de <a href=https://playwright.dev/>Playwright</a>.</li><li>Les tests doivent tous pouvoir être parallélisables.</li><li>Les tests ne doivent pas pointer/attendre des éléments de texte issus de la traduction, préférer l&rsquo;arborescence du <em>DOM</em> ou encore placer des <code>id</code> spécifiques.</li><li>On ne teste pas les données mais l&rsquo;application et ses fonctionnalités. Des tests spécifiques aux données sont à élaborer par ailleurs.</li></ul><h4 id=données>Données</h4><p><strong>Les données testées doivent impérativement être des données publiques.</strong>
Les données nécessaires (infrastructure et matériel) aux tests sont proposées dans des fichiers <code>json</code> de l&rsquo;application, <em>injectées</em> au début de chaque test et effacées à la fin peu importe son résultat ou la manière d&rsquo;être stoppé, y compris par <code>CTRL+C</code>.</p><p>Cela se fait par des appels API en typescript avant de lancer le test à proprement parler.</p><p>Les données testées sont les mêmes en local ou via l&rsquo;intégration continue.</p><h4 id=processus-de-développement-des-tests-e2e>Processus de développement des tests e2e</h4><p>Les tests e2e sont implémentés de manière itérative, et livrés en même temps que les développements. À noter que:</p><ul><li>les tests e2e ne doivent être développés que sur les parcours utilisateurs critiques de l&rsquo;application.</li><li>ce workflow permet d’éviter les régressions immédiates après la sortie d&rsquo;une fonctionnalité, de faire monter toute l’équipe en compétences sur les tests e2e et d’éviter des PRs très longues qui ajouteraient des tests e2e entiers</li><li>on accepte que les tests e2e soient partiels le temps des développements et que le développement des tests alourdisse la taille des tickets et le temps de développement.</li><li>certaines parties du test devront être mockées le temps que la fonctionnalité soit entièrement développée mais à la fin des développements, le test e2e devra être complet et les données mockées devront avoir disparu. Les modifications finales à faire dans le test pour retirer le mocking seront normalement minimes (uniquement changer les expected values).</li><li>dans le cas de l&rsquo;ajout d&rsquo;une nouvelle fonctionnalité, il est préférable de séparer en des commits individuels l&rsquo;implémentation de la nouvelle fonctionnalité et les tests afin de faciliter la review.</li><li>les cas de test et les parcours utilisateur devront être définis en amont, au moment de la conception du ticket (<em>refinement</em>), avant le PIP. Ils pourront être proposés par un QA ou un.e PO, et devront être validés par un QA, le.la PO compétent.e et des devs front.</li><li>si un test e2e touche à la configuration des tests e2e, à l’architecture du projet (typiquement le snapshotting) ou présente un risque de ralentir la CI, un atelier de conception (<em>refinement</em>) devra être organisé pour consulter les personnes en charge de l&rsquo;architecture du projet et de la CI, notamment la team devops.</li></ul><h4 id=atomicité-dun-test>Atomicité d&rsquo;un test</h4><p>Chaque test doit être <strong>atomique</strong> : il se suffit à lui-même et ne peut pas être divisé.</p><p>Un test va cibler une fonctionnalité ou un composant, si ce dernier n&rsquo;est pas trop gros. Un test ne testera pas tout un module ou tout une application, ce sera forcément un ensemble de tests afin de préserver l&rsquo;atomicité des tests.</p><p>Si un test a besoin que des éléments soient créés ou ajoutés, ces opérations doivent être opérées par des appels API en typescript en amont du test, à l&rsquo;instar de ce qui est fait pour l&rsquo;ajout de données. Ces éléments doivent être supprimés à l&rsquo;issue du test, peu importe son résultat ou la manière d&rsquo;être stoppé, y compris par <code>CTRL+C</code>.</p><p>Cela permettra notamment la parallélisation des tests.</p><p>Un test peut cependant, dans certains cas de figure où cela est pertinent, contenir plusieurs sous-divisions de test, clairement explicitées, et justifiées (plusieurs <code>test()</code> dans un seul <code>describe()</code>).</p><h3 id=exemple-de-test>Exemple de test</h3><p>Le besoin : « nous voulons tester l&rsquo;ajout d&rsquo;un train dans une grille horaire ».</p><ol><li>ajouter l&rsquo;infrastructure et le matériel roulant de test dans la base de données <strong>par appels API</strong></li><li>créer projet, étude et scénario avec choix de l&rsquo;infra de test <strong>par appels API</strong></li><li>début du test qui clique sur « ajouter un ou plusieurs trains » jusqu&rsquo;à la vérification de la présence des trains dans la grille horaire</li><li>le test a réussi, a échoué, ou est stoppé, le projet, l&rsquo;étude et le scénario sont effacés, ainsi que le matériel roulant et et l&rsquo;infrastructure de test <strong>par appels API</strong></li></ol><p><em>NB : le test ne va pas tester toutes les possibilités offertes par l&rsquo;ajout de trains, cela relève d&rsquo;un test spécifique qui testerait la réponse de l&rsquo;interface pour tous les cas de figure sans ajouter de trains.</em></p><p><em><a href=https://osrd.fr/fr/docs/guides/contribute/contribute-code/write-code/>Continuer vers l&rsquo;écriture de code ‣</a></em></p></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="td-footer__left col-6 col-sm-4 order-sm-1"></div><div class="td-footer__right col-6 col-sm-4 order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=GitHub aria-label=GitHub><a target=_blank rel=noopener href=https://github.com/OpenRailAssociation/osrd aria-label=GitHub><i class="fab fa-github"></i></a></li></ul></div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2"><span class=td-footer__copyright>&copy;
2025
<span class=td-footer__authors>Contributeur·ices à OSRD</span></span><span class=td-footer__all_rights_reserved>Tous droits réservés</span></div></div></div></footer></div><style>.markmap>svg{width:100%;height:300px}</style><script>window.markmap={autoLoader:{manual:!0,onReady(){const{autoLoader:e,builtInPlugins:t}=window.markmap;e.transformPlugins=t.filter(e=>e.name!=="prism")}}}</script><script src=https://cdn.jsdelivr.net/npm/markmap-autoloader></script><script src=/js/main.min.70982f4f1de53d56b47d6b66c1ed442a9653a5be8820e0ba651d5d17d9a9bbe1.js integrity="sha256-cJgvTx3lPVa0fWtmwe1EKpZTpb6IIOC6ZR1dF9mpu+E=" crossorigin=anonymous></script><script defer src=/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script><script src=/js/tabpane-persist.js></script></body></html>