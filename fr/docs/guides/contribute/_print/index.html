<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=fr class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=canonical type=text/html href=https://osrd.fr/fr/docs/guides/contribute/><link rel=alternate type=application/rss+xml href=https://osrd.fr/fr/docs/guides/contribute/index.xml><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Contribuer à OSRD | OSRD</title>
<meta name=description content="Comment apporter sa pierre à l'édifice"><meta property="og:url" content="https://osrd.fr/fr/docs/guides/contribute/"><meta property="og:site_name" content="OSRD"><meta property="og:title" content="Contribuer à OSRD"><meta property="og:description" content="Comment apporter sa pierre à l'édifice"><meta property="og:locale" content="fr"><meta property="og:type" content="website"><meta itemprop=name content="Contribuer à OSRD"><meta itemprop=description content="Comment apporter sa pierre à l'édifice"><meta name=twitter:card content="summary"><meta name=twitter:title content="Contribuer à OSRD"><meta name=twitter:description content="Comment apporter sa pierre à l'édifice"><link rel=preload href=/scss/main.min.48e4394a6d7434765a152dc0a5126083c99b73e5ace11fdd6da0f8a64fa9f30f.css as=style integrity="sha256-SOQ5Sm10NHZaFS3ApRJgg8mbc+Ws4R/dbaD4pk+p8w8=" crossorigin=anonymous><link href=/scss/main.min.48e4394a6d7434765a152dc0a5126083c99b73e5ace11fdd6da0f8a64fa9f30f.css rel=stylesheet integrity="sha256-SOQ5Sm10NHZaFS3ApRJgg8mbc+Ws4R/dbaD4pk+p8w8=" crossorigin=anonymous><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script></head><body class=td-section><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="container-fluid flex-column flex-md-row"><a class=navbar-brand href=/fr/><span class="navbar-brand__logo navbar-logo"><svg id="svg36" width="110.767" height="22"><style id="style1">.st9{fill:#fff}</style><g id="ok" transform="scale(.1918)"><g id="g36"><g id="g29"><path id="path23" d="M38.5 83.4c-1.9 8.2-2.9 17-2.9 26.5v4.8h16.6c-2.8-13.2-7.8-23.4-13.7-31.3z" class="st9"/><path id="path24" d="M0 57.5v19.9c3.1 1.2 6.3 2.7 9.5 4.6 8.5 5.2 15 12.6 19.4 21.8v-31c-3.4-3-6.9-5.5-10.3-7.5-6.5-3.7-13-6.2-18.6-7.8z" class="st9"/><path id="path25" d="M35.6 69.9c4.3-11.3 10.6-21.1 18.9-29.4V0H35.6z" class="st9"/><path id="path26" d="M40.8 75.4c5.3 6.2 10.1 13.8 13.7 23.3V50.6C48.6 57.8 44 66.1 40.8 75.4z" class="st9"/><path id="path27" d="M100.7.0H61.3v34.5C73.1 25.2 86 20 96.9 17.2c1.8-.5 3.7.6 4.1 2.4.5 1.8-.6 3.6-2.4 4.1-11.4 2.9-25.3 8.6-37.2 19.7v31.8c2.9-6.3 6.7-11.7 11.4-16.4 9.4-9.3 21-14.1 30.5-16.6 1.8-.5 3.7.6 4.1 2.4.5 1.8-.6 3.6-2.4 4.1-4.7 1.2-10.1 3.1-15.3 6-19 10.3-28.2 28.4-28.2 55.2v4.8h39.3c7.8.0 14.1-6.3 14.1-14.1V14.1C114.7 6.3 108.4.0 100.7.0z" class="st9"/><path id="path28" d="M22 59.6c2.2 1.3 4.5 2.8 6.8 4.6V0H14.1C6.3.0.0 6.3.0 14.1v36.4c6.5 1.7 14.2 4.5 22 9.1z" class="st9"/><path id="path29" d="M5.4 87.5c-1.8-1.1-3.6-2-5.4-2.8v15.9c0 7.8 6.3 14.1 14.1 14.1h11.6c-3.6-12.2-10.4-21.3-20.3-27.2z" class="st9"/></g><g id="g30"><path id="path30" d="M201.7 109c-30.8.0-53.7-21.2-53.7-52.5.0-31.7 22.9-51.6 53.7-51.6 31 0 53.9 20 53.9 51.6-.1 31.3-23 52.5-53.9 52.5zm0-82.6c-16.7.0-28.2 12.8-28.2 30.1.0 17.9 11.6 30.7 28.2 30.7S230 74.4 230 56.6c0-17.3-11.6-30.2-28.3-30.2z" class="st9"/></g><g id="g32"><g id="g31"><path id="path31" d="M334.3 33.3c-4-5.2-11.4-8.5-17.6-8.5-6.2.0-13.8 2.1-13.8 9.9.0 6.6 5.9 8.7 15.2 11.6 13.4 4.3 30.7 10 30.7 29.7.0 22.7-18.3 32.9-37.8 32.9-14.1.0-28.3-5.2-37-14.2l15.6-15.9c4.7 6 13.5 10.5 21.3 10.5 7.3.0 13.7-2.8 13.7-10.7.0-7.5-7.5-9.9-20.5-14.1C291.6 60.3 279 53.9 279 36c0-21.9 19.8-31 38.2-31 11.2.0 23.7 4.2 32.4 12.1z" class="st9"/></g></g><g id="g34"><g id="g33"><path id="path32" d="m433.1 106.4-21.3-39.2h-8.1v39.2h-23.4V7.6H418c19 0 37.8 7.3 37.8 29.9.0 13.3-7.8 22.7-20.5 26.6l25.8 42.3zm-16.9-79.6h-12.7v23h11.3c7.7.0 17.3-2 17.3-12 0-9.2-8.7-11-15.9-11z" class="st9"/></g></g><g id="g35"><path id="path34" d="M522.2 106.4h-36.8V7.6H521c28 0 56.5 11.7 56.5 49.1.0 34.7-28.1 49.7-55.3 49.7zm-1.7-78.5h-11.9v57.8h11.3c17 0 32.8-7 32.8-29 0-22.2-15.8-28.8-32.2-28.8z" class="st9"/></g></g></g></svg></span><span class=navbar-brand__name>OSRD</span></a><div class="td-navbar-nav-scroll ms-md-auto" id=main_navbar><ul class=navbar-nav><li class=nav-item><a class=nav-link href=/fr/about/><span>À propos</span></a></li><li class=nav-item><a class="nav-link active" href=/fr/docs/><span>Documentation</span></a></li><li class=nav-item><a class=nav-link href=/fr/blog/><span>Blog</span></a></li><li class=nav-item><a class=nav-link href=/fr/join-us/><span>Rejoignez-nous</span></a></li><li class="nav-item dropdown d-none d-lg-block"><div class=dropdown><a class="nav-link dropdown-toggle" href=# role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false>Français</a><ul class=dropdown-menu><li><a class=dropdown-item href=/en/docs/guides/contribute/>English</a></li></ul></div></li></ul></div><div class="d-none d-lg-block"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder=Rechercher aria-label=Rechercher autocomplete=off data-offline-search-index-json-src=/offline-search-index.427a28aced40a63840c542b440484b0f.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>Version imprimable multipages.
<a href=# onclick="return print(),!1">Cliquer ici pour imprimer</a>.</p><p><a href=/fr/docs/guides/contribute/>Retour à la version par défaut</a>.</p></div><h1 class=title>Contribuer à OSRD</h1><div class=lead>Comment apporter sa pierre à l&rsquo;édifice</div><ul><li>1: <a href=#pg-31a89538caa038f0d01ee6c6a8862c0d>Avant toutes choses</a></li><li>2: <a href=#pg-4f9bf02b817699600b9459c28866f49f>Licence et mise en place</a></li><li>3: <a href=#pg-f947cac33cc610c73e532b77f01d00b8>Contribuer au code</a></li><ul><li>3.1: <a href=#pg-b3865e3b665eac02431c0e1a2b49dbde>Principes généraux</a></li><li>3.2: <a href=#pg-28c5c56e84e8a12ef3e3824e0c15eda3>Conventions back-end</a></li><li>3.3: <a href=#pg-14c3b96b1f8a7ac7ac971afe801849db>Conventions front-end</a></li><li>3.4: <a href=#pg-baa7dfe57fa41f763127154fe6dc4e7b>Écrire du code</a></li><li>3.5: <a href=#pg-1c2be5f2cd6600262d973426390f5a3b>Conventions de commits</a></li><li>3.6: <a href=#pg-6334dadf8018c47abf554cd3015be6bd>Partagez vos changements</a></li><li>3.7: <a href=#pg-c9ed9175ac241f91b9cc8c4412a1e488>Tests</a></li></ul><li>4: <a href=#pg-f29e34723cf01ba920bd21548bdf1c2e>Revue de code</a></li><li>5: <a href=#pg-987ae2aead487e6aad8654531bf0e679>Signaler des problèmes</a></li><li>6: <a href=#pg-59d5d4e46db83500a6acfc6ba3354b64>Installer docker</a></li><li>7: <a href=#pg-a6b5ed2313c4aa287c4250d8f8de644d></a></li></ul><div class=content></div></div><div class=td-content><h1 id=pg-31a89538caa038f0d01ee6c6a8862c0d>1 - Avant toutes choses</h1><div class=lead>Quelques premières informations importantes.</div><p>Déjà, merci de prendre le temps de contribuer !</p><p>Si les sections suivantes forment un guide du contributeur, ce n&rsquo;est pas pour autant un ensemble de règles strictes. En fait, si vous avez déjà contribué à des gros projets open-source, la suite ne sera pas surprenante. Dans le cas contraire, elle vous sera probablement très utile !</p><h3 id=communiquer>Communiquer</h3><p>Vous pouvez gagner du temps en discutant de votre projet de contribution avec les autres contributeurs :</p><ul><li><a href=https://github.com/OpenRailAssociation/osrd/issues/new/choose><strong>Créez une issue</strong></a> pour avoir un endroit pour discuter de votre contribution.</li></ul><h3 id=se-renseigner>Se renseigner</h3><p>Comme dans tout projet, chaque changement repose sur ce qui a été fait par le passé.
Avant d&rsquo;apporter un changement, renseignez-vous sur l&rsquo;existant :</p><ul><li>Vous pouvez <a href=https://osrd.fr/fr/docs/>lire la documentation technique</a></li><li>Il est préférable de lire le code source de l&rsquo;application en rapport avec votre projet</li><li>Vous pouvez contacter les derniers développeurs à avoir travaillé sur les zones du code en rapport avec votre projet</li></ul><p><em><a href=https://osrd.fr/fr/docs/guides/contribute/license-and-set-up/>Continuer vers la mise en place ‣</a></em></p></div><div class=td-content style=page-break-before:always><h1 id=pg-4f9bf02b817699600b9459c28866f49f>2 - Licence et mise en place</h1><div class=lead>Comment mettre en place l&rsquo;environnement de développement ? Qu&rsquo;implique notre licence ?</div><h2 id=la-licence-des-contributions-de-code>La licence des contributions de code</h2><p>Tout le code du dépôt OSRD est mis à disposition sous <a href=https://choosealicense.com/licenses/lgpl-3.0/>la licence LGPLv3</a>.
En contribuant du code, vous acceptez la redistribution de votre contribution sous cette license.</p><p>La licence LGPL interdit de modifier OSRD sans publier le code source de l&rsquo;application modifiée : profitez du travail des autres, et laissez les autres profiter de votre travail !</p><p>Cette contrainte n&rsquo;est pas contagieuse à travers les API : Il est possible d&rsquo;utiliser OSRD comme bibliothèque, framework ou serveur pour s&rsquo;interfacer avec des composants propriétaires. N&rsquo;hésitez pas à proposer des changements pour répondre à vos besoins.</p><h2 id=mise-en-place>Mise en place</h2><div class="alert alert-info" role=alert>La plupart des développeurs OSRD utilisent Linux (y compris <a href=https://learn.microsoft.com/fr-fr/windows/wsl/>WSL</a>). Vous pouvez utiliser Windows ou MacOS, mais pourriez rencontrer quelques problèmes.</div><h3 id=obtenir-le-code-source>Obtenir le code source</h3><ul><li>Installer <a href=https://git-scm.com/><code>git</code></a><sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup></li><li>Ouvrir un terminal<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup> dans le dossier qui contiendra le code source d&rsquo;OSRD</li><li><code>git clone https://github.com/OpenRailAssociation/osrd.git</code></li></ul><h3 id=lancer-lapplication>Lancer l&rsquo;application</h3><p>Docker est un outil qui réduit considérablement la préparation nécessaire pour travailler sur OSRD:</p><ul><li>télécharger le dernier build de développement : <code>docker compose pull</code></li><li>démarrer OSRD : <code>docker compose up</code></li><li>compiler et démarrer OSRD: <code>docker compose up --build</code></li><li>review une PR avec les images compilées par la CI: <code>TAG=pr-XXXXX docker compose up --no-build --pull always</code></li></ul><p>Pour commencer :</p><ul><li><a href=https://osrd.fr/fr/docs/guides/contribute/install-docker/>Installer <code>docker</code></a></li><li>Suivre le <a href=https://github.com/OpenRailAssociation/osrd#getting-started>README d&rsquo;OSRD</a>.</li></ul><p><em><a href=https://osrd.fr/fr/docs/guides/contribute/contribute-code/>Continuer vers la contribution au code ‣</a></em></p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>Sous Linux, utilisez le gestionnaire de packet (comme <code>apt</code>)&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p>Sous Windows, ouvrez <code>Git Bash</code>&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div><div class=td-content style=page-break-before:always><h1 id=pg-f947cac33cc610c73e532b77f01d00b8>3 - Contribuer au code</h1><div class=lead>Apporter des modifications au code d&rsquo;OSRD</div><p>Ce chapitre décrit le processus aboutissant à l&rsquo;intégration de code au sein du projet. <strong>Si vous avez besoin d&rsquo;aide, ouvrez une issue ou envoyez un message instantané.</strong></p><p>L&rsquo;application OSRD est divisée en plusieurs services écrits dans plusieurs langues. Nous essayons de suivre les bonnes pratiques générales en matière de code et de respecter les spécificités de chaque langage lorsque cela est nécessaire.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-b3865e3b665eac02431c0e1a2b49dbde>3.1 - Principes généraux</h1><div class=lead>À lire en premier !</div><ul><li>Expliquez ce que vous faites et pourquoi.</li><li>Documentez le nouveau code.</li><li>Ajoutez des tests clairs et simples.</li><li>Décomposez le travail en morceaux intelligibles.</li><li>Prenez le temps de choisir de bons noms.</li><li>Évitez les abréviations peu connues.</li><li><strong>Contrôle et cohérence de la réutilisation du code de tiers</strong> : une dépendance est ajoutée seulement si elle est absolument nécessaire.</li><li>Chaque dépendance ajoutée diminue notre autonomie et notre cohérence.</li><li>Nous essayons de limiter à un petit nombre les PRs de mise à jour des dépendances chaque semaine
dans chaque composant, donc regrouper les montées de version dans une même PR est une bonne option
(reportez-vous au <code>README.md</code> de chaque composant).</li><li><strong>Ne pas réinventer la roue</strong> : en opposition au point précédent, ne réinventez pas tout à tout prix.</li><li>S&rsquo;il existe une dépendance dans l&rsquo;écosystème qui est le standard « de facto », nous devrions fortement envisager de l&rsquo;utiliser.</li><li>Plus de code et de recommandations générales dans le dépôt principal <a href=https://github.com/OpenRailAssociation/osrd/blob/dev/CONTRIBUTING.md>CONTRIBUTING.md</a>.</li><li>Demandez toute l&rsquo;aide dont vous avez besoin !</li></ul><p><em><a href=https://osrd.fr/fr/docs/guides/contribute/contribute-code/backend-conventions/>Consulter les conventions pour le back-end ‣</a></em></p><p><em><a href=https://osrd.fr/fr/docs/guides/contribute/contribute-code/frontend-conventions/>Consulter les conventions pour le front-end ‣</a></em></p><p><em><a href=https://osrd.fr/fr/docs/guides/contribute/contribute-code/write-code/>Continuer vers l&rsquo;écriture de code ‣</a></em></p><p><em><a href=https://osrd.fr/fr/docs/guides/contribute/contribute-code/tests/>Continuer vers l&rsquo;écriture de tests ‣</a></em></p></div><div class=td-content style=page-break-before:always><h1 id=pg-28c5c56e84e8a12ef3e3824e0c15eda3>3.2 - Conventions back-end</h1><div class=lead>Conventions de codes et bonnes pratiques pour le back-end</div><h1 id=python>Python</h1><p>Le code Python est utilisé pour certains paquets et pour les tests d&rsquo;intégration.</p><ul><li>Suivez le <a href=https://www.python.org/dev/peps/pep-0020/>Zen of Python</a>.</li><li>Le code est linté avec <a href=https://github.com/csachs/pyproject-flake8>flake8</a>.</li><li>Le code est formaté avec <a href=https://github.com/psf/black>Black</a>.</li><li>Les imports sont triées avec <a href=https://github.com/PyCQA/isort>Isort</a>.</li><li>Les tests sont écrits avec <a href=https://docs.pytest.org/>pytest</a>.</li><li>Les types sont vérifiés avec <a href=https://google.github.io/pytype/>pytype</a>.</li></ul><h1 id=rust>Rust</h1><ul><li>Comme référence pour le développement de notre API, nous utilisons les <a href=https://rust-lang.github.io/api-guidelines/about.html>Rust API guidelines</a>.
D&rsquo;une manière générale, il convient de les respecter.</li><li>Préférer les importations granulaires aux importations globales comme <code>diesel::*</code>.</li><li>Les tests sont écrits avec le <a href=https://doc.rust-lang.org/book/ch11-01-writing-tests.html>framework de base</a>.</li><li>Utilisez l&rsquo;<a href=https://doc.rust-lang.org/rust-by-example/meta/doc.html>exemple de documentation</a> pour savoir comment formuler et formater votre documentation.</li><li>Utilisez un style de commentaire cohérent :<ul><li><code>///</code> les commentaires de la documentation sont au-dessus des invocations <code>#[derive(Trait)]</code>.</li><li>Les commentaires <code>//</code> doivent généralement être placés au-dessus de la ligne en question, plutôt qu&rsquo;en ligne.</li><li>Les commentaires commencent par des lettres majuscules.
Terminez-les par un point s&rsquo;ils ressemblent à une phrase.</li></ul></li><li>Utilisez les commentaires pour organiser des portions de code longues et complexes qui ne peuvent être raisonnablement remaniées en fonctions distinctes.</li><li>Le code est linté avec <a href=https://github.com/rust-lang/rust-clippy>clippy</a>.</li><li>Le code est formaté avec <a href=https://github.com/rust-lang/rustfmt>fmt</a>.</li></ul><h1 id=java>Java</h1><ul><li>Le code est formaté avec <a href=https://checkstyle.sourceforge.io/>checkstyle</a>.</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-14c3b96b1f8a7ac7ac971afe801849db>3.3 - Conventions front-end</h1><div class=lead>Conventions de codes et bonnes pratiques pour le front-end</div><p>Nous utilisons <strong>ReactJS</strong> et tous les fichiers doivent être écrits en <strong>Typescript</strong>.</p><p>Le code est <em>linté</em> avec <a href=https://eslint.org/>eslint</a>, et <strong>formaté</strong> avec <a href=https://prettier.io/>prettier</a>.</p><h2 id=nomenclature>Nomenclature</h2><p><img src=/images/docs/contribute/nomenclature-front-end.svg alt="Diagramme de l’Infrastructure"></p><p>Les <strong>applications</strong> (osrd eex, osrd stdcm, éditeur infra, éditeur matériel) proposent des <strong>vues</strong> (gestion des projets, gestions des études, etc.) liées à des <strong>modules</strong> (projet, étude, etc.) qui contiennent les composants.</p><p>Ces <strong>vues</strong> sont constituées de <strong>composants</strong> et sous-composants <u>tous issus des modules</u>.
En plus de contenir les fichiers de <strong>vues</strong> des applications, elles peuvent contenir un répertoire <strong>scripts</strong> qui propose des scripts liés à ces vues. Les <strong>vues</strong> déterminent la logique et l&rsquo;<u>accès au store</u>.</p><p>Les <strong>modules</strong> sont des collections de <strong>composants</strong> rattachés à un <strong>objet</strong> (un scénario, un matériel roulant, un TrainSchedule). Ils contiennent :</p><ul><li>un répertoire <em>components</em> qui héberge <u>tous</u> les composants</li><li>un répertoire <em>styles</em> optionnel <u>par module</u> pour le style des composants en scss</li><li>un répertoire <em>assets</em> optionnel <u>par module</u> (qui contient les assets, de jeux de données par défaut par ex, spécifiques au module)</li><li>un fichier <em>reducers</em> optionnel <u>par module</u></li><li>un fichier <em>types</em> optionnel <u>par module</u></li><li>un fichier <em>consts</em> optionnel <u>par module</u></li></ul><p>Un répertoire <strong>assets</strong> (qui contient les images et autre fichiers).</p><p>Enfin, un répertoire <strong>common</strong> qui propose :</p><ul><li>un répertoire <em>utils</em> pour les fonctions utilitaires communes à l&rsquo;ensemble du projet</li><li>un fichier <em>types</em> pour les types communs à l&rsquo;ensemble du projet</li><li>un fichier <em>consts</em> pour les constantes communes à l&rsquo;ensemble du projet</li></ul><h2 id=principes-dimplémentation>Principes d&rsquo;implémentation</h2><h3 id=routage--slug>Routage & SLUG</h3><p><em>Rédaction en cours</em></p><p><code>projects/{nom du projet}/studies/{nom de l'étude}/scenarios/{nom du scenario}</code></p><h3 id=styles--scss>Styles & SCSS</h3><blockquote><p>ATTENTION : en CSS/React, le scope d&rsquo;une classe ne dépend pas de l&rsquo;endroit où le fichier est importé mais est valide pour toute l&rsquo;application. Si vous importez un fichier <code>scss</code> au fin fond d&rsquo;un composant (ce que nous déconseillons fortement par ailleurs), ses classes seront disponibles pour toute l&rsquo;application et peuvent donc provoquer des effets de bord. Vous pouvez utiliser les CSS modules pour éviter les conflits.</p></blockquote><p>Il est donc très recommandé de pouvoir facilement suivre l&rsquo;arborescence des applications, vues, modules et composants également au sein du code SCSS, et notamment imbriquer les noms de classes pour éviter les effets de bord, le compilateur se chargera de fabriquer la hiérarchie nécessaire.</p><p>Si par exemple nous avons un composant <code>rollingStockSelector</code> qui propose une liste de matériel <code>rollingStockList</code> représentés par des cartes <code>rollingStockCard</code> contenant une image représentant le matériel roulant <code>rollingStockImg</code> nous devrions avoir la structure SCSS suivante :</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scss data-lang=scss><span style=display:flex><span><span style=color:#000>.rollinStockSelector</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>.rollingStockList</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>.rollingStockCard</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>.rollingStockImg</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#c4a000>width</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>5</span><span style=color:#204a87;font-weight:700>rem</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>        <span style=color:#c4a000>height</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#ce5c00>auto</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>Ainsi, on a la garantie que l&rsquo;image contenue dans la carte de matériel roulant héritera bien des bonnes propriétés css <code>.rollinStockSelector.rollingStockList.rollingStockCard.rollingStockImg</code>.</p><h4 id=css-modules>CSS Modules</h4><p>Les CSS modules permettent de scoper les styles CSS à un composant spécifique, évitant ainsi les conflits de noms de classe globaux.</p><p>Vite prend en charge nativement les CSS modules. Assurez-vous que votre fichier CSS a l&rsquo;extension <code>.module.css</code>. Par exemple, <code>styles.module.css</code>.</p><h5 id=utilisation-des-css-modules-dans-les-composants>Utilisation des CSS modules dans les composants</h5><ol><li><strong>Créez un fichier SCSS avec l&rsquo;extension <code>.module.scss</code></strong> :</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-css data-lang=css><span style=display:flex><span><span style=color:#8f5902;font-style:italic>/* MyComponent.module.scss */</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>.</span><span style=color:#000>container</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>background-color</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>white</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>.</span><span style=color:#000>title</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>font-size</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>24</span><span style=color:#204a87;font-weight:700>px</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>color</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>#333</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><ol start=2><li><strong>Utilisez les classes dans votre composant React</strong> :</li></ol><p>Vite transforme les classes en objets qui contiennent les classes hashées (exemple <code>_container_h3d8bg</code>) et les utilise au moment de la génération du bundle, rendant ainsi les classes uniques.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tsx data-lang=tsx><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>React</span> <span style=color:#204a87;font-weight:700>from</span> <span style=color:#4e9a06>&#34;react&#34;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>styles</span> <span style=color:#204a87;font-weight:700>from</span> <span style=color:#4e9a06>&#34;./MyComponent.module.scss&#34;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>export</span> <span style=color:#204a87;font-weight:700>function</span> <span style=color:#000>MyComponent() {</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000;font-weight:700>(</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>div</span> <span style=color:#c4a000>className</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000;font-weight:700>{</span><span style=color:#000>styles</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>container</span><span style=color:#000;font-weight:700>}&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>h1</span> <span style=color:#c4a000>className</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000;font-weight:700>{</span><span style=color:#000>styles</span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;title&#34;</span><span style=color:#000;font-weight:700>]}&gt;</span><span style=color:#000>Mon</span> <span style=color:#000>Titre</span><span style=color:#000;font-weight:700>&lt;/</span><span style=color:#204a87;font-weight:700>h1</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>&lt;/</span><span style=color:#204a87;font-weight:700>div</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>Pour plus d&rsquo;information, vous pouvez regarder la <a href=https://vitejs.dev/guide/features.html#css-modules>documentation</a> de vite.js</p><h4 id=noms-de-classes-utilisation-de-cx>Noms de classes, utilisation de <code>cx()</code></h4><p>Les classes sont ajoutées les unes à la suite des autres, normalement, dans la propriété <code>className=""</code>.</p><p>Cependant, quand cela est nécessaire — tests pour l&rsquo;utilisation d&rsquo;une classe, concaténation, etc. — nous utilisons la bibliothèque <a href=https://github.com/JedWatson/classnames>classnames</a> qui préconise l&rsquo;usage suivant :</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>div</span> <span style=color:#c4a000>className</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;rollingStockSelector&#34;</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>div</span> <span style=color:#c4a000>className</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;rollingStockList&#34;</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>div</span> <span style=color:#c4a000>className</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;rollingStockCard w-100 my-2&#34;</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>img</span>
</span></span><span style=display:flex><span>        <span style=color:#c4a000>className</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000;font-weight:700>{</span><span style=color:#000>cx</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;rollingStockImg&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;m-2&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;p-1&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;bg-white&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>          <span style=color:#000>valid</span>: <span style=color:#204a87;font-weight:700>isValid</span><span style=color:#000;font-weight:700>(),</span>
</span></span><span style=display:flex><span>          <span style=color:#000>selected</span>: <span style=color:#204a87;font-weight:700>rollingStockID</span> <span style=color:#ce5c00;font-weight:700>===</span> <span style=color:#000>selectedRollingStockID</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>})}</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>&lt;/</span><span style=color:#204a87;font-weight:700>div</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>&lt;/</span><span style=color:#204a87;font-weight:700>div</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>&lt;/</span><span style=color:#204a87;font-weight:700>div</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span></code></pre></div><p>Les classes sont <strong>séparées</strong> chacune dans un <code>string</code> et les opérations booléennes ou autres sont réalisées dans un objet qui retournera — ou pas — le nom de propriété comme nom de classe à utiliser dans le CSS.</p><h3 id=storeredux>Store/Redux</h3><p>Tout ce qui est <em>selector</em> est géré par la <strong>vue</strong> et passé en props aux composants et sous-composants.</p><p>Par conséquent les appels au store en lecture et en écriture doivent être passés un niveau de la vue, en irrigant par des <em>props</em> et <em>states</em> les composants proposées par la vue.</p><h3 id=rtk>RTK</h3><p>Utiliser les endpoints générés à partir des fichiers <code>openapi.yaml</code> pour consommer le backend.</p><h4 id=fonctionnement-du-cache-dans-rtk-query>Fonctionnement du cache dans RTK Query</h4><p>Lorsque de la donnée est récupérée depuis le back, RTK va mettre cette donnée en cache dans le store. Si le même endpoint est appelé avec les même paramètres, RTK va réutiliser la donnée dans le cache plutôt que de rappeler le back.</p><p>Dans le store, vous verrez cette clé <code>editoastApi</code> qui contient la donnée en cache de tous les endpoints editoast :</p><p><img src=/images/docs/contribute/store-redux-main.png alt="store Redux"></p><p>Ici par exemple l’endpoint <code>getProjects</code> a été appelé.</p><p>RTK stocke le nom de l’endpoint, ainsi que les paramètres d’appel, pour former une clé unique <code>nomDuEndpoint({ paramètres })</code>. (ici <code>getProjects({"ordering":"LastModifiedDesc","pageSize":1000})</code>).</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#4e9a06>&#39;getProjectsByProjectIdStudiesAndStudyId({&#34;projectId&#34;:13,&#34;studyId&#34;:16})&#39;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>status</span> <span style=color:#ce5c00;font-weight:700>:</span><span style=color:#4e9a06>&#34;fulfilled&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#000>etc</span><span style=color:#a40000>…</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>  <span style=color:#4e9a06>&#39;getProjectsByProjectIdStudiesAndStudyId({&#34;projectId&#34;:13,&#34;studyId&#34;:14})&#39;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#a40000>…</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>Dans ce deuxième exemple, le même endpoint a été appelé avec le même paramètre <code>projectId</code>, mais un paramètre <code>studyId</code> différent.</p><h5 id=sérialisation-des-clés-dans-le-cache>Sérialisation des clés dans le cache</h5><p>Les string utilisées comme clé dans le cache sont à peu de choses près l’objet paramètre passé à la moulinette <code>JSON.stringify</code> que transforme un object JS en string (donc sérialisé).</p><p>Normalement La sérialisation ne conserve pas l’ordre des clés des objets. Par exemple, <code>JSON.stringify</code> ne produira pas la même string avec ces deux objets: <code>{ a: 1, b: 2 }</code> et <code>{ b: 2, a: 1 }</code>.</p><p>RTK va optimiser la mise en cache en faisant en sorte que le résultat d’un appel avec <code>{"projectId":13,"studyId":16}</code> ou <code>{"studyId":16, "projectId":13}</code> soient stockées dans la même clé dans le cache.</p><p>Pour voir le fonctionnement en détail, voici le code de cette fonction de sérialisation :</p><details><summary>Fonction de sérialisation RTK</summary><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>defaultSerializeQueryArgs</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000>SerializeQueryArgs</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>any</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>({</span>
</span></span><span style=display:flex><span>    <span style=color:#000>endpointName</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#000>queryArgs</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>})</span> <span style=color:#000;font-weight:700>=&gt;</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>let</span> <span style=color:#000>serialized</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>cached</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>cache</span><span style=color:#ce5c00;font-weight:700>?</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>get</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>queryArgs</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>typeof</span> <span style=color:#000>cached</span> <span style=color:#ce5c00;font-weight:700>===</span> <span style=color:#4e9a06>&#39;string&#39;</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>serialized</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>cached</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>else</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>stringified</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>JSON</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>stringify</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>queryArgs</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>key</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>value</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>=&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#000>isPlainObject</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>value</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>          <span style=color:#ce5c00;font-weight:700>?</span> <span style=color:#204a87>Object</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>keys</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>value</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>              <span style=color:#000;font-weight:700>.</span><span style=color:#000>sort</span><span style=color:#000;font-weight:700>()</span> <span style=color:#8f5902;font-style:italic>// les clés sont remises dans l’ordre ici
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>              <span style=color:#000;font-weight:700>.</span><span style=color:#000>reduce</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>any</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>((</span><span style=color:#000>acc</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>key</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>=&gt;</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>                <span style=color:#000>acc</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>key</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>value</span> <span style=color:#000>as</span> <span style=color:#000>any</span><span style=color:#000;font-weight:700>)[</span><span style=color:#000>key</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span>                <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>acc</span>
</span></span><span style=display:flex><span>              <span style=color:#000;font-weight:700>},</span> <span style=color:#000;font-weight:700>{})</span>
</span></span><span style=display:flex><span>          <span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000>value</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>isPlainObject</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>queryArgs</span><span style=color:#000;font-weight:700>))</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>cache</span><span style=color:#ce5c00;font-weight:700>?</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>set</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>queryArgs</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>stringified</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>      <span style=color:#000>serialized</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>stringified</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>// Sort the object keys before stringifying, to prevent useQuery({ a: 1, b: 2 }) having a different cache key than useQuery({ b: 2, a: 1 })
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#4e9a06>`</span><span style=color:#4e9a06>${</span><span style=color:#000>endpointName</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>(</span><span style=color:#4e9a06>${</span><span style=color:#000>serialized</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>)`</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div></details><h5 id=souscriptions-à-la-donnée>Souscriptions à la donnée</h5><p>Dans la terminologie de RTK query, Lorsqu’un composant react appelle un endpoint défini dans RTK Query, il <em>souscrit</em> à la donnée.</p><p>RTK compte le nombre de référence à la même paire (endpoint,{paramètres}). Lorsque deux composants souscrivent à la même donnée. Ils partagent la même clé dans le cache.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#000>osrdEditoastApi</span> <span style=color:#000;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>from</span> <span style=color:#4e9a06>&#34;./api.ts&#34;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>function</span> <span style=color:#000>Component1() {</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// component subscribes to the data
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>const</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#000>data</span> <span style=color:#000;font-weight:700>}</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>osrdEditoastApi</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>useGetXQuery</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>div</span><span style=color:#000;font-weight:700>&gt;...&lt;/</span><span style=color:#204a87;font-weight:700>div</span><span style=color:#000;font-weight:700>&gt;;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>function</span> <span style=color:#000>Component2() {</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// component subscribes to the data
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>const</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#000>data</span> <span style=color:#000;font-weight:700>}</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>osrdEditoastApi</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>useGetXQuery</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>div</span><span style=color:#000;font-weight:700>&gt;...&lt;/</span><span style=color:#204a87;font-weight:700>div</span><span style=color:#000;font-weight:700>&gt;;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>function</span> <span style=color:#000>Component3() {</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// component subscribes to the data
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>const</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#000>data</span> <span style=color:#000;font-weight:700>}</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>osrdEditoastApi</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>useGetXQuery</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>div</span><span style=color:#000;font-weight:700>&gt;...&lt;/</span><span style=color:#204a87;font-weight:700>div</span><span style=color:#000;font-weight:700>&gt;;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>function</span> <span style=color:#000>Component4() {</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// component subscribes to the *same* data as ComponentThree,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#8f5902;font-style:italic>// as it has the same query parameters
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>const</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#000>data</span> <span style=color:#000;font-weight:700>}</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>osrdEditoastApi</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>useGetXQuery</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>div</span><span style=color:#000;font-weight:700>&gt;...&lt;/</span><span style=color:#204a87;font-weight:700>div</span><span style=color:#000;font-weight:700>&gt;;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>Ici <code>Component3</code> et <code>Component4</code> ne vont générer qu’un seul appel vers le back. Ils souscrivent à la même donnée (même endpoint et même paramètre <code>3</code>). Ils vont partager la même clé dans le cache.</p><p>Au total ici il y aura trois appels vers le back, avec les paramètres <code>1</code>, <code>2</code>, <code>3</code>.</p><p>Tant qu’il existe au moins un composant react monté, qui appelle le hook <code>osrdEditoastApi.endpoints.getProjectsByProjectId.useQuery</code> par exemple, la donnée sera conservée dans le cache.</p><p>Dès que le dernier composant est démonté, la donnée est supprimée du cache au bout de 60 secondes (valeur par défaut).</p><h3 id=traduction-de-lapplication>Traduction de l&rsquo;application</h3><p>La traduction de l&rsquo;application est effectuée sur <a href=https://explore.transifex.com/osrd/osrd/>Transifex</a>. La langue par défaut est le français.
A noter que si l&rsquo;on doit corriger une traduction, il est recommandé de passer par Transifex. En revanche, si on ajoute une nouvelle clé de traduction, celle-ci peut être ajoutée dans le code directement, dans toutes les langues disponibles.</p><h2 id=lois-et-éléments-importants>Lois et éléments importants</h2><h4 id=aucun-composant-ne-doit-détenir-la-responsabilité-de-mise-à-jour-de-la-donnée-quil-utilise>Aucun composant ne doit détenir la responsabilité de mise à jour de la donnée qu&rsquo;il utilise</h4><p>Seules <u>les vues</u> contiennent les sélecteurs du store, donnés ensuite en props aux composants du module lié à la vue.</p><h4 id=le-scss-nest-pas-scopé>Le SCSS n&rsquo;est pas scopé</h4><p>Un fichier <code>.scss</code> enfoui dans l&rsquo;arborescence ne vous garantit pas que les classes contenues soient seulement accessibles à cet endroit, y compris par import react (formellement interdit au passage : vous devez utiliser l&rsquo;import SCSS), toutes les classes déclarées sont accessibles partout.</p><p>Préférez un choix judicieux de nom de classe racine pour un module donné et utilisez l&rsquo;arborescence possible dans le fichier SCSS.</p><h4 id=les-imports-doivent-être-triés-dune-certaine-manière>Les imports doivent être triés d&rsquo;une certaine manière</h4><p>ESLint est configuré pour trier automatiquement les imports en 4 groupes, chacun trié alphabétiquement :</p><ul><li>React</li><li>Librairies externes</li><li>Fichiers internes en chemin absolu</li><li>Fichiers internes en chemin relatif</li></ul><p>Chacun de ces groupes est séparé par une ligne vide.</p><p>ESLint déclenchera un avertissement si ces recommandations ne sont pas respectées.</p><h4 id=les-liens-des-imports-doivent-être-absolus>Les liens des imports doivent être absolus</h4><p>Vous devez utiliser le <u>chemin complet</u> pour tous vos imports.</p><blockquote><p>Le chemin peut être relatif seulement si le fichier à importer est dans le même répertoire.</p></blockquote><h2 id=typescript>TypeScript</h2><h3 id=import--export>import & export</h3><p>ESLint et Typescript sont configurés pour imposer l&rsquo;<code>import type</code> pour un import de type.</p><p>Ceci permet de :</p><ul><li>Automatiquement ajouter <code>type</code> devant l&rsquo;import quand on ajoute un type avec l&rsquo;autocomplétion dans un fichier.</li><li>Afficher 2 erreurs de chacun de ces packages demandant d&rsquo;ajouter <code>type</code> devant l&rsquo;import si vous ne l&rsquo;avez pas fait.</li></ul><p>Lorsque qu’un <code>import</code> ou un <code>export</code> ne comporte que des types, il faut l’indiquer par le mot clé <code>type</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#204a87;font-weight:700>export</span> <span style=color:#204a87;font-weight:700>type</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#000>Direction</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>DirectionalTrackRange</span> <span style=color:#204a87;font-weight:700>as</span> <span style=color:#000>TrackRange</span> <span style=color:#000;font-weight:700>};</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#204a87;font-weight:700>type</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#000>typedEntries</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>ValueOf</span> <span style=color:#000;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>from</span> <span style=color:#4e9a06>&#34;utils/types&#34;</span><span style=color:#000;font-weight:700>;</span>
</span></span></code></pre></div><p>Quand un import ne contient pas que des types, il sera agencé de cette manière, par ordre alphabétique.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>osrdEditoastApi</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>type</span> <span style=color:#000>ScenarioCreateForm</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>from</span> <span style=color:#4e9a06>&#34;common/api/osrdEditoastApi&#34;</span><span style=color:#000;font-weight:700>;</span>
</span></span></code></pre></div><p>Cette pratique permet de :</p><ul><li>Améliorer les performances et le travail d’analyse du compilateur et du linter.</li><li>Rendre ces déclarations plus lisibles, on voit clairement ce qu’on est en train d’importer.</li><li>Éviter des cycles de dépendances :</li></ul><p><img src=/images/docs/contribute/dependency-cycle.png alt="dependency cycle"></p><p>L’erreur disparaît avec le mot clé <code>type</code></p><p><img src=/images/docs/contribute/dependency-cycle-gone.png alt="dependency cycle"></p><ul><li>Alléger le bundle final (tous les types disparaissent à la compilation).</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-baa7dfe57fa41f763127154fe6dc4e7b>3.4 - Écrire du code</h1><div class=lead>Apporter des modifications au code d&rsquo;OSRD</div><ol><li><p>Si vous n&rsquo;être pas un habitué de Git, <a href=https://learngitbranching.js.org/>suivez ce tutoriel</a></p></li><li><p><strong>Créez une branche</strong><br>Si vous comptez contribuer régulièrement, vous pouvez demander accès au <a href=https://github.com/OpenRailAssociation/osrd>dépôt principal</a>. Sinon, <a href=https://github.com/OpenRailAssociation/osrd/fork>créez un fork</a>.</p></li><li><p><strong>Ajoutez des changements sur votre branche</strong><br>Essayez de découper votre travail en étapes macroscopiques, et sauvegardez vos changements dans un commit à la fin de chaque étape. Essayez de suivre <a href=../conventions/>les conventions du projet</a>.</p></li><li><p><strong>Conservez votre branche à jour</strong></p><pre tabindex=0><code>git switch &lt;your_branch&gt;
git fetch
git rebase origin/dev
</code></pre></li></ol><p><em><a href=https://osrd.fr/fr/docs/guides/contribute/contribute-code/commit-conventions/>Continuer vers le style des commits ‣</a></em></p></div><div class=td-content style=page-break-before:always><h1 id=pg-1c2be5f2cd6600262d973426390f5a3b>3.5 - Conventions de commits</h1><div class=lead>Quelques bonnes pratiques et règles pour les messages de commits</div><h2 id=style-de-commits>Style de commits</h2><p>Le format général des commits est le suivant :</p><pre tabindex=0><code>composant1, composant2: description du changement à l&#39;impératif

Description détaillée ou technique du contenu et de la motivation du
changement, si le titre n&#39;est pas complètement évident.
</code></pre><ul><li><strong>le message comme le code doit être en anglais</strong> (seulement des caractères ASCII pour le titre)</li><li>il peut y avoir plusieurs composants, séparés par des <code>:</code> quand il y a une relation hiérarchique, ou des <code>,</code> sinon</li><li>les composants sont en minuscule, avec éventuellement <code>-</code>, <code>_</code> ou <code>.</code></li><li>la description du changement à l&rsquo;impératif commence par un verbe en minuscule</li><li>le titre ne doit pas comporter de lien (<code>#</code> est interdit)</li></ul><p>Idéalement :</p><ul><li>le titre doit être autonome : pas besoin de lire autre chose pour le comprendre</li><li>le titre du commit est entièrement en minuscule</li><li>le titre est clair pour une personne étrangère au code</li><li>le corps du commit contient une description du changement</li></ul><div class="alert alert-info" role=alert>Une vérification automatique est effectuée pour vérifier autant que possible ce formatage.</div><h3 id=contre-exemples-de-titres-de-commit>Contre-exemples de titres de commit</h3><p>A éviter absolument:</p><ul><li><code>component: update ./some/file.ext</code> : préciser la mise à jour en question plutôt que le fichier,
les fichiers sont des éléments techniques bienvenus dans le <em>corps</em> du commit</li><li><code>component: fix #42</code> : préciser le problème corrigé, les liens (vers l&rsquo;issue, etc.) sont
encouragés dans le <em>corps</em> du commit</li><li><code>wip</code> : décrire le travail (et le finir)</li></ul><p>Bienvenus pour faciliter la relecture, mais ne pas merger:</p><ul><li><code>fixup! previous commit</code> : un <a href=../share-changes>autosquash</a> devra être lancé avant le merge</li><li><code>Revert "previous commit of the same PR"</code> : les deux commits devront être retirés avant merge</li></ul><h2 id=le-developer-certificate-of-origin-dco>Le Developer Certificate of Origin (DCO)</h2><p>Tous les projets d&rsquo;OSRD utilisent le DCO (certificat du développeur d&rsquo;origine)
pour des raisons légales. Le DCO permet de confirmer que vous avez les droits
sur le code que vous contribuez. Pour en savoir plus sur l&rsquo;histoire et
l&rsquo;objectif du DCO, vous pouvez lire <a href=https://bssw.io/blog_posts/the-developer-certificate-of-origin>The Developer Certificate of Origin</a>
de Roscoe A. Bartlett.</p><p>Pour se conformer au DCO, <strong>tous les commits doivent inclure une ligne
Signed-off-by</strong>.</p><h3 id=comment-signer-un-commit-avec-git-dans-un-terminal->Comment signer un commit avec Git dans un terminal ?</h3><p>Pour signer un commit, il suffit d&rsquo;ajouter l&rsquo;option <code>-s</code> à votre commande <code>git commit</code>, comme ceci :</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>git commit -s -m <span style=color:#4e9a06>&#34;Your commit message&#34;</span>
</span></span></code></pre></div><p>Cela s&rsquo;applique également lors de l&rsquo;utilisation de la commande <code>git revert</code>.</p><h3 id=comment-signer-un-commit-avec-git-dans-visual-studio-code-vs-code->Comment signer un commit avec Git dans Visual Studio Code (VS Code) ?</h3><p>Allez dans <code>Fichiers</code> -> <code>Préférences</code> -> <code>Paramètres</code>, puis recherchez et
activez le paramètre <strong>Always Sign Off</strong>.</p><p>Ensuite, lorsque vous ferez un commit via l&rsquo;interface de VS Code, ils seront
automatiquement signés.</p><p><em><a href=https://osrd.fr/fr/docs/guides/contribute/contribute-code/share-changes/>Continuer vers le partage des changements ‣</a></em></p></div><div class=td-content style=page-break-before:always><h1 id=pg-6334dadf8018c47abf554cd3015be6bd>3.6 - Partagez vos changements</h1><div class=lead>Comment soumettre votre code pour qu&rsquo;il soit vérifié ?</div><p>L&rsquo;auteur d&rsquo;une <em>pull request (PR)</em> est responsable de son « cycle de vie ». Il se charge de contacter les différents acteurs, de suivre la revue de code, répondre aux commentaires et corriger le code suite à la revue de code (vous pouvez également consulter la <a href=https://osrd.fr/fr/docs/guides/contribute/code-review/>page dédiée à la revue de code</a>).</p><blockquote><p>En cas de PR conséquente, ne pas hésiter à solliciter plusieurs reviewers qui pourront s&rsquo;organiser, voire de faire la review ensemble, reviewers et auteur.</p></blockquote><ol><li><p><strong>Ouvrez une <em>pull request</em></strong><br>Une fois que vos changements sont prêts, il est temps de proposer de les intégrer à la branche <code>dev</code>.
Cela se fait <a href=https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/proposing-changes-to-your-work-with-pull-requests/creating-a-pull-request>dans l&rsquo;interface web de Github</a>.</p><p>Si possible :</p><ul><li>Faites des PRs d&rsquo;unités logiques et atomiques également (évitez de mélanger le refactoring, les nouvelles fonctionnalités et la correction de bugs en même temps).</li><li>Ajoutez une description aux PR pour expliquer ce qu&rsquo;elles font et pourquoi.</li><li>Aidez le relecteur en suivant les conseils donnés dans <a href=https://mtlynch.io/code-review-love/>l&rsquo;article de mtlynch</a>.</li><li>Ajoutez les balises <code>area:&lt;affected_area></code> pour montrer quelle partie de l&rsquo;application a été impactée. Cela peut être fait via <a href=https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/proposing-changes-to-your-work-with-pull-requests/creating-a-pull-request>l&rsquo;interface web</a>.</li></ul></li><li><p><strong>Prenez en compte les retours</strong><br>Une fois que votre PR est ouverte, <a href=https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/reviewing-changes-in-pull-requests/about-pull-request-reviews>d&rsquo;autres contributeurs doivent donner leur avis sur votre proposition</a> :</p><ul><li>N&rsquo;importe qui peut donner son avis.</li><li>Il est nécessaire d&rsquo;obtenir l&rsquo;approbation d&rsquo;un <a href=https://github.com/OpenRailAssociation/osrd/blob/dev/.github/CODEOWNERS>contributeur familier avec le code</a>.</li><li>Il est d&rsquo;usage de prendre en compte tous les commentaires critiques.</li><li>Les commentaires sont souvent écrits dans un style plutôt direct, dans le souci de collaborer efficacement vers une solution acceptable par tous.</li><li>Une fois que tous les commentaires ont été pris en compte, un mainteneur intègre le changement.</li></ul></li></ol><blockquote><p>Sur les PR conséquentes et vouées à évoluer dans le temps, conserver les <em>corrections</em> suite à la
relecture dans des <em>commits séparés</em> facilite le travail de relecture. En cas de <code>rebase</code> et de
relectures multiples par la même personne ils sont le moyen d&rsquo;économiser une nouvelle relecture
complète (demandez de l&rsquo;aide au besoin) :</p><ul><li><em>Ajoutez des commits de fixup</em>, amend, squash ou reword à l&rsquo;aide de la
<a href=https://git-scm.com/docs/git-commit#Documentation/git-commit.txt---fixupamendrewordltcommitgt>documentation dédiée à git commit</a>.</li><li><em>Fusionnez automatiquement les corrections</em> dans les commits originaux de votre PR et vérifier le résultat , à l&rsquo;aide de
<a href=https://git-scm.com/docs/git-rebase#Documentation/git-rebase.txt---autosquash><code>git rebase -i --autosquash origin/dev</code></a>
(juste avant le merge et une fois les relectures terminées).</li><li><em>Poussez vos changements</em> avec
<a href=https://git-scm.com/docs/git-push#Documentation/git-push.txt---no-force-with-lease><code>git push --force-with-lease</code></a>
car vous ne poussez pas seulement de nouveaux commits, mais bien un changement des commits existants.</li></ul></blockquote><ol start=3><li><strong>N&rsquo;hésitez pas à relancer vos interlocuteurs, plusieurs fois si besoin est : vous êtes responsable de la vie de votre <em>pull request</em></strong>.</li></ol><h2 id=cycle-de-review>Cycle de review</h2><p>Une revue de code est un processus itératif.
Pour la fluidité d&rsquo;une review, il est impératif de <a href=https://docs.github.com/en/account-and-profile/managing-subscriptions-and-notifications-on-github/setting-up-notifications/configuring-notifications>configurer correctement ses notifications github</a>.</p><p>Il est conseillé de configurer les dépôts OSRD en <em>&ldquo;Participating and @mentions&rdquo;</em>. Cela permet d&rsquo;être notifié d&rsquo;activités uniquement sur les issues et PR auxquelles vous participez.</p><pre class=mermaid>sequenceDiagram
  actor A as Auteur PR
  actor R as Reviewer/mainteneur

  A-&gt;&gt;R: Demande une review en notifiant spécifiquement quelques personnes
  R-&gt;&gt;A: Répond à la demande par oui ou non

  loop Boucle entre auteur et reviewer
    R--&gt;&gt;A: Commente, demande des changements
    A--&gt;&gt;R: Répond à chaque commentaire/demande de changement
    A--&gt;&gt;R: Corrige le code si nécessaire dans des « fixups » dédiés
    R--&gt;&gt;A: Vérifie, teste, et commente à nouveau le code
    R--&gt;&gt;A: Résout les conversations/demandes de changement le cas échéant
  end

  A-&gt;&gt;R: Rebase si nécessaire
  R-&gt;&gt;A: Vérifie l&#39;historique des commits
  R-&gt;&gt;A: Approuve ou ferme la PR
  Note left of R: Et fusionne si mainteneur</pre><blockquote><p>Les mainteneurs sont automatiquement notifiés par le système de <code>CODEOWNERS</code>. L&rsquo;auteur d&rsquo;une PR est responsable de faire avancer sa PR dans le processus de review (quitte à notifier manuellement un mainteneur).</p></blockquote><p><em><a href=https://osrd.fr/fr/docs/guides/contribute/contribute-code/tests/>Continuer enfin vers les tests ‣</a></em></p></div><div class=td-content style=page-break-before:always><h1 id=pg-c9ed9175ac241f91b9cc8c4412a1e488>3.7 - Tests</h1><div class=lead>Recommandations pour les tests</div><h2 id=back-end>Back-end</h2><ul><li>Les tests d&rsquo;intégration sont écrits avec <a href=https://docs.pytest.org/>pytest</a> dans le dossier <code>/tests</code>.</li><li>Chaque route décrite dans les fichiers <code>openapi.yaml</code> doit avoir un test d&rsquo;intégration.</li><li>Le test doit vérifier à la fois le format et le contenu des réponses valides et invalides.</li></ul><h2 id=front-end>Front-end</h2><p>L&rsquo;écriture fonctionnelle des tests est réalisée avec les <em>Product Owners</em>, et les développeurs choisissent une implémentation technique qui répond précisément aux besoins exprimés et qui s&rsquo;intègre dans les recommandations présentes ici.</p><p>Nous utilisons <a href=https://playwright.dev/>Playwright</a> pour écrire les tests bout en bout, et <a href=https://vitest.dev/>vitest</a> pour écrire les tests unitaires.</p><p>Les navigateurs testés sont pour l&rsquo;instant <a href=https://www.mozilla.org/fr/firefox/switch/>Firefox</a> et Chromium.</p><h3 id=principes-de-base>Principes de base</h3><ul><li>Les tests doivent être <strong>courts</strong> (1min max) et aller <strong>droit au but</strong>.</li><li>Les timeout arbitraires sont proscrits, un test doit systématiquement attendre un évènement spécifique. Il est possible d&rsquo;utiliser le <em>polling</em> (retenter une action — un clic par exemple — au bout d&rsquo;un certain temps) proposé dans l&rsquo;API de <a href=https://playwright.dev/>Playwright</a>.</li><li>Les tests doivent tous pouvoir être parallélisables.</li><li>Les tests ne doivent pas pointer/attendre des éléments de texte issus de la traduction, préférer l&rsquo;arborescence du <em>DOM</em> ou encore placer des <code>id</code> spécifiques.</li><li>On ne teste pas les données mais l&rsquo;application et ses fonctionnalités. Des tests spécifiques aux données sont à élaborer par ailleurs.</li></ul><h4 id=données>Données</h4><p><strong>Les données testées doivent impérativement être des données publiques.</strong>
Les données nécessaires (infrastructure et matériel) aux tests sont proposées dans des fichiers <code>json</code> de l&rsquo;application, <em>injectées</em> au début de chaque test et effacées à la fin peu importe son résultat ou la manière d&rsquo;être stoppé, y compris par <code>CTRL+C</code>.</p><p>Cela se fait par des appels API en typescript avant de lancer le test à proprement parler.</p><p>Les données testées sont les mêmes en local ou via l&rsquo;intégration continue.</p><h4 id=processus-de-développement-des-tests-e2e>Processus de développement des tests e2e</h4><p>Les tests e2e sont implémentés de manière itérative, et livrés en même temps que les développements. À noter que:</p><ul><li>les tests e2e ne doivent être développés que sur les parcours utilisateurs critiques de l&rsquo;application.</li><li>ce workflow permet d’éviter les régressions immédiates après la sortie d&rsquo;une fonctionnalité, de faire monter toute l’équipe en compétences sur les tests e2e et d’éviter des PRs très longues qui ajouteraient des tests e2e entiers</li><li>on accepte que les tests e2e soient partiels le temps des développements et que le développement des tests alourdisse la taille des tickets et le temps de développement.</li><li>certaines parties du test devront être mockées le temps que la fonctionnalité soit entièrement développée mais à la fin des développements, le test e2e devra être complet et les données mockées devront avoir disparu. Les modifications finales à faire dans le test pour retirer le mocking seront normalement minimes (uniquement changer les expected values).</li><li>les cas de test et les parcours utilisateur devront être définis en amont, au moment de la conception du ticket (<em>refinement</em>), avant le PIP. Ils pourront être proposés par un QA ou un.e PO, et devront être validés par un QA, le.la PO compétent.e et des devs front.</li><li>si un test e2e touche à la configuration des tests e2e, à l’architecture du projet (typiquement le snapshotting) ou présente un risque de ralentir la CI, un atelier de conception (<em>refinement</em>) devra être organisé pour consulter les personnes en charge de l&rsquo;architecture du projet et de la CI, notamment la team devops.</li></ul><h4 id=atomicité-dun-test>Atomicité d&rsquo;un test</h4><p>Chaque test doit être <strong>atomique</strong> : il se suffit à lui-même et ne peut pas être divisé.</p><p>Un test va cibler une fonctionnalité ou un composant, si ce dernier n&rsquo;est pas trop gros. Un test ne testera pas tout un module ou tout une application, ce sera forcément un ensemble de tests afin de préserver l&rsquo;atomicité des tests.</p><p>Si un test a besoin que des éléments soient créés ou ajoutés, ces opérations doivent être opérées par des appels API en typescript en amont du test, à l&rsquo;instar de ce qui est fait pour l&rsquo;ajout de données. Ces éléments doivent être supprimés à l&rsquo;issue du test, peu importe son résultat ou la manière d&rsquo;être stoppé, y compris par <code>CTRL+C</code>.</p><p>Cela permettra notamment la parallélisation des tests.</p><p>Un test peut cependant, dans certains cas de figure où cela est pertinent, contenir plusieurs sous-divisions de test, clairement explicitées, et justifiées (plusieurs <code>test()</code> dans un seul <code>describe()</code>).</p><h3 id=exemple-de-test>Exemple de test</h3><p>Le besoin : « nous voulons tester l&rsquo;ajout d&rsquo;un train dans une grille horaire ».</p><ol><li>ajouter l&rsquo;infrastructure et le matériel roulant de test dans la base de données <strong>par appels API</strong></li><li>créer projet, étude et scénario avec choix de l&rsquo;infra de test <strong>par appels API</strong></li><li>début du test qui clique sur « ajouter un ou plusieurs trains » jusqu&rsquo;à la vérification de la présence des trains dans la grille horaire</li><li>le test a réussi, a échoué, ou est stoppé, le projet, l&rsquo;étude et le scénario sont effacés, ainsi que le matériel roulant et et l&rsquo;infrastructure de test <strong>par appels API</strong></li></ol><p><em>NB : le test ne va pas tester toutes les possibilités offertes par l&rsquo;ajout de trains, cela relève d&rsquo;un test spécifique qui testerait la réponse de l&rsquo;interface pour tous les cas de figure sans ajouter de trains.</em></p><p><em><a href=https://osrd.fr/fr/docs/guides/contribute/contribute-code/write-code/>Continuer vers l&rsquo;écriture de code ‣</a></em></p></div><div class=td-content style=page-break-before:always><h1 id=pg-f29e34723cf01ba920bd21548bdf1c2e>4 - Revue de code</h1><div class=lead>Comment faire des retours constructifs</div><p>Le reviewer/mainteneur s&rsquo;engage à effectuer la revue de code rapidement, c&rsquo;est aussi à lui qu&rsquo;appartient de fermer les « <em>request changes</em> », de bien vérifier l&rsquo;historique des commits, et de fusionner la « <em>pull request</em> » s&rsquo;il en a les droits.</p><p>Nous vous soumettons quelques conseils et recommandations qui nous semblent pertinentes pour une revue de code humaine, pertinente et enrichissante pour tous ses contributeurs :</p><ul><li><a href=https://mtlynch.io/code-review-love/>How to Make Your Code Reviewer Fall in Love with You?</a> par Michael Lynch.</li><li><a href=https://mtlynch.io/human-code-reviews-1/>How to Do Code Reviews Like a Human? </a>par Michael Lynch.</li></ul><h2 id=cycle-de-review>Cycle de review</h2><p>Une revue de code est un processus itératif.
Pour la fluidité d&rsquo;une review, il est impératif de <a href=https://docs.github.com/en/account-and-profile/managing-subscriptions-and-notifications-on-github/setting-up-notifications/configuring-notifications>configurer correctement ses notifications github</a>.</p><p>Il est conseillé de configurer les dépôts OSRD en <em>&ldquo;Participating and @mentions&rdquo;</em>. Cela permet d&rsquo;être notifié d&rsquo;activités uniquement sur les issues et PR auxquelles vous participez.</p><pre class=mermaid>sequenceDiagram
  actor A as Auteur PR
  actor R as Reviewer/mainteneur

  A-&gt;&gt;R: Demande une review en notifiant spécifiquement quelques personnes
  R-&gt;&gt;A: Répond à la demande par oui ou non

  loop Boucle entre auteur et reviewer
    R--&gt;&gt;A: Commente, demande des changements
    A--&gt;&gt;R: Répond à chaque commentaire/demande de changement
    A--&gt;&gt;R: Corrige le code si nécessaire dans des « fixups » dédiés
    R--&gt;&gt;A: Vérifie, teste, et commente à nouveau le code
    R--&gt;&gt;A: Résout les conversations/demandes de changement le cas échéant
  end

  A-&gt;&gt;R: Rebase si nécessaire
  R-&gt;&gt;A: Vérifie l&#39;historique des commits
  R-&gt;&gt;A: Approuve ou ferme la PR
  Note left of R: Et fusionne si mainteneur</pre><blockquote><p>Les mainteneurs sont automatiquement notifiés par le système de <code>CODEOWNERS</code>. L&rsquo;auteur d&rsquo;une PR est responsable de faire avancer sa PR dans le processus de review (quitte à notifier manuellement un mainteneur).</p></blockquote><h2 id=la-pyramide-de-la-revue-de-code>La pyramide de la revue de code</h2><figure><a href=https://www.morling.dev/blog/the-code-review-pyramid/><img src=/images/docs/contribute/code_review_pyramid.svg></a></figure><h2 id=script-pour-le-test-dune-pr>Script pour le test d&rsquo;une PR</h2><p>Lors de la revue d&rsquo;une PR, il est utile de tester les changements en démarrant une instance de l&rsquo;application OSRD basée sur la branche de la PR.</p><p>Un script est disponible pour lancer automatiquement une instance séparée et dédiée de l&rsquo;application en utilisant le numéro de la PR. Le script utilise les images Docker déjà construites par la CI et lance l&rsquo;application de manière isolée. Cela permet d&rsquo;exécuter les deux instances en parallèle, sans conflits (idéal pour comparer les modifications, par exemple).</p><p>De plus, vous pouvez fournir une sauvegarde de la base de données, que le script chargera directement dans l&rsquo;application.</p><p>L&rsquo;application sera lancée sur le port 4001. Vous pouvez y accéder en suivant : http://localhost:4001/</p><h3 id=commandes-disponibles->Commandes Disponibles :</h3><ul><li><code>./scripts/pr-tests-compose.sh 8914 up</code> : Télécharge les images CI générées pour la PR #8914 et lance l&rsquo;application.</li><li><code>./scripts/pr-tests-compose.sh 8914 up-and-load-backup ./path_to_backup</code> : Télécharge les images pour la PR #8914, restaure les données à partir de la sauvegarde spécifiée, et démarre l&rsquo;application.</li><li><code>./scripts/pr-tests-compose.sh down</code> : Arrête l&rsquo;instance de test de l&rsquo;application pour la PR #8914.</li><li><code>./scripts/pr-tests-compose.sh down-and-clean</code> : Arrête l&rsquo;instance de test et nettoie l&rsquo;ensemble des volumes docker de l&rsquo;instance (base de donnée PG, cache Valkey, RabbitMQ) pour éviter tout effet de bord.</li></ul><h3 id=accès-aux-services->Accès aux Services :</h3><p>À l&rsquo;exception du serveur frontend, tous les services sont disponibles sur localhost, avec un léger ajustement de port (pour éviter les conflits avec l&rsquo;environnement de développement) : pour la liste des ports, reportez-vous au <a href=https://github.com/OpenRailAssociation/osrd/blob/dev/docker/docker-compose.pr-test.yml>fichier docker compose dédié</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-987ae2aead487e6aad8654531bf0e679>5 - Signaler des problèmes</h1><div class=lead>Comment signaler un bug ou suggérer une amélioration</div><p><strong>N&rsquo;hésitez pas à signaler tout ce qui vous semble important !</strong></p><p>Notre outil de suivi des bugs est <a href=https://github.com/OpenRailAssociation/osrd/issues>github</a>. Il est nécessaire de s&rsquo;inscrire pour signaler un bug.</p><p>Suivez <a href=https://github.com/OpenRailAssociation/osrd/issues/new/choose>ce lien</a> et choisissez le modèle qui correspond à votre cas de figure.</p><h3 id=bugs>Bugs</h3><ul><li>Le bug doit avoir une description correcte et le modèle du bug doit être rempli avec soin.</li><li>Le bug doit être étiqueté avec (<em>pour les membres de l&rsquo;équipe</em>) :<ul><li><code>kind:bug</code></li><li>une ou plusieurs <code>area:&lt;affected_area></code> si possible (si la zone affectée n&rsquo;est pas connue, laissez-la vide et elle sera ajoutée plus tard par un autre membre de l&rsquo;équipe).</li><li>un <code>severity:&lt;bug_severity></code> si possible (si la sévérité n&rsquo;est pas connue, laissez-la vide et elle sera ajoutée plus tard par un autre membre de l&rsquo;équipe).<ul><li><code>severity:minor</code> : L&rsquo;utilisateur peut encore utiliser la fonctionnalité.</li><li><code>severity:major</code> : L&rsquo;utilisateur ne peut parfois pas utiliser la fonctionnalité.</li><li><code>severity:critical</code> : L&rsquo;utilisateur ne peut pas utiliser la fonctionnalité.</li></ul></li></ul></li><li>Les membres de l&rsquo;équipe OSRD peuvent modifier les étiquettes des problèmes (gravité, domaine, type, &mldr;).
Vous pouvez laisser un commentaire pour expliquer les changements.</li><li>Si vous travaillez sur un bug ou planifiez de travailler sur un bug, assignez vous au bug.</li><li>Les PRs qui résolvent des bugs doivent ajouter des tests de régression pour s&rsquo;assurer que le bug ne reviendra pas dans le futur.</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-59d5d4e46db83500a6acfc6ba3354b64>6 - Installer docker</h1><p>Peu importe votre système d&rsquo;exploitation, docker requiert linux pour fonctionner.
Lorsqu&rsquo;utilisé sous un autre système d&rsquo;exploitation, docker a besoin de machines
virtuelles linux pour build et exécuter des images.</p><p>Il y a deux types d&rsquo;installation docker :</p><ul><li>docker engine est l&rsquo;application en ligne de commande</li><li>docker desktop est une application graphique, qui gère aussi la virtualisation</li></ul><p>Voici nos suggestions :</p><ul><li>Si vous êtes sous linux, installez docker engine <a href=https://docs.docker.com/engine/install/#supported-platforms>via votre gestionnaire de packet</a></li><li>Si vous êtes sous MacOS / Windows, installez <a href=https://www.docker.com/products/docker-desktop/>docker desktop</a> si vous y êtes autorisés</li><li>Si vous êtes sous windows, et voulez faire fonctionner docker sous WSL, ou ne pouvez pas utiliser docker desktop, suivez le <a href=/fr/docs/guides/contribute/install-docker/#docker-sous-wsl>guide docker sous WSL</a></li><li>Si vous êtes sous MacOS, et vous ne pouvez pas utiliser docker desktop, suivez le <a href=/fr/docs/guides/contribute/install-docker/#macos-colima>guide colima pour MacOS</a></li></ul><h2 id=docker-sous-wsl>Docker sous WSL</h2><p>Cette option d&rsquo;installation est très utile, car elle permet de disposer d&rsquo;une installation tout à fait normale de docker engine Linux à l&rsquo;intérieur de WSL, qui reste accessible depuis Windows.</p><ul><li><a href=https://learn.microsoft.com/fr-fr/windows/wsl/install>Installez WSL</a> (Si vous avez une vieille version de WSL, lancez <code>wsl --upgrade</code>)</li><li>Obtenez une image WSL depuis le store microsoft (par exemple, debian or ubuntu)</li><li><a href=https://learn.microsoft.com/fr-fr/windows/wsl/systemd>Activez le support systemd depuis la VM WSL</a></li><li>Suivez le <a href=https://docs.docker.com/engine/install/#supported-platforms>tutoriel d&rsquo;installation docker engine pour votre distribution WSL</a></li><li>Si vous avez docker desktop installé, vous pouvez <a href=https://learn.microsoft.com/en-us/windows/wsl/tutorials/wsl-containers>le configurer pour qu&rsquo;il utilise WSL</a></li></ul><h2 id=macos-colima>MacOS colima</h2><p>Cette procédure permet d&rsquo;installer docker sans passer par docker desktop. Elle utilise colima comme solution de virtualisation.</p><ol><li><a href=https://brew.sh/>Installez homebrew</a></li><li><code>brew install docker docker-compose colima</code></li><li>Installez le plugin compose : <code>mkdir -p ~/.docker/cli-plugins && ln -sfn $(brew --prefix)/opt/docker-compose/bin/docker-compose ~/.docker/cli-plugins/docker-compose</code></li><li><a href="https://github.com/abiosoft/colima?tab=readme-ov-file#customizing-the-vm">Configurez colima</a> :</li></ol><ul><li>pour des macbooks apple silicon (M1/M2) : <code>colima start --cpu 2 --memory 6 --arch aarch64 --vm-type=vz --vz-rosetta --mount-type=virtiofs</code></li><li>pour de petites infrastructures: <code>colima start --cpu 2 --memory 4</code></li><li>pour de grosses infrastructures: <code>colima start --cpu 2 --memory 6</code></li></ul><ol start=5><li><code>brew services start colima</code> pour lancer automatiquement colima au démarrage</li><li>Quittez votre terminal, ouvrez-en un nouveau</li><li>Vous pouvez maintenant utiliser docker CLI</li></ol><div class="alert alert-info" role=alert><p>Si vous utiliser rancher desktop, veuillez soit:</p><ul><li>désinstaller l&rsquo;application</li><li>sélectionner <code>Manuel</code> dans <code>Préférences</code> > <code>Application</code> > <code>Environnement</code></li></ul></div><div class="alert alert-info" role=alert>En cas d&rsquo;erreur au démarrage avec Rosetta 2, lancez <code>colima delete</code> et réessayez (le format de disque n&rsquo;est pas compatible). Les paramètres seront perdus.</div><div class="alert alert-info" role=alert><p>Si vous avez cette erreur: <code>error getting credentials - err: exec: "docker-credential-osxkeychain": executable file not found in $PATH</code></p><p>Ouvrez <code>~/.docker/config.json</code>, et enlevez <code>"credsStore": "osxkeychain"</code></p></div></div><div class=td-content style=page-break-before:always><h1 id=pg-a6b5ed2313c4aa287c4250d8f8de644d>7 -</h1><h2 id=cycle-de-review>Cycle de review</h2><p>Une revue de code est un processus itératif.
Pour la fluidité d&rsquo;une review, il est impératif de <a href=https://docs.github.com/en/account-and-profile/managing-subscriptions-and-notifications-on-github/setting-up-notifications/configuring-notifications>configurer correctement ses notifications github</a>.</p><p>Il est conseillé de configurer les dépôts OSRD en <em>&ldquo;Participating and @mentions&rdquo;</em>. Cela permet d&rsquo;être notifié d&rsquo;activités uniquement sur les issues et PR auxquelles vous participez.</p><pre class=mermaid>sequenceDiagram
  actor A as Auteur PR
  actor R as Reviewer/mainteneur

  A-&gt;&gt;R: Demande une review en notifiant spécifiquement quelques personnes
  R-&gt;&gt;A: Répond à la demande par oui ou non

  loop Boucle entre auteur et reviewer
    R--&gt;&gt;A: Commente, demande des changements
    A--&gt;&gt;R: Répond à chaque commentaire/demande de changement
    A--&gt;&gt;R: Corrige le code si nécessaire dans des « fixups » dédiés
    R--&gt;&gt;A: Vérifie, teste, et commente à nouveau le code
    R--&gt;&gt;A: Résout les conversations/demandes de changement le cas échéant
  end

  A-&gt;&gt;R: Rebase si nécessaire
  R-&gt;&gt;A: Vérifie l&#39;historique des commits
  R-&gt;&gt;A: Approuve ou ferme la PR
  Note left of R: Et fusionne si mainteneur</pre><blockquote><p>Les mainteneurs sont automatiquement notifiés par le système de <code>CODEOWNERS</code>. L&rsquo;auteur d&rsquo;une PR est responsable de faire avancer sa PR dans le processus de review (quitte à notifier manuellement un mainteneur).</p></blockquote></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="td-footer__left col-6 col-sm-4 order-sm-1"></div><div class="td-footer__right col-6 col-sm-4 order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=GitHub aria-label=GitHub><a target=_blank rel=noopener href=https://github.com/OpenRailAssociation/osrd aria-label=GitHub><i class="fab fa-github"></i></a></li></ul></div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2"><span class=td-footer__copyright>&copy;
2025
<span class=td-footer__authors>Contributeurs à OSRD.</span></span><span class=td-footer__all_rights_reserved>Tous droits réservés</span></div></div></div></footer></div><style>.markmap>svg{width:100%;height:300px}</style><script>window.markmap={autoLoader:{manual:!0,onReady(){const{autoLoader:e,builtInPlugins:t}=window.markmap;e.transformPlugins=t.filter(e=>e.name!=="prism")}}}</script><script src=https://cdn.jsdelivr.net/npm/markmap-autoloader></script><script src=/js/main.min.70982f4f1de53d56b47d6b66c1ed442a9653a5be8820e0ba651d5d17d9a9bbe1.js integrity="sha256-cJgvTx3lPVa0fWtmwe1EKpZTpb6IIOC6ZR1dF9mpu+E=" crossorigin=anonymous></script><script defer src=/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script><script src=/js/tabpane-persist.js></script></body></html>