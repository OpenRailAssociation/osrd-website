<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=canonical type=text/html href=https://osrd.fr/en/docs/explanation/><link rel=alternate type=application/rss+xml href=https://osrd.fr/en/docs/explanation/index.xml><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Explanations | OSRD</title>
<meta name=description content="Learn more about key concepts"><meta property="og:title" content="Explanations"><meta property="og:description" content="Learn more about key concepts"><meta property="og:type" content="website"><meta property="og:url" content="https://osrd.fr/en/docs/explanation/"><meta itemprop=name content="Explanations"><meta itemprop=description content="Learn more about key concepts"><meta name=twitter:card content="summary"><meta name=twitter:title content="Explanations"><meta name=twitter:description content="Learn more about key concepts"><link rel=preload href=/scss/main.min.4d9db1288b215f6876c21ef883bcd30df98e7409451895d47ac7aa0297a1a496.css as=style><link href=/scss/main.min.4d9db1288b215f6876c21ef883bcd30df98e7409451895d47ac7aa0297a1a496.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.6.3.min.js integrity="sha512-STof4xm1wgkfm7heWqFJVn58Hm3EtS31XFaagaa8VMReCXAkQnJZ+jEy8PCC/iT18dFy95WcExNHFTqLyp72eQ==" crossorigin=anonymous></script><script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script></head><body class=td-section><header><nav class="td-navbar navbar-dark js-navbar-scroll"><div class="container-fluid flex-column flex-md-row"><a class=navbar-brand href=/en/><span class="navbar-brand__logo navbar-logo"><svg xmlns="http://www.w3.org/2000/svg" id="svg36" width="110.767" height="22"><style id="style1">.st9{fill:#fff}</style><g id="ok" transform="scale(.1918)"><g id="g36"><g id="g29"><path id="path23" d="M38.5 83.4c-1.9 8.2-2.9 17-2.9 26.5v4.8h16.6c-2.8-13.2-7.8-23.4-13.7-31.3z" class="st9"/><path id="path24" d="M0 57.5v19.9c3.1 1.2 6.3 2.7 9.5 4.6 8.5 5.2 15 12.6 19.4 21.8v-31c-3.4-3-6.9-5.5-10.3-7.5-6.5-3.7-13-6.2-18.6-7.8z" class="st9"/><path id="path25" d="M35.6 69.9c4.3-11.3 10.6-21.1 18.9-29.4V0H35.6z" class="st9"/><path id="path26" d="M40.8 75.4c5.3 6.2 10.1 13.8 13.7 23.3V50.6C48.6 57.8 44 66.1 40.8 75.4z" class="st9"/><path id="path27" d="M100.7.0H61.3v34.5C73.1 25.2 86 20 96.9 17.2c1.8-.5 3.7.6 4.1 2.4.5 1.8-.6 3.6-2.4 4.1-11.4 2.9-25.3 8.6-37.2 19.7v31.8c2.9-6.3 6.7-11.7 11.4-16.4 9.4-9.3 21-14.1 30.5-16.6 1.8-.5 3.7.6 4.1 2.4.5 1.8-.6 3.6-2.4 4.1-4.7 1.2-10.1 3.1-15.3 6-19 10.3-28.2 28.4-28.2 55.2v4.8h39.3c7.8.0 14.1-6.3 14.1-14.1V14.1C114.7 6.3 108.4.0 100.7.0z" class="st9"/><path id="path28" d="M22 59.6c2.2 1.3 4.5 2.8 6.8 4.6V0H14.1C6.3.0.0 6.3.0 14.1v36.4c6.5 1.7 14.2 4.5 22 9.1z" class="st9"/><path id="path29" d="M5.4 87.5c-1.8-1.1-3.6-2-5.4-2.8v15.9c0 7.8 6.3 14.1 14.1 14.1h11.6c-3.6-12.2-10.4-21.3-20.3-27.2z" class="st9"/></g><g id="g30"><path id="path30" d="M201.7 109c-30.8.0-53.7-21.2-53.7-52.5.0-31.7 22.9-51.6 53.7-51.6 31 0 53.9 20 53.9 51.6-.1 31.3-23 52.5-53.9 52.5zm0-82.6c-16.7.0-28.2 12.8-28.2 30.1.0 17.9 11.6 30.7 28.2 30.7S230 74.4 230 56.6c0-17.3-11.6-30.2-28.3-30.2z" class="st9"/></g><g id="g32"><g id="g31"><path id="path31" d="M334.3 33.3c-4-5.2-11.4-8.5-17.6-8.5-6.2.0-13.8 2.1-13.8 9.9.0 6.6 5.9 8.7 15.2 11.6 13.4 4.3 30.7 10 30.7 29.7.0 22.7-18.3 32.9-37.8 32.9-14.1.0-28.3-5.2-37-14.2l15.6-15.9c4.7 6 13.5 10.5 21.3 10.5 7.3.0 13.7-2.8 13.7-10.7.0-7.5-7.5-9.9-20.5-14.1C291.6 60.3 279 53.9 279 36c0-21.9 19.8-31 38.2-31 11.2.0 23.7 4.2 32.4 12.1z" class="st9"/></g></g><g id="g34"><g id="g33"><path id="path32" d="m433.1 106.4-21.3-39.2h-8.1v39.2h-23.4V7.6H418c19 0 37.8 7.3 37.8 29.9.0 13.3-7.8 22.7-20.5 26.6l25.8 42.3zm-16.9-79.6h-12.7v23h11.3c7.7.0 17.3-2 17.3-12 0-9.2-8.7-11-15.9-11z" class="st9"/></g></g><g id="g35"><path id="path34" d="M522.2 106.4h-36.8V7.6H521c28 0 56.5 11.7 56.5 49.1.0 34.7-28.1 49.7-55.3 49.7zm-1.7-78.5h-11.9v57.8h11.3c17 0 32.8-7 32.8-29 0-22.2-15.8-28.8-32.2-28.8z" class="st9"/></g></g></g></svg></span><span class=navbar-brand__name>OSRD</span></a><div class="td-navbar-nav-scroll ms-md-auto" id=main_navbar><ul class=navbar-nav><li class=nav-item><a class=nav-link href=/en/about/><span>About</span></a></li><li class=nav-item><a class="nav-link active" href=/en/docs/><span>Documentation</span></a></li><li class=nav-item><a class=nav-link href=/en/blog/><span>Blog</span></a></li><li class=nav-item><a class=nav-link href=/en/join-us/><span>Join us</span></a></li><li class="nav-item dropdown d-none d-lg-block"><div class=dropdown><a class="nav-link dropdown-toggle" href=# role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false>English</a><ul class=dropdown-menu><li><a class=dropdown-item href=/fr/docs/explanation/>Français</a></li></ul></div></li></ul></div><div class="d-none d-lg-block"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/offline-search-index.811ebbfcf8d720efccf48319395e12c7.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>This is the multi-page printable view of this section.
<a href=# onclick="return print(),!1">Click here to print</a>.</p><p><a href=/en/docs/explanation/>Return to the regular view of this page</a>.</p></div><h1 class=title>Explanations</h1><div class=lead>Learn more about key concepts</div><ul><li>1: <a href=#pg-8ef87c74feef42731dbf259523e8021d>Containers architecture</a></li><ul></ul><li>2: <a href=#pg-a151e2a634dc5820b05191ae97d90e14>Models</a></li><ul><li>2.1: <a href=#pg-f205938bbebab94d2a57f42f781e4fb1>Infrastructure example</a></li><li>2.2: <a href=#pg-d8a9003e9780b0213913d2b62364ed28>Neutral Sections</a></li></ul><li>3: <a href=#pg-d0b32c1c59097b608e257ee86e580a19>Running time calculation</a></li><ul><li>3.1: <a href=#pg-0fa7914af29cb313adb8b16f8dc2bcc0>Physical modeling</a></li><li>3.2: <a href=#pg-ea6d32407559a3426f098dbe1408c955>Numerical integration</a></li><li>3.3: <a href=#pg-4ea0de1a5a62574096209d692bf76d42>Envelopes system</a></li><li>3.4: <a href=#pg-8a7d650e7008d319d63327b9d7bb4ff5>Pipeline</a></li><li>3.5: <a href=#pg-1e84eea96c6b439c99ded337aa3be95b>Allowances</a></li></ul><li>4: <a href=#pg-9f55fb9e6e2f9fcd8a53e969e1550274>Netzgrafik-Editor</a></li><ul></ul></ul><div class=content><p>Explanations discuss key topics and concepts at a fairly high level and provide useful background information and explanation.</p></div></div><div class=td-content><h1 id=pg-8ef87c74feef42731dbf259523e8021d>1 - Containers architecture</h1><div class=lead>How the containers works together and how they are built</div><p>There are 3 main containers deployed in a standard OSRD setup:</p><ul><li><strong>Gateway</strong> <em>(includes the frontend)</em>: Serves the front end, handles authentication and proxies requests to the backend.</li><li><strong>Editoast</strong>: Acts as the backend that interacts with the front end.</li><li><strong>Core</strong>: Handles computation and business logic, called by Editoast.</li></ul><h2 id=standard-deployment>Standard deployment</h2><p>The standard deployment can be represented with the following diagram.</p><pre class=mermaid>flowchart TD
    gw[&#34;gateway&#34;]
    front[&#34;front-end static files&#34;]
    gw -- local file --&gt; front
    
    browser --&gt; gw
    gw -- HTTP --&gt; editoast
    editoast -- HTTP --&gt; core</pre><p>External requests are received by the gateway. If the path asked starts with <code>/api</code> it will be forwarded using HTTP to editoast, otherwise it will serve a file with the asked path. Editoast reach the core using HTTP if required.</p><p>The gateway is not only a reverse proxy with the front-end bundle included, it also provides all the authentication mechanisms: using OIDC or tokens.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-a151e2a634dc5820b05191ae97d90e14>2 - Models</h1><div class=lead>What is modeled in OSRD, and how it is modeled</div></div><div class=td-content><h1 id=pg-f205938bbebab94d2a57f42f781e4fb1>2.1 - Infrastructure example</h1><div class=lead>Explains using an example how infrastructure data is structured</div><font color=#aa026d><h3 id=introduction>Introduction</h3></font><p>This page gives an example of how the data formats are used to describe an infrastructure in <strong>OSRD</strong>.</p><p>For this purpose, let&rsquo;s take as an example the following toy infrastructure:</p><p><img src=svg_diagrams/small_infra_diagram.drawio.en.svg alt="Toy infrastructure diagram"></p><div class="alert alert-info" role=alert><h4 class=alert-heading>Tip</h4>To zoom in on diagrams, click on the edit button that appears when hovering over it.</div><p>This diagram is an overview of the infrastructure with lines and stations only.</p><p>This infrastructure is not meant to be realistic, but rather meant to help illustrate OSRD&rsquo;s data model.
This example will be created step by step and explained along the way.</p><h4 id=the-infrastructure-generator>The infrastructure generator</h4><p>In the <a href=https://github.com/OpenRailAssociation/osrd><em>OSRD</em> repository</a> is a <a href=https://github.com/OpenRailAssociation/osrd/tree/dev/python/railjson_generator>python library</a> designed to help generate infrastructures in a format understood by <em>OSRD</em>.</p><p>The infrastructure discussed in this section can be generated thanks to <a href=https://github.com/OpenRailAssociation/osrd/blob/dev/python/railjson_generator/railjson_generator/scripts/examples/small_infra.py>small_infra.py</a> file. To learn more about the generation scripts, you can check out the related <a href=https://github.com/OpenRailAssociation/osrd/blob/dev/python/railjson_generator/README.md>README</a>.</p><font color=#aa026d><h3 id=tracks>Tracks</h3></font><h4 id=track-sections>Track sections</h4><p>The first objects we need to define are <code>TrackSections</code>. Most other objects are positioned relative to track sections.</p><p>A track section is a section of rail (switches not included). One can chose to divide the tracks of their infrastructure in as many track sections as they like. Here we chose to use the longest track sections possible, which means that between two switches there is always a single track section.</p><p>Track sections is what simulated trains roll onto. They are the abstract equivalent to physical rail sections. Track sections are bidirectional.</p><p>In this example, we define two tracks for the line between the West and North-East stations. We also have overpassing tracks at the North and Mid-West stations for added realism. Finally, we have three separate tracks in the West station, since it&rsquo;s a major hub in our imaginary infrastructure.</p><p><img src=svg_diagrams/small_infra_rails.drawio.en.svg alt="Track sections diagram"></p><div class="alert alert-warning" role=alert><h4 class=alert-heading>Important</h4><p><code>TrackSections</code> are represented as arrows in this diagram to stress the fact that they have a <strong>start</strong> and an <strong>end</strong>. It matters as objects positioned on track sections are located using their distance from the <strong>start</strong> of their track section.</p><p>Therefore, to locate an object at the beginning of its track section, set its offset to 0. To move it to the end of its track section, set its offset to the <code>length</code> of the track section.</p></div><p>These attributes are required for the track section to be complete:</p><ul><li><code>length</code>: the length of the track section in meters.</li><li><code>geo</code>: the coordinates in real life (geo is for geographic), in the <a href=https://en.wikipedia.org/wiki/GeoJSON>GeoJSON</a> format.</li><li>cosmetic attributes: <code>line_name</code>, <code>track_name</code>, <code>track_number</code> which are used to indicate the name and labels that were given to the tracks / lines in real life.</li></ul><p>For all track sections in our infrastructure, the <code>geo</code> attributes very much resemble the given diagram.</p><p>For most track sections, their <code>length</code> is proportional to what can be seen in the diagram. To preserve readability, exceptions were made for <em>TA6</em>, <em>TA7</em>, <em>TD0</em> and <em>TD1</em> (which are 10km and 25km).</p><h4 id=node>Node</h4><p>A <code>Node</code> represents a node in the infrastructure. In an OSRD simulation, a train can only move from one section of track to another if they are linked by a node.</p><h5 id=node-types>Node Types</h5><p><code>NodeTypes</code> have two mandatory attributes:</p><ul><li><code>ports</code>: A list of port names. A port is an endpoint connected to a track section.</li><li><code>groups</code>: A mapping between group names and lists of branch (connection between 2 ports) that characterises the different possible positions of the node type</li></ul><p>At any time, all nodes have an active group, and may have an active branch, which always belongs to the active group. During a simulation, changing the active branch inside a group is instantaneous, but changing the active branch across groups (changing the active group) takes configurable time.
This is because a node is a physical object, and changing active branch can involve moving parts of it. <code>Groups</code> are designed to represent the different positions that a node can have. Each <code>group</code> contains the branches that can be used in the associated node position.</p><p>The duration needed to change group is stored inside the <code>Node</code>, since it can vary depending on the physical implementation of the node.</p><p>Our examples currently use five node types. Node types are just like other objects, and can easily be added as needed using <code>extended_switch_type</code>.</p><p><strong>1) Link</strong></p><p>This one represents the link between two sections of track. It has two ports: <em>A</em> and <em>B</em>.</p><p><img src=svg_diagrams/link.svg alt="Link diagram"></p><p>It is used in the OSRD model to create a link between two track sections. This is not a physical object.</p><p><strong>2) The Point Switch</strong></p><p>The ubiquitous Y switch, which can be thought of as either two tracks merging, or one track splitting.</p><p>This node type has three ports: <em>A</em>, <em>B1</em> and <em>B2</em>.</p><p><img src=svg_diagrams/point_switch.svg alt="Point switch diagram"></p><p>There are two groups, each with one connection in their list: <code>A_B1</code>, which connects <em>A</em> to <em>B1</em>, and <code>A_B2</code> which connects <em>A</em> to <em>B2</em>.</p><p>Thus, at any given moment (except when the switch moves from one group to another), a train can go from <em>A</em> to <em>B1</em> or from <em>A</em> to <em>B2</em> but never to both at the same time. A train cannot go from <em>B1</em> to <em>B2</em>.</p><p>A Point Switch only has two positions:</p><ul><li><em>A</em> to <em>B1</em></li><li><em>A</em> to <em>B2</em></li></ul><p><img src=svg_diagrams/PointSwitch_AtoB1.svg alt="point switch position diagram"> <img src=svg_diagrams/PointSwitch_AtoB2.svg alt="point switch position diagram"></p><p><strong>3) The Crossing</strong></p><p>This is simply two tracks crossing each other.</p><p>This type has four ports: <em>A1</em>, <em>B1</em>, <em>A2</em> et <em>B2</em>.</p><p><img src=svg_diagrams/crossing.svg alt="Cross Switch Diagram"></p><p>It has only one group containing two connections: <em>A1</em> to <em>B1</em> and <em>A2</em> to <em>B2</em>. Indeed this kind of switch is <em>passive</em>: it has no moving parts. Despite having a single group, it is still used by the simulation to enforce route reservations.</p><p>Here are the two different connections this switch type has:</p><ul><li><em>A1</em> to <em>B1</em></li><li><em>A2</em> to <em>B2</em></li></ul><p><img src=svg_diagrams/Crossing_A1toB1.svg alt="Cross Switch Diagram positions"> <img src=svg_diagrams/Crossing_A2toB2.svg alt="Cross Switch Diagram positions"></p><p><strong>4) The Double slip switch</strong></p><p>This one is more like two point switches back to back. It has four ports: <em>A1</em>, <em>A2</em>, <em>B1</em> and <em>B2</em>.</p><p><img src=svg_diagrams/double_slip_crossing.svg alt="Double cross switch diagram"></p><p>However, it has four groups, each with one connection. The four groups are represented in the following diagram:</p><ul><li><em>A1</em> to <em>B1</em></li><li><em>A1</em> to <em>B2</em></li><li><em>A2</em> to <em>B1</em></li><li><em>A2</em> to <em>B2</em></li></ul><p><img src=svg_diagrams/DoubleSlipCrossing_A1toB1.svg alt="Diagram of double crossing switch positions"> <img src=svg_diagrams/DoubleSlipCrossing_A1toB2.svg alt="Diagram of double crossing switch positions"></p><p><img src=svg_diagrams/DoubleSlipCrossing_A2toB1.svg alt="Diagram of double crossing switch positions"> <img src=svg_diagrams/DoubleSlipCrossing_A2toB2.svg alt="Diagram of double crossing switch positions"></p><p><strong>5) The Single slip switch</strong></p><p>This one looks more like a cross between a single needle and a crossover. It has four ports: <em>A1</em>, <em>A2</em>, <em>B1</em> and <em>B2</em>.</p><p><img src=svg_diagrams/single_slip_crossing.svg alt="Single slip switch diagram"></p><p>Here are the three connections that can be made by this switch:</p><ul><li><em>A1</em> to <em>B1</em></li><li><em>A1</em> to <em>B2</em></li><li><em>A2</em> to <em>B2</em></li></ul><p><img src=svg_diagrams/SingleSlipCrossing_A1toB1.svg alt="Diagram of the positions of the single crossing points"> <img src=svg_diagrams/SingleSlipCrossing_A1toB2.svg alt="Diagram of the positions of the single crossing points">
<img src=svg_diagrams/SingleSlipCrossing_A2toB2.svg alt="Diagram of the positions of the single crossing points"></p><h5 id=back-to-nodes>Back to nodes</h5><p>A <code>Node</code> has three attributes:</p><ul><li><code>node_type</code>: the identifier of the <a href=#node-types><code>NodeType</code></a> of this node.</li><li><code>ports</code>: a mapping from port names to track sections extremities.</li><li><code>group_change_delay</code>: the time it takes to change which group of the node is activated.</li></ul><p>The port names must match the ports of the node type chosen. The track section endpoints can be start or end, be careful to chose the appropriate ones.</p><p>Most of our example&rsquo;s nodes are regular point switches. The path from North station to South station has two cross switches. Finally, there is a double cross switch right before the main line splits into the North-East and South-East lines.</p><p><img src=svg_diagrams/small_infra_rails_n_points.drawio.en.svg alt="Track sections and points diagram"></p><p>It is important to note that these node types are hard-coded into the project code. Only the <code>extended_node_type</code> added by the user will appear in the railjson.</p><h4 id=curves-and-slopes>Curves and slopes</h4><p><code>Curves</code> and <code>Slopes</code> are instrumental to realistic simulations. These objects are defined as a range between a <code>begin</code> and <code>end</code> offsets of one track section. If a curve / slope spans more than one track section, it has to be added to all of them.</p><p>The slope / curve values are constant on their entire range. For varying curves / slopes, one needs to create several objects.</p><p>Slope values are measured in <em>meters per kilometers</em>, and the curve values are measured in <em>meters</em> (the radius of the curve).</p><div class="alert alert-primary" role=alert>Mind that the <code>begin</code> value should always be smaller than the <code>end</code> value. That is why the curve / slope values can be negative: an uphill slope of 1 going from offset 10 to 0 is the same as a downhill slope of -1 going from offsets 0 to 10.</div><p>In the <a href=https://github.com/OpenRailAssociation/osrd/blob/dev/python/railjson_generator/railjson_generator/scripts/examples/small_infra.py>small_infra.py</a> file, we have slopes on the track sections <em>TA6</em>, <em>TA7</em>, <em>TD0</em> and <em>TD1</em>.</p><p>There are curves as well, on the track sections <em>TE0</em>, <em>TE1</em>, <em>TE3</em> and <em>TF1</em>.</p><font color=#aa026d><h3 id=interlocking>Interlocking</h3></font><p>All objects so far contributed to track topology (shape). Topology would be enough for trains to navigate the network, but not enough to do so safely. to ensure safety, two systems collaborate:</p><ul><li>Interlocking ensures trains are allowed to move forward</li><li>Signaling is the mean by which interlocking communicates with the train</li></ul><h4 id=detectors>Detectors</h4><p>These objects are used to create <a href="https://ressources.data.sncf.com/explore/dataset/lexique-des-acronymes-sncf/table/?sort=abreviation&amp;q=TVD">TVD</a> sections (Track Vacancy Detection section): the track area in between detectors is a TVD section. When a train runs into a detector, the section it is entering becomes occupied. The only function of TVD sections is to locate trains.</p><p>In real life, detectors can be <a href=https://en.wikipedia.org/wiki/Axle_counter>axle counters</a> or <a href=https://en.wikipedia.org/wiki/Track_circuit>track circuits</a> for example.</p><p>For this mean of location to be efficient, detectors need to be placed regularly along your tracks, not too many because of cost, but not too few, because then TVD sections would be very large and trains would need to be very far apart to be told apart, which reduces capacity.</p><p>There often are detectors close to all sides of switches. This way, interlocking is made aware pretty much immediately when a switch is cleared, which is then free to be used again.</p><div class="alert alert-info" role=alert>Let&rsquo;s take a cross switch as an example: if train A is crossing it <em>north</em> to <em>south</em> and train B is coming to cross <em>west</em> to <em>east</em>, then as soon as train A&rsquo;s last car has passed the crossing, B should be able to go, since A is now on a completely unrelated track section.</div><p>In <em>OSRD</em>, detectors are point objects, so all the attributes it needs are its <code>id</code>, and track location (<code>track</code> and <code>offset</code>).</p><p><img src=svg_diagrams/small_infra_detectors.drawio.en.svg alt="Infra diagram with all detectors"></p><div class="alert alert-info" role=alert>The clumped up squares represent many detectors at once. Indeed, because some track sections are not represented with their full length, we could not represent all the detectors on the corresponding track section.</div><p>Some notes:</p><ul><li>Between some points, we added only one detector (and not two), because they were really close together, and it would have made no sense to create a tiny TVDS between the two. This situation happened on track sections (<em>TA3</em>, <em>TA4</em>, <em>TA5</em>, <em>TF0</em> and <em>TG3</em>).</li><li>In our infrastructure, there is relatively few track sections which are long enough to require more detectors than just those related to switches. Namely, <em>TA6</em>, <em>TA7</em>, <em>TDO</em>, <em>TD1</em>, <em>TF1</em>, <em>TG1</em> and <em>TH1</em>. For example <em>TD0</em>, which measures 25km, has in fact 17 detectors in total.</li></ul><h4 id=buffer-stops>Buffer stops</h4><p><code>BufferStops</code> are obstacles designed to prevent trains from sliding off dead ends.</p><p>In our infrastructure, there is a buffer stop on each track section which has a loose end. There are therefore 8 buffer stops in total.</p><p>Together with detectors, they set the boundaries of TVD sections (see <a href=#detectors>Detectors</a>)</p><h4 id=routes>Routes</h4><p>A <code>Route</code> is an itinerary in the infrastructure. A train path is a sequence of routes. Routes are used to reserve section of path with the interlocking. See the <a href=/fr/docs/reference/design-docs/interlocking/>dedicated documentation</a>.</p><p>It is represented with the following attributes:</p><ul><li><code>entry_point</code> and <code>exit_point</code>: references detectors or buffer stops which mark the beginning and the end of the Route.</li><li><code>entry_point_direction</code> : Direction on a track section to start the route from the <code>entry_point</code>.</li><li><code>switches_direction</code> : A set of directions to follow when we encounter a switch on our Route, to build this Route from <code>entry_point</code> to <code>exit_point</code>.</li><li><code>release_detectors</code>: When a train clears a release detector, resources reserved from the beginning of the route until this detector are released.</li></ul><font color=#aa026d><h3 id=signaling>Signaling</h3></font><p>Thanks to interlocking, trains are located and allowed to move. It&rsquo;s a good start, but meaningless until trains are made aware of it. This is where <code>Signal</code>s come into play: signals react to interlocking, and can be seen by trains.</p><p>How trains react to signals depends on the aspect, kind of signal, and signaling system.</p><p>Here are the most important attributes for signals:</p><ul><li><code>linked_detector</code>: The linked <a href=#detectors>detector</a>.</li><li><code>type_code</code>: The type of signal.</li><li><code>direction</code>: The direction it protects, which can simply be interpreted as the way in which it can be seen by an incoming train (since there are lights only on one side&mldr;). Direction is relative to track section orientation.</li><li>Cosmetic attributes like <code>angle_geo</code> or <code>side</code> which control the way in which the signals are displayed in the front-end.</li></ul><p>Here is a visualization of how one can represent a signal, and which direction it protects.</p><p><img src=svg_diagrams/signal_dir.en.svg alt="Signal direction example"></p><br><p>The way the signals are arranged is highly dependent on both signaling system and infrastructure manager.</p><p>Here are the basic rules used for this example infrastructure:</p><ul><li>We add two spacing signals (one per direction) for each detector that is cutting a long TVD section into smaller ones.</li><li>Switch entries where a train might have to stop are protected by a signal (which is located outside of the switch TVD section). It must be visible from the direction used to approach the switch. When there are multiple switches in a row, only the first one usually needs protection, as interlocking is usually designed as not to encourage trains stopping in the middle of intersections.</li></ul><p>Note that detectors linked to at least one signal are not represented, as there are not signals without associated detectors in this example.</p><p>To get the <code>id</code> of a detector linked to a signal, take the signal&rsquo;s <code>id</code> and replace <em>S</em> by <em>D</em> (e.g. SA0 -> DA0).</p><p><img src=svg_diagrams/small_infra_signals.drawio.en.svg alt="Infra diagram with all signals"></p><div class="alert alert-info" role=alert>On <em>TA6</em>, <em>TA7</em>, <em>TD0</em> and <em>TD1</em> we could not represent all signals because these track sections are very long and have many detectors, hence many signals.</div><font color=#aa026d><h3 id=electrification>Electrification</h3></font><p>To allow electric trains to run on our infrastructure, we need to specify which parts of the infrastructure is electrified.</p><h4 id=catenaries>Catenaries</h4><p><code>Catenaries</code> are objects that represent the overhead wires that power electric trains. They are represented with the following attributes:</p><ul><li><code>voltage</code>: A string representing the type of power supply used for electrification</li><li><code>track_ranges</code>: A list of range of track sections (<code>TrackRanges</code>) covered by this catenary. A <code>TrackRange</code> is composed of a track section id, a <code>begin</code> offset and an <code>end</code> offset.</li></ul><p>In our example infrastructure, we have two <code>Catenaries</code>:</p><ul><li>One with <code>voltage</code> set to <code>"1500"</code>, which covers only <em>TA0</em>.</li><li>One with <code>voltage</code> set to <code>"25000"</code>, which covers all others except <em>TD1</em>.</li></ul><p>This means that only thermal trains can cross the <em>TD1</em> track section.</p><p>Our example also outlines that, unlike its real life counterpart, a single <code>Catenary</code> may cover the whole infrastructure.</p><h4 id=neutral-sections>Neutral Sections</h4><p>In some parts of an infrastructure, the train drivers may be instructed - mainly for safety reasons - to cut the power supply to the train.</p><p>To represent such parts, we use <code>NeutralSections</code>. They are represented mainly with the following attributes:</p><ul><li><code>track_ranges</code>: A list of <code>DirectedTrackRanges</code> (track ranges associated to a direction) which are covered by this neutral section.</li><li><code>lower_pantograph</code>: A boolean indicating whether the train&rsquo;s pantograph should be lowered while in this section.</li></ul><p>In our example infrastructure, we have three <code>NeutralSections</code>: one at the junction of the <code>"1500"</code> and <code>"25000"</code> catenaries, one on <em>TA6</em> and one on <em>TG1</em> and <em>TG4</em>.</p><p>For more details about the model see the <a href=../neutral_sections>dedicated page</a>.</p><font color=#aa026d><h3 id=miscellaneous>Miscellaneous</h3></font><h4 id=operational-points>Operational points</h4><p>Operational point is also known in French as &ldquo;Point Remarquable&rdquo; (PR).
One <code>OperationalPoint</code> is a <strong>collection</strong> of points (<code>OperationalPointParts</code>) of interest.</p><p>For example, it may be convenient (reference point for train operation) to store the location of platforms as parts and group them by station in operational points.
In the same way, a bridge over tracks will be <strong>one</strong> OperationalPoint, but it will have <strong>several</strong> OperationPointParts, one at the intersection of each track.</p><p>In the example infrastructure, we only used operational points to represent stations. Operational point parts are displayed as purple diamonds. Keep in mind a single operational point may contain multiple parts.</p><p><img src=svg_diagrams/small_infra_op_points.drawio.en.svg alt="Operational points examples"></p><h4 id=loading-gauge-limits>Loading Gauge Limits</h4><p>These objects are akin to <code>Slopes</code> and <code>Curves</code>: it covers a range of track section, with a <code>begin</code> and an <code>end</code> offset. It represents a restriction on the trains that can travel on the given range, by weight or by train type (freight or passenger).</p><p>We did not put any in our examples.</p><h4 id=speed-sections>Speed Sections</h4><p>The <code>SpeedSections</code> represent speed limits (in meters per second) that are applied on some parts of the tracks. One <code>SpeedSection</code> can span on several track sections, and do not necessarily cover the whole track sections. Speed sections can overlap.</p><p>In our example infrastructure, we have a speed section covering the whole infrastructure, limiting the speed to 300 km/h. On a smaller part of the infrastructure, we applied more restrictive speed sections.</p><p><img src=svg_diagrams/speed_sections.en.svg alt="Speed section examples"></p></div><div class=td-content style=page-break-before:always><h1 id=pg-d8a9003e9780b0213913d2b62364ed28>2.2 - Neutral Sections</h1><div class=lead>Documentation about what they are and how they are implemented</div><h2 id=physical-object-to-model>Physical object to model</h2><h3 id=introduction>Introduction</h3><p>For a train to be able to run, it must either have an energy source on board (fuel, battery, hydrogen, &mldr;) or be supplied with energy throughout its journey.</p><p>To supply this energy, electrical cables are suspended above the tracks: the <em>catenaries</em>. The train then makes contact with these cables thanks to a conducting piece mounted on a mechanical arm: the <em>pantograph</em>.</p><h3 id=neutral-sections>Neutral sections</h3><p>With this system it is difficult to ensure the electrical supply of a train continuously over the entire length of a line. On certain sections of track, it is necessary to cut the electrical supply of the train. These portions are called <strong>neutral sections</strong>.</p><p>Indeed, in order to avoid energy losses along the catenaries, the current is supplied by several substations distributed along the tracks. Two portions of catenaries supplied by different substations must be electrically isolated to avoid short circuits.</p><p>Moreover, the way the tracks are electrified (DC or not for example) can change according to the local uses and the time of installation. It is again necessary to electrically isolate the portions of tracks which are electrified differently. The train must also (except in particular cases) change its pantograph when the type of electrification changes.</p><p>In both cases, the driver is instructed to cut the train&rsquo;s traction, and sometimes even to lower the pantograph.<br>In the French infrastructure, these zones are indicated by announcement, execution and end signs. They also carry the indication to lower the pantograph or not. The portions of track between the execution and end may not be electrified entirely, and may not even have a catenary (in this case the zone necessarily requires lowering the pantograph).<br><em>REV</em> (for reversible) signs are sometimes placed downstream of the end of zone signs. They are intended for trains that run with a pantograph at the rear of the train. These signs indicate that the driver can resume traction safely.</p><p>Additionally, it may sometimes be impossible on a short section of track to place a catenary or to raise the train&rsquo;s pantograph. In this case the line is still considered electrified, and the area without electrification (passage under a bridge for example) is considered as a neutral section.</p><h3 id=rolling-stock>Rolling stock</h3><p>After passing through a neutral section, a train must resume traction. This is not immediate (a few seconds), and the necessary duration depends on the rolling stock.</p><p>In addition, the driver must, if necessary, lower his pantograph, which also takes time (a few tens of seconds) and also depends on the rolling stock.</p><p>Thus, the coasting imposed on the train extends outside the neutral section, since these system times are to be counted from the end of the neutral section.</p><h2 id=data-model>Data model</h2><p>We have chosen to model the neutral sections as the space between the signs linked to it (and not as the precise zone where there is no catenary or where the catenary is not electrified).</p><p>This zone is directional, <em>i.e.</em> associated with a direction of travel, in order to be able to take into account different placements of signs according to the direction. The execution sign of a given direction is not necessarily placed at the same position as the end of zone sign of the opposite direction.</p><p>For a two-way track, a neutral section is therefore represented by two objects.</p><p>The schema is the following</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;lower_pantograph&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#a40000>boolean</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;track_ranges&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&#34;track&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#a40000>string</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&#34;start&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#a40000>number</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&#34;end&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#a40000>number</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&#34;direction&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#a40000>enum</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>],</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;announcement_track_ranges&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&#34;track&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#a40000>string</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&#34;start&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#a40000>number</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&#34;end&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#a40000>number</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&#34;direction&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#a40000>enum</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><ul><li><code>lower_pantograph</code>: indicates whether the pantograph should be lowered in this section</li><li><code>track_ranges</code>: list of track sections ranges where the train must not traction</li><li><code>announcement_track_ranges</code>: list of track sections ranges between the announcement sign and the execution sign</li></ul><h2 id=display>Display</h2><h3 id=map>Map</h3><p>The zones displayed in the map correspond to the <code>track_ranges</code> of neutral sections, thus are between the execution and end signs of the zone. The color of the zone indicates whether the train must lower its pantograph in the zone or not.</p><p>The direction in which the zone applies is not represented.</p><h3 id=simulation-results>Simulation results</h3><p>In the linear display, it is always the area between EXE and FIN that is displayed.</p><h2 id=pathfinding>Pathfinding</h2><p>Neutral sections are therefore portions of &ldquo;non-electrified&rdquo; track where an electric train can still run (but where it cannot traction).</p><p>When searching for a path in the infrastructure, an electric train can travel through a track section that is not covered by the <code>track_ranges</code> of a catenary object (documentation to be written) only if it is covered by the <code>track_ranges</code> of a neutral section.</p><h2 id=simulation>Simulation</h2><p>In our simulation, we approximate the driver&rsquo;s behavior as follows:</p><ul><li>The coasting is started as soon as the train&rsquo;s head passes the announcement sign</li><li>The system times (pantograph reading and traction resumption) start as soon as the train&rsquo;s head passes the end sign.</li></ul><p>In the current simulation, it is easier to use spatial integration bounds rather than temporal ones. We make the following approximation: when leaving the neutral section, we multiply the system times by the speed at the exit of the zone. The coasting is then extended over the obtained distance. This approximation is reasonable because the train&rsquo;s inertia and the almost absence of friction guarantee that the speed varies little over this time interval.</p><h2 id=improvements-to-be-made>Improvements to be made</h2><p>Several aspects could be improved:</p><ul><li>We do not model the <em>REV</em> signs, all trains therefore only have one pantograph at the front in our simulations.</li><li>System times are approximated.</li><li>The driver&rsquo;s behavior is rather restrictive (coasting could start after the announcement sign).</li><li>The display of the zones is limited: no representation of the direction or the announcement zones.</li><li>These zones are not editable.</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-d0b32c1c59097b608e257ee86e580a19>3 - Running time calculation</h1><p>OSRD can be used to perform two types of calculations:</p><ul><li><strong>Standalone train simulation:</strong> calculation of the travel time of a train on a given route without interaction between the train and the signalling system.</li><li><strong>Simulation:</strong> &ldquo;dynamic&rdquo; calculation of several trains interacting with each other via the signalling system.</li></ul><h4 id=1---the-input-data>1 - The input data</h4><p>A running time calculation is based on 5 inputs:</p><ul><li><strong>Infrastructure:</strong> Line and track topology, position of stations and passenger buildings, position and type of points, signals, maximum line speeds, corrected line profile (gradients, ramps and curves).</li></ul><p><img src=infrastructure.png alt=Infrastructure></p><blockquote><p>The blue histogram is a representation of the gradients in [‰] per position in [m]. The gradients are positive for ramps and negative for slopes.</p><p>The orange line represents the cumulative profile, i.e. the relative altitude to the starting point.</p><p>The blue line is a representation of turns in terms of radii of curves in [m].</p></blockquote><ul><li><strong>The rolling stock:</strong> The characteristics of which needed to perform the simulation are shown below.</li></ul><p><img src=mat_roulant.png alt="Rolling Stock Material"></p><blockquote><p>The orange curve, called the effort-speed curve, represents the maximum motor effort as a function of the speed of travel.</p><p>The length, mass, and maximum speed of the train are shown at the bottom of the box.</p></blockquote><ul><li><p><strong>The departure time</strong> is then used to calculate the times of passage at the various points of interest (including stations).</p></li><li><p><strong>Allowances:</strong> Time added to the train&rsquo;s journey to relax its running (see <a href=./allowances>page on allowances</a>).</p></li></ul><p><img src=marges.png alt=Allowances></p><ul><li><strong>The time step</strong> for the calculation of <a href=./numerical_integration>numerical integration</a>.</li></ul><h4 id=2---the-results>2 - The results</h4><p>The results of a running time calculation can be represented in different forms:</p><ul><li><strong>The space/time graph (GET):</strong> represents the path of trains in space and time, in the form of generally diagonal lines whose slope is the speed. Stops are shown as horizontal plates.</li></ul><p><img src=graph_espace_temps.jpg alt="Space/Time Graph"></p><blockquote><p>Example of a GET with several trains spaced about 30 minutes apart.</p><p>The <strong>x</strong> axis is the time of the train, the <strong>y</strong> axis is the position of the train in [m].</p><p>The blue line represents the most tense running calculation for the train, the green line represents a relaxed, so-called &ldquo;economic&rdquo; running calculation.</p><p>The solid rectangles surrounding the paths represent the portions of the track successively reserved for the train to pass (called blocks).</p></blockquote><ul><li><strong>The space/speed graph (SSG):</strong> represents the journey of a single train, this time in terms of speed. Stops are therefore shown as a drop in the curve to zero, followed by a re-acceleration.</li></ul><p><img src=graph_espace_vitesse.png alt="Space/Speed Graph"></p><blockquote><p>The <strong>x</strong> axis is the train position in [m], the <strong>y</strong> axis is the train speed in [km/h].</p><p>The purple line represents the maximum permitted speed.</p><p>The blue line represents the speed in the case of the most stretched running calculation.</p><p>The green line represents the speed in the case of the &ldquo;economic&rdquo; travel calculation.</p></blockquote><ul><li><strong>The timetable for the passage of the train at the various points of interest</strong>.</li></ul><p><img src="timetables.png?style=time" alt="Departure timetables"></p><style>img[src$=time]{height:70%;width:70%}</style></div><div class=td-content style=page-break-before:always><h1 id=pg-0fa7914af29cb313adb8b16f8dc2bcc0>3.1 - Physical modeling</h1><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css integrity=sha384-KiWOvVjnN8qwAZbuQyWDIbfCLFhLXNETzBQjA/92pIowpC0d2O3nppDGQVgwd2nB crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js integrity=sha384-0fdwu/T/EQMsQlrHCCHoH10pkPLlKA1jL5dFyUOvB3lfeT2540/2g6YgSi2BL14p crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous onload=renderMathInElement(document.body)></script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><p>Physical modelling plays an important role in the OSRD core calculation. It allows us to simulate train traffic, and it must be as realistic as possible train traffic, and it must be as realistic as possible.</p><font color=#aa026d><h3 id=force-review>Force review</h3></font><p>To calculate the displacement of the train over time, we must first calculate its speed at each instant.
A simple way to obtain this speed is to calculate the acceleration.
Thanks to the fundamental principle of dynamics, the acceleration of the train at each instant is directly dependent on the different forces applied to it: $$ \sum \vec{F}=m\vec{a} $$</p><p><img src=../forces.png alt="Running time"></p><ul><li><p><strong>Traction</strong>: The value of the traction force \(F_{mot}\) depends on several factors:</p><ul><li>the rolling stock</li><li>the speed of the train, \(v^{\prime}x\) according to the effort-speed curve below:</li></ul><p>$$ {\vec{F_{mot}}(v_{x^{\prime}}, x^{\prime})=F_{mot}(v_{x^{\prime}}, x^{\prime})\vec{e_x^{\prime}}} $$</p><p><img src=../effort-vitesse.png alt="Running time" title="Example of a train effort-speed curve"></p><blockquote><p>The <strong>x</strong> axis represents the speed of the train in [km/h], the <strong>y</strong> axis the value of the traction force in [kN].</p></blockquote><ul><li>the action of the driver, who accelerates more or less strongly depending on where he is on his journey</li></ul></li></ul><br><ul><li><strong>Braking</strong> : The value of the braking force \(F_{brk}\) also depends on the rolling stock and the driver&rsquo;s action but has a constant value for a given rolling stock. In the current state of modelling, braking is either zero or at its maximum value.</li></ul><p>$$ \vec{F_{brk}}(x^{\prime})=-F_{brk}(x^{\prime}){\vec{e_{x^{\prime}}}} $$</p><p>A second approach to modelling braking is the so-called hourly approach, as it is used for hourly production at SNCF. In this case, the deceleration is fixed and the braking no longer depends on the different forces applied to the train. Typical deceleration values range from 0.4 to 0.7m/s².</p><br><ul><li><strong>Forward resistance</strong>: To model the forward resistance of the train, the Davis formula is used, which takes into account all the friction and aerodynamic resistance of the air. The value of the drag depends on the speed \(v^{\prime}_x\). The coefficients \(A\), \(B\), et \(C\) depend on the rolling stock.</li></ul><p>$$ {\vec{R}(v_{x^{\prime}})}=-(A+Bv_{x^{\prime}}+{Cv_{x^{\prime}}}^2){\vec{e_{x^{\prime}}}} $$</p><br><ul><li><strong>Weight (slopes + turns)</strong> : The weight force given by the product between the mass \(m\) of the train and the gravitational constant \(g\) is projected on the axes \(\vec{e_x}^{\prime}\) and \(\vec{e_y}^{\prime}\).For projection, we use the angle \(i(x^{\prime})\), which is calculated from the slope angle \(s(x^{\prime})\) corrected by a factor that takes into account the effect of the turning radius \(r(x^{\prime})\).</li></ul><p>$$
\vec{P(x^{\prime})}=-mg\vec{e_y}(x^{\prime})=
-mg\Big[sin\big(i(x^{\prime})\big){\vec{e_{x^{\prime}}}(x^{\prime})}+cos\big(i(x^{\prime})\big){\vec{e_{{\prime}}}(x^{\prime})}\Big]
$$</p><p>$$ i(x^{\prime})= s(x^{\prime})+\frac{800m}{r(x^{\prime})} $$</p><br><ul><li><strong>Ground Reaction</strong> : The ground reaction force simply compensates for the vertical component of the weight, but has no impact on the dynamics of the train as it has no component along the axis \({\vec{e_x}^{\prime}}\).</li></ul><p>$$ \vec{R_{gnd}}=R_{gnd}{\vec{e_{y^{\prime}}}} $$</p><font color=#aa026d><h3 id=forces-balance>Forces balance</h3></font><p>The equation of the fundamental principle of dynamics projected onto the axis \({\vec{e_x}^{\prime}}\) (in the train frame of reference) gives the following scalar equation:</p><p>$$
a_{x^{\prime}}(t) = \frac{1}{m}\Big
[F_{mot}(v_{x^{\prime}}, x^{\prime})-F_{brk}(x^{\prime})-(A+Bv_{x^{\prime}}+{Cv_{x^{\prime}}}^2)-mgsin(i(x^{\prime}))\Big]
$$</p><p>This is then simplified by considering that despite the gradient the train moves on a plane and by amalgamating
\(\vec{e_x}\) and \(\vec{e_x}^{\prime}\). The gradient still has an impact on the force balance, but it is assumed that the train is only moving horizontally, which gives the following simplified equation:</p><p>$$ a_{x}(t) = \frac{1}{m}\Big[F_{mot}(v_{x}, x)-F_{brk}(x)-(A+Bv_{x}+{Cv_{x}}^2)-mgsin(i(x))\Big] $$</p><font color=#aa026d><h3 id=resolution>Resolution</h3></font><p>The driving force and the braking force depend on the driver&rsquo;s action (he decides to accelerate or brake more or less strongly depending on the situation). This dependence is reflected in the dependence of these two forces on the position of the train. The weight component is also dependent on the position of the train, as it comes directly from the slopes and bends below the train.</p><p>In addition, the driving force depends on the speed of the train (according to the speed effort curve) as does the resistance to forward motion.
resistance.</p><p>These different dependencies make it impossible to solve this equation analytically, and the acceleration of the train at each moment must be calculated by numerical integration.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-ea6d32407559a3426f098dbe1408c955>3.2 - Numerical integration</h1><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css integrity=sha384-KiWOvVjnN8qwAZbuQyWDIbfCLFhLXNETzBQjA/92pIowpC0d2O3nppDGQVgwd2nB crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js integrity=sha384-0fdwu/T/EQMsQlrHCCHoH10pkPLlKA1jL5dFyUOvB3lfeT2540/2g6YgSi2BL14p crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous onload=renderMathInElement(document.body)></script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><font color=#aa026d><h3 id=introduction>Introduction</h3></font><p>Since physical modelling has shown that the acceleration of the train is influenced by various factors that vary along the route (gradient, curvature, engine traction force, etc.), the calculation must be carried out using a numerical integration method. The path is then separated into sufficiently short steps to consider all these factors as constant, which allows this time to use the equation of motion to calculate the displacement and speed of the train.</p><p>Euler&rsquo;s method of numerical integration is the simplest way of doing this, but it has a number of drawbacks. This article explains the Euler method, why it is not suitable for OSRD purposes and which integration method should be used instead.</p><font color=#aa026d><h3 id=eulers-method>Euler&rsquo;s method</h3></font><p>The Euler method applied to the integration of the equation of motion of a train is:</p><p>$$v(t+dt) = a(v(t), x(t))dt + v(t)$$</p><p>$$x(t+dt) = \frac{1}{2}a(v(t), x(t))dt^2 + v(t)dt + x(t)$$</p><center><p><img src="../euler.png?style=method" alt="Euler&rsquo;s method"></p></center><p>&nbsp;</p><h4 id=advantages-of-eulers-method><strong>Advantages of Euler&rsquo;s method</strong></h4><p>The advantages of the Euler method are that it is very simple to implement and has a rather fast calculation for a given time step, compared to other numerical integration methods (see <a href=#the-choice-of-integration-method-for-osrd>appendix</a>)</p><h4 id=disadvantages-of-the-eulers-method><strong>Disadvantages of the Euler&rsquo;s method</strong></h4><p>The Euler integration method presents a number of problems for OSRD:</p><ul><li>It is relatively imprecise, and therefore requires a small time step, which generates a lot of data.</li><li>With time integration, only the conditions at the starting point of the integration step (gradient, infrastructure parameters, etc.) are known, as one cannot predict precisely where it will end.</li><li>We cannot anticipate future changes in the directive: the train only reacts by comparing its current state with its set point at the same time. To illustrate, it is as if the driver is unable to see ahead, whereas in reality he anticipates according to the signals, slopes and bends he sees ahead.</li></ul><font color=#aa026d><h3 id=runge-kuttas-4-method>Runge-Kutta&rsquo;s 4 method</h3></font><p>The Runge-Kutta 4 method applied to the integration of the equation of motion of a train is:</p><p>$$v(t+dt) = v(t) + \frac{1}{6}(k_1 + 2k_2 + 2k_3 + k_4)dt$$</p><p>With:</p><p>$$k_1 = a(v(t), x(t))$$</p><p>$$k_2 = a\Big(v(t+k_1\frac{dt}{2}), x(t) + v(t)\frac{dt}{2} + k_1\frac{dt^2}{8}\Big)$$</p><p>$$k_3 = a\Big(v(t+k_2\frac{dt}{2}), x(t) + v(t)\frac{dt}{2} + k_2\frac{dt^2}{8}\Big)$$</p><p>$$k_4 = a\Big(v(t+k_3dt), x(t) + v(t)dt + k_3\frac{dt^2}{2}\Big)$$</p><center><p><img src="../rk4.png?style=method" alt="Runge-Kutta 4&rsquo;s method"></p></center><p>&nbsp;</p><h4 id=advantages-of-runge-kuttas-4-method><strong>Advantages of Runge Kutta&rsquo;s 4 method</strong></h4><p>Runge Kutta&rsquo;s method of integration 4 addresses the various problems raised by Euler&rsquo;s method:</p><ul><li>It allows the anticipation of directive changes within a calculation step, thus representing more accurately the reality of driving a train.</li><li>It is more accurate for the same calculation time (see <a href=#the-choice-of-integration-method-for-osrd>appendix</a>), allowing for larger integration steps and therefore fewer data points.</li></ul><h4 id=disadvantages-of-runge-kuttas-4-method><strong>Disadvantages of Runge Kutta&rsquo;s 4 method</strong></h4><p>The only notable drawback of the Runge Kutta 4 method encountered so far is its difficulty of implementation.</p><font color=#aa026d><h3 id=the-choice-of-integration-method-for-osrd>The choice of integration method for OSRD</h3></font><h4 id=study-of-accuracy-and-speed-of-calculation><strong>Study of accuracy and speed of calculation</strong></h4><p>Different integration methods could have replaced the basic Euler integration in the OSRD algorithm. In order to decide which method would be most suitable, a study of the accuracy and computational speed of different methods was carried out. This study compared the following methods:</p><ul><li>Euler</li><li>Euler-Cauchy</li><li>Runge-Kutta 4</li><li>Adams 2</li><li>Adams 3</li></ul><p>All explanations of these methods can be found (in French) in <a href=https://github.com/OpenRailAssociation/osrd/wiki/documents/integration/MethodesNumeriques_EricGoncalves.pdf>this document</a>, and the python code used for the simulation is <a href=https://raw.githubusercontent.com/wiki/OpenRailAssociation/osrd/code/integration/Tests_precision.py>here</a>.</p><p>The simulation calculates the position and speed of a high-speed train accelerating on a flat straight line.</p><h4 id=equivalent-time-step-simulations><strong>Equivalent time step simulations</strong></h4><p>A reference curve was simulated using the Euler method with a time step of 0.1s, then the same path was simulated using the other methods with a time step of 1s. It is then possible to simply compare each curve to the reference curve, by calculating the absolute value of the difference at each calculated point. The resulting absolute error of the train&rsquo;s position over its distance travelled is as follows:</p><p><img src=../precisions_h_equivalent.png alt=precisions_h_equivalent></p><p>It is immediately apparent that the Euler method is less accurate than the other four by about an order of magnitude. Each curve has a peak where the accuracy is extremely high (extremely low error), which is explained by the fact that all curves start slightly above the reference curve, cross it at one point and end slightly below it, or <em>vice versa</em>.</p><p>As accuracy is not the only important indicator, the calculation time of each method was measured. This is what we get for the same input parameters:</p><table><thead><tr><th style=text-align:left>Integration method</th><th style=text-align:right>Calculation time (s)</th></tr></thead><tbody><tr><td style=text-align:left>Euler</td><td style=text-align:right>1.86</td></tr><tr><td style=text-align:left>Euler-Cauchy</td><td style=text-align:right>3.80</td></tr><tr><td style=text-align:left>Runge-Kutta 4</td><td style=text-align:right>7.01</td></tr><tr><td style=text-align:left>Adams 2</td><td style=text-align:right>3.43</td></tr><tr><td style=text-align:left>Adams 3</td><td style=text-align:right>5.27</td></tr></tbody></table><p>Thus, Euler-Cauchy and Adams 2 are about twice as slow as Euler, Adams 3 is about three times as slow, and RK4 is about four times as slow. These results have been verified on much longer simulations, and the different ratios are maintained.</p><h4 id=simulation-with-equivalent-calculation-time><strong>Simulation with equivalent calculation time</strong></h4><p>As the computation times of all methods depend linearly on the time step, it is relatively simple to compare the accuracy for approximately the same computation time. Multiplying the time step of Euler-Cauchy and Adams 2 by 2, the time step of Adams 3 by 3, and the time step of RK4 by 4, here are the resulting absolute error curves:</p><p><img src=../precisions_time_equivalent.png alt=precisions_time_equivalent></p><p>And here are the calculation times:</p><table><thead><tr><th style=text-align:left>Integration method</th><th style=text-align:right>Calculation time (s)</th></tr></thead><tbody><tr><td style=text-align:left>Euler</td><td style=text-align:right>1.75</td></tr><tr><td style=text-align:left>Euler-Cauchy</td><td style=text-align:right>2.10</td></tr><tr><td style=text-align:left>Runge-Kutta 4</td><td style=text-align:right>1.95</td></tr><tr><td style=text-align:left>Adams 2</td><td style=text-align:right>1.91</td></tr><tr><td style=text-align:left>Adams 3</td><td style=text-align:right>1.99</td></tr></tbody></table><p>After some time, RK4 tends to be the most accurate method, slightly more accurate than Euler-Cauchy, and still much more accurate than the Euler method.</p><font color=#aa026d><h3 id=conclusions-of-the-study>Conclusions of the study</h3></font><p>The study of accuracy and computational speed presented above shows that RK4 and Euler-Cauchy would be good candidates to replace the Euler algorithm in OSRD: both are fast, accurate, and could replace the Euler method without requiring large implementation changes because they only compute within the current time step.
<strong>It was decided that OSRD would use the Runge-Kutta 4 method because it is slightly more accurate than Euler-Cauchy and it is a well-known method for this type of calculation, so it is very suitable for an open-source simulator.</strong></p><style>img[src$=method]{height:70%;width:70%}</style></div><div class=td-content style=page-break-before:always><h1 id=pg-4ea0de1a5a62574096209d692bf76d42>3.3 - Envelopes system</h1><p>The envelope system is an interface created specifically for the OSRD gait calculation. It allows you to manipulate different space/velocity curves, to slice them, to end them, to interpolate specific points, and to address many other needs necessary for the gait calculation.</p><font color=#aa026d><h3 id=a-specific-interface-in-the-osrd-core-service>A specific interface in the OSRD Core service</h3></font><p>The envelope system is part of the core service of OSRD (see <a href=../architecture/_index.md>software architecture</a>).</p><p>Its main components are :</p><p><strong>1 - EnvelopePart:</strong> space/speed curve, defined as a sequence of points and having metadata indicating for example if it is an acceleration curve, a braking curve, a speed hold curve, etc.</p><p><strong>2 - Envelope:</strong> a list of end-to-end EnvelopeParts on which it is possible to perform certain operations:</p><ul><li>check for continuity in space (mandatory) and speed (optional)</li><li>look for the minimum and/or maximum speed of the envelope</li><li>cut a part of the envelope between two points in space</li><li>perform a velocity interpolation at a certain position</li><li>calculate the elapsed time between two positions in the envelope</li></ul><p><img src=../envelopes_scheme.png alt=envelope_scheme></p><p><strong>3 - Overlays :</strong> system for adding more constrained (i.e. lower speed) EnvelopeParts to an existing envelope.</p><font color=#aa026d><h3 id=given-envelopes-vs-calculated-envelopes>Given envelopes vs. calculated envelopes</h3></font><p>During the simulation, the train is supposed to follow certain speed instructions. These are modelled in OSRD by envelopes in the form of space/speed curves. Two types can be distinguished:</p><ul><li>Envelopes from <strong>infrastructure and rolling stock data</strong>, such as maximum line speed and maximum train speed. Being input data for our calculation, they do not correspond to curves with a physical meaning, as they are not derived from the results of a real integration of the physical equations of motion.</li><li>The envelopes result from <strong>real integration</strong> of the physical equations of motion. They correspond to a curve that is physically tenable by the train and also contain time information.</li></ul><p>A simple example to illustrate this difference: if we simulate a TER journey on a mountain line, one of the input data will be a maximum speed envelope of 160km/h, corresponding to the maximum speed of our TER. However, this envelope does not correspond to a physical reality, as it is possible that on certain sections the gradient is too steep for the train to be able to maintain this maximum speed of 160km/h. The calculated envelope will therefore show in this example a speed drop in the steepest areas, where the envelope given was perfectly flat.</p><font color=#aa026d><h3 id=simulation-of-several-trains>Simulation of several trains</h3></font><p>In the case of the simulation of many trains, the signalling system must ensure <strong>safety</strong>. The effect of signalling on the running calculation of a train is reproduced by superimposing dynamic envelopes on the static envelope. A new dynamic envelope is introduced for example when a signal closes. The train follows the static economic envelope superimposed on the dynamic envelopes, if any. In this simulation mode, a time check is performed against a theoretical time from the time information of the static economic envelope. If the train is late with respect to the scheduled time, it stops following the economic envelope and tries to go faster. Its space/speed curve will therefore be limited by the maximum effort envelope.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-8a7d650e7008d319d63327b9d7bb4ff5>3.4 - Pipeline</h1><p>The walk calculation in OSRD is a 4-step process, each using <a href=../envelopes_system>the envelopes system</a>:</p><ol><li><a href=#calculation-of-the-most-restricted-speed-profile-mrsp>Construction of the most restrictive speed profile</a></li><li><a href=#calculation-of-the-max-speed-profile>Addition of the different braking curves</a></li><li><a href=#calculation-of-the-max-effort-profile>Adding the different acceleration curves and checking the constant speed curves</a></li><li><a href=#application-of-allowances>Application of allowance(s)</a></li></ol><p>&nbsp;</p><font color=#aa026d><h3 id=calculation-of-the-most-restricted-speed-profile-mrsp>Calculation of the Most Restricted Speed Profile (MRSP)</h3></font><p>A first envelope is calculated at the beginning of the simulation by grouping all static velocity limits:</p><ul><li>maximum line speed</li><li>maximum speed of rolling stock</li><li>temporary speed limits (e.g. in case of works on a line)</li><li>speed limits by train category</li><li>speed limits according to train load</li><li>speed limits corresponding to signposts</li></ul><p>The length of the train is also taken into account to ensure that the train does not accelerate until its tail leaves the slowest speed zone. An offset is then applied to the red dashed curve. The resulting envelope (black curve) is called the <strong>Most Restricted Speed Profile (MRSP)</strong>. It is on this envelope that the following steps will be calculated.</p><p><img src=../mrsp.png alt="Most Restricted Speed Profile"></p><blockquote><p>The red dotted line represents the maximum permitted speed depending on the position.
The black line represents the MRSP where the train length has been taken into account.</p></blockquote><p>It should be noted that the different envelopeParts composing the MRSP are input data, so they do not correspond to curves with a physical reality.</p><font color=#aa026d><h3 id=calculation-of-the-max-speed-profile>Calculation of the Max Speed Profile</h3></font><p>Starting from the MRSP, all braking curves are calculated using the overlay system (see <a href=../envelopes_system/#a-specific-interface-in-the-osrd-core-service>here</a> for more details on overlays), i.e. by creating envelopeParts which will be more restrictive than the MRSP. The resulting curve is called <strong>Max Speed Profile</strong>. This is the maximum speed envelope of the train, taking into account its braking capabilities.</p><p>Since braking curves have an imposed end point and the braking equation has no analytical solution, it is impossible to predict their starting point. The braking curves are therefore calculated backwards from their target point, i.e. the point in space where a certain speed limit is imposed (finite target speed) or the stopping point (zero target speed).</p><p><img src=../msp.png alt="Max Speed Profile"></p><p>For historical reasons in hourly production, braking curves are calculated at SNCF with a fixed deceleration, the so-called hourly deceleration (typically ~0.5m/s²) without taking into account the other forces. This method has therefore also been implemented in OSRD, allowing the calculation of braking in two different ways: with this hourly rate or with a braking force that is simply added to the other forces.</p><font color=#aa026d><h3 id=calculation-of-the-max-effort-profile>Calculation of the Max Effort Profile</h3></font><p>For each point corresponding to an increase in speed in the MRSP or at the end of a stop braking curve, an acceleration curve is calculated. The acceleration curves are calculated taking into account all active forces (traction force, driving resistance, weight) and therefore have a physical meaning.</p><p>For envelopeParts whose physical meaning has not yet been verified (which at this stage are the constant speed running phases, always coming from the MRSP), a new integration of the equations of motion is performed. This last calculation is necessary to take into account possible speed stalls in case the train is physically unable to hold its speed, typically in the presence of steep ramps (see <a href=../envelopes_system/#given-envelopes-vs.-calculated-envelopes>this example</a>).</p><p>The envelope that results from the addition of the acceleration curves and the verification of the speed plates is called the <strong>Max Effort Profile</strong>.</p><p><img src=../mep.png alt="Max Effort Profile"></p><p>At this stage, the resulting envelope is continuous and has a physical meaning from start to finish. The train accelerates to the maximum, runs as fast as possible according to the different speed limits and driving capabilities, and brakes to the maximum. The resulting travel calculation is called the <strong>basic running time</strong>. It corresponds to the fastest possible route for the given rolling stock on the given route.</p><font color=#aa026d><h3 id=application-of-allowances>Application of allowance(s)</h3></font><p>After the calculation of the basic run (corresponding to the Max Effort Profile in OSRD), it is possible to apply allowances. Allowances are additions of extra time to the train&rsquo;s journey. They are used to allow the train to catch up if necessary or for other operational purposes (more details on allowances <a href=../allowances>here</a>).</p><p>A new <strong>Allowances</strong> envelope is therefore calculated using overlays to distribute the allowance requested by the user over the maximum effort envelope calculated previously.</p><p><img src=../allowances.png alt=Allowances></p><p>In the OSRD running calculation it is possible to distribute the allowances in a linear way, by lowering all speeds by a certain factor, or in an economic way, i.e. by minimising the energy consumption during the train run.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-1e84eea96c6b439c99ded337aa3be95b>3.5 - Allowances</h1><font color=#aa026d><h3 id=the-purpose-of-allowances>The purpose of allowances</h3></font><p>As explained in the <a href=../pipeline/#calculation-of-the-max-effort-profile>calculation of the Max Effort Profile</a>, the <strong>basic running time</strong> represents the most stretched run normally achievable, i.e. the fastest possible run of the given equipment on the given route. The train accelerates to the maximum, travels as fast as possible according to the different speed limits and driving capabilities, and brakes to the maximum.</p><p>This basic run has a major disadvantage: if a train leaves 10 minutes late, it will arrive at best 10 minutes late, because by definition it is impossible for it to run faster than the basic run. Therefore, trains are scheduled with one or more allowances added. The allowances are a relaxation of the train&rsquo;s route, an addition of time to the scheduled timetable, which inevitably results in a lowering of running speeds.</p><blockquote><p>A train running in basic gear is unable to catch up!</p></blockquote><font color=#aa026d><h3 id=allowances-types>Allowances types</h3></font><p>There are two types of allowances:</p><ul><li><strong>The regularity allowance</strong>: this is the additional time added to the basic running time to take account of the inaccuracy of speed measurement, to compensate for the consequences of external incidents that disrupt the theoretical run of trains, and to maintain the regularity of the traffic. The regularity allowance applies to the whole route, although its value may change at certain intervals.</li><li><strong>The construction allowance</strong>: this is the time added/removed on a specific interval, in addition to the regularity allowance, but this time for operational reasons (dodging another train, clearing a track more quickly, etc.)</li></ul><p>A basic running time with an added allowance of regularity gives what is known as a <strong>standard walk</strong>.</p><font color=#aa026d><h3 id=allowance-distribution>Allowance distribution</h3></font><p>Since the addition of allowance results in lower speeds along the route, there are a number of possible routes. Indeed, there are an infinite number of solutions that result in the same journey time.</p><p>As a simple example, in order to reduce the running time of a train by 10% of its journey time, it is possible to extend any stop by the time equivalent to this 10%, just as it is possible to run at 1/1.1 = 90.9% of the train&rsquo;s capacity over the entire route, or to run slower, but only at high speeds&mldr;</p><p>There are currently two algorithms for margin distribution in OSRD: linear and economic.</p><font color=#aa026d><h3 id=linear-distribution>Linear distribution</h3></font><p>Linear allowance distribution is simply lowering the speeds by the same factor over the area where the user applies the allowance. Here is an example of its application:</p><p><img src=../python_plot_linear.png alt="Python plot linear"></p><p>The advantage of this distribution is that the allowance is spread evenly over the entire journey. A train that is late on 30% of its journey will have 70% of its allowance for the remaining 70% of its journey.</p><font color=#aa026d><h3 id=economic-distribution>Economic distribution</h3></font><p>The economic distribution of the allowance, presented in detail in <a href=/pdf/MARECO.pdf>this document</a> (<strong>MARECO</strong> is an algorithm designed by the SNCF research department), consists of distributing the allowance in the most energy-efficient way possible. It is based on two principles:</p><ol><li>a maximum speed, avoiding the most energy-intensive speeds</li><li>run-on zones, located before braking and steep gradients, where the train runs with the engine off thanks to its inertia, allowing it to consume no energy during this period</li></ol><p><img src=../python_plot_eco_w_slopes.png alt="Python plot eco with slopes"></p><blockquote><p>An example of economic walking. Above, the gradients/ramps encountered by the train. The areas of travel on the track are shown in blue.</p></blockquote></div><div class=td-content style=page-break-before:always><h1 id=pg-9f55fb9e6e2f9fcd8a53e969e1550274>4 - Netzgrafik-Editor</h1><div class=lead>Open-source software developed by SBB CFF FFS and its integration in OSRD</div><p>Netzgrafik-Editor (NGE) is an open-source software that enables the creation, modification, and analysis of regular-interval timetable, at a macroscopic level of detail, developed by <a href=https://www.sbb.ch/>Swiss Federal Railways (SBB CFF FFS)</a>. See <a href=https://github.com/SchweizerischeBundesbahnen/netzgrafik-editor-frontend>front-end</a> and <a href=https://github.com/SchweizerischeBundesbahnen/netzgrafik-editor-backend>back-end</a> repositories.</p><p>OSRD and NGE are are semantically different: the former uses a microscopic level of detail, based on a well-defined infrastructure, depicting a timetable composed of unique train schedules, while the latter uses a macroscopic level of detail, not based on any explicit infrastructure, depicting a transportation plan made up of regular-interval based train runs. However, these differences, close enough, may be arranged to make it work together.</p><p>The compatibility between NGE and OSRD has been tested through a proof of concept, by running both pieces of software as separate services and without automated synchronization.</p><p>The idea is to give to OSRD a graphical tool to edit (create, update and delete train schedules from) a timetable from an operational study scenario, and get some insights on analytics at the same time. Using both microscopic and macroscopic levels of detail brings a second benefit: OSRD&rsquo;s microscopic calculations extend the actual scope of NGE, its functionalities and information provided, such as the microscopic simulations or the conflicts detection tool.</p><p>The transversal objective of this feature is to make two open-source projects from two big railway infrastructure managers work along and cooperate with one another with the same goal: ensure a digital continuity on different time scales for railway operational studies.</p><h4 id=1---integration-in-osrd>1 - Integration in OSRD</h4><p>OSRD has developed a <code>standalone</code> version of NGE, integrated into the source code, which allows NGE to work without a back-end. Thus, for external use, a <a href=https://www.npmjs.com/package/netzgrafik-frontend>build of NGE <code>standalone</code> is available on NPM</a> and is published at each release. Finally, to meet OSRD-specific needs, OSRD uses a <a href=https://github.com/osrd-project/netzgrafik-editor-frontend>fork</a> of NGE (whose <a href=https://www.npmjs.com/package/@osrd-project/netzgrafik-frontend>build, NGE <code>standalone</code>, is also available on NPM</a>), remaining as close as possible to the official directory.</p><p>Despite using different JavaScript frameworks (ReactJS for OSRD and Angular for NGE), this build allows OSRD to integrate NGE within an <a href=https://developer.mozilla.org/fr/docs/Web/HTML/Element/iframe><code>iframe</code></a>. This <code>iframe</code> instantiates a <a href=https://developer.mozilla.org/en-US/docs/Web/API/Web_components/Using_custom_elements><code>Custom Element</code></a>, which is be the communication interface between both applications and launch NGE&rsquo;s build.</p><p>An alternative solution to the integration problem would have been to rewrite NGE as <a href=https://developer.mozilla.org/fr/docs/Web/API/Web_components><code>web-components</code></a>, in order to import them into OSRD, but this solution was abandoned because of the amount of work it would represent.</p><p>NGE, in its <code>standalone</code> version, communicates with OSRD through the <code>iframe</code> using DOM element properties:</p><ul><li><a href=https://github.com/SchweizerischeBundesbahnen/netzgrafik-editor-frontend/blob/fe3e788499e18054e260c05e714419aeeafc44e1/src/app/app.component.ts#L75><code>@Input</code></a>: with the <code>netzgrafikDto</code> property, triggered when the content of the scenario is updated from OSRD.</li><li><a href=https://github.com/SchweizerischeBundesbahnen/netzgrafik-editor-frontend/blob/fe3e788499e18054e260c05e714419aeeafc44e1/src/app/app.component.ts#L84><code>@Output</code></a>: with the <a href=https://github.com/SchweizerischeBundesbahnen/netzgrafik-editor-frontend/blob/main/documentation/STANDALONE.md><code>operations</code></a> property, triggered when NGE is used.</li></ul><p><img src=osrd_nge_concept_diagram.png alt="Concept diagram"></p><p>NGE is then able to obtain the OSRD timetable as soon as a change is made on the OSRD side, and OSRD is able to obtain the changes made on the NGE side.</p><h4 id=2---converters>2 - Converters</h4><p>To overcome semantic differences and adapt data models, two converters are implemented:</p><ul><li><strong>[OSRD -> NGE]</strong> a converter which transforms an OSRD timetable into an NGE model. The nodes are the waypoints described by the train schedules, and whose macroscopic information (position on the reticular) is stored in the database. OSRD train schedules, <code>TrainSchedule</code>, then represent cadenced train lines in NGE, <code>Trainrun</code>. A concept of cadenced train lines, will soon be implemented to allow conceptual convergence between OSRD and NGE.</li><li><strong>[OSRD &lt;- NGE]</strong> an event manager, which transforms an NGE action into an update of the OSRD database.</li></ul><h4 id=3---open-source-cooperation--contribution>3 - Open-source (cooperation / contribution)</h4><p>To make NGE compatible with OSRD, some changes have been requested (disable back-end, create hooks on events) and directly implemented in the <a href=https://github.com/SchweizerischeBundesbahnen/netzgrafik-editor-frontend>official repository of NGE</a>, with the agreement and help of NGE team.</p><p>Contributions for one project to another, from both sides, are valuable and will be entertained in the future.</p><p>This feature also shows that open-source cooperation is powerful and a huge gain of time in software development.</p></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="col-6 col-sm-4 text-xs-center order-sm-2"></div><div class="col-6 col-sm-4 text-end text-xs-center order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=GitHub aria-label=GitHub><a target=_blank rel=noopener href=https://github.com/OpenRailAssociation/osrd aria-label=GitHub><i class="fab fa-github"></i></a></li></ul></div><div class="td-footer__copyright-etc col-12 col-sm-4 text-center py-2 order-sm-2"><span>&copy; 2025 OSRD contributors. All Rights Reserved</span></div></div></div></footer></div><style>.markmap>svg{width:100%;height:300px}</style><script>window.markmap={autoLoader:{manual:!0,onReady(){const{autoLoader:e,builtInPlugins:t}=window.markmap;e.transformPlugins=t.filter(e=>e.name!=="prism")}}}</script><script src=https://cdn.jsdelivr.net/npm/markmap-autoloader></script><script src=https://cdn.jsdelivr.net/npm/mermaid@9.3.0/dist/mermaid.min.js integrity="sha512-ku2nmBrzAXY5YwohzTqLYH1/lvyMrpTVxgQKrvTabd/b/uesqltLORdmpVapYv6QhZVCLUX6wkvFaKOAY4xpUA==" crossorigin=anonymous></script><script src=/js/main.min.4261519102c0270f3bdd4edcd2b45867ee7a584a0ea82c94f59e4f991c6337a1.js integrity="sha256-QmFRkQLAJw873U7c0rRYZ+56WEoOqCyU9Z5PmRxjN6E=" crossorigin=anonymous></script><script defer src=/js/click-to-copy.min.f724d3de49218995223b7316aa2e53e2b34bf42026bf399ebb21bb02212402d1.js integrity="sha256-9yTT3kkhiZUiO3MWqi5T4rNL9CAmvzmeuyG7AiEkAtE=" crossorigin=anonymous></script><script src=/js/tabpane-persist.js></script></body></html>