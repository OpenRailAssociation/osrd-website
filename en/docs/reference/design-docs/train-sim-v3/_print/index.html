<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=canonical type=text/html href=https://osrd.fr/en/docs/reference/design-docs/train-sim-v3/><link rel=alternate type=application/rss+xml href=https://osrd.fr/en/docs/reference/design-docs/train-sim-v3/index.xml><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Train simulation v3 | OSRD</title>
<meta name=description content="Modeling and API design of train simulations"><meta property="og:title" content="Train simulation v3"><meta property="og:description" content="Modeling and API design of train simulations"><meta property="og:type" content="website"><meta property="og:url" content="https://osrd.fr/en/docs/reference/design-docs/train-sim-v3/"><meta itemprop=name content="Train simulation v3"><meta itemprop=description content="Modeling and API design of train simulations"><meta name=twitter:card content="summary"><meta name=twitter:title content="Train simulation v3"><meta name=twitter:description content="Modeling and API design of train simulations"><link rel=preload href=/scss/main.min.86a6bb6b7070828a4efa42be7dea9c275f5278ac1b9f2879d2d7ee6cddf7c620.css as=style><link href=/scss/main.min.86a6bb6b7070828a4efa42be7dea9c275f5278ac1b9f2879d2d7ee6cddf7c620.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.6.3.min.js integrity="sha512-STof4xm1wgkfm7heWqFJVn58Hm3EtS31XFaagaa8VMReCXAkQnJZ+jEy8PCC/iT18dFy95WcExNHFTqLyp72eQ==" crossorigin=anonymous></script><script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script></head><body class=td-section><header><nav class="td-navbar navbar-dark js-navbar-scroll"><div class="container-fluid flex-column flex-md-row"><a class=navbar-brand href=/en/><span class="navbar-brand__logo navbar-logo"><svg xmlns="http://www.w3.org/2000/svg" id="svg36" width="110.767" height="22"><style id="style1">.st9{fill:#fff}</style><g id="ok" transform="scale(.1918)"><g id="g36"><g id="g29"><path id="path23" d="M38.5 83.4c-1.9 8.2-2.9 17-2.9 26.5v4.8h16.6c-2.8-13.2-7.8-23.4-13.7-31.3z" class="st9"/><path id="path24" d="M0 57.5v19.9c3.1 1.2 6.3 2.7 9.5 4.6 8.5 5.2 15 12.6 19.4 21.8v-31c-3.4-3-6.9-5.5-10.3-7.5-6.5-3.7-13-6.2-18.6-7.8z" class="st9"/><path id="path25" d="M35.6 69.9c4.3-11.3 10.6-21.1 18.9-29.4V0H35.6z" class="st9"/><path id="path26" d="M40.8 75.4c5.3 6.2 10.1 13.8 13.7 23.3V50.6C48.6 57.8 44 66.1 40.8 75.4z" class="st9"/><path id="path27" d="M100.7.0H61.3v34.5C73.1 25.2 86 20 96.9 17.2c1.8-.5 3.7.6 4.1 2.4.5 1.8-.6 3.6-2.4 4.1-11.4 2.9-25.3 8.6-37.2 19.7v31.8c2.9-6.3 6.7-11.7 11.4-16.4 9.4-9.3 21-14.1 30.5-16.6 1.8-.5 3.7.6 4.1 2.4.5 1.8-.6 3.6-2.4 4.1-4.7 1.2-10.1 3.1-15.3 6-19 10.3-28.2 28.4-28.2 55.2v4.8h39.3c7.8.0 14.1-6.3 14.1-14.1V14.1C114.7 6.3 108.4.0 100.7.0z" class="st9"/><path id="path28" d="M22 59.6c2.2 1.3 4.5 2.8 6.8 4.6V0H14.1C6.3.0.0 6.3.0 14.1v36.4c6.5 1.7 14.2 4.5 22 9.1z" class="st9"/><path id="path29" d="M5.4 87.5c-1.8-1.1-3.6-2-5.4-2.8v15.9c0 7.8 6.3 14.1 14.1 14.1h11.6c-3.6-12.2-10.4-21.3-20.3-27.2z" class="st9"/></g><g id="g30"><path id="path30" d="M201.7 109c-30.8.0-53.7-21.2-53.7-52.5.0-31.7 22.9-51.6 53.7-51.6 31 0 53.9 20 53.9 51.6-.1 31.3-23 52.5-53.9 52.5zm0-82.6c-16.7.0-28.2 12.8-28.2 30.1.0 17.9 11.6 30.7 28.2 30.7S230 74.4 230 56.6c0-17.3-11.6-30.2-28.3-30.2z" class="st9"/></g><g id="g32"><g id="g31"><path id="path31" d="M334.3 33.3c-4-5.2-11.4-8.5-17.6-8.5-6.2.0-13.8 2.1-13.8 9.9.0 6.6 5.9 8.7 15.2 11.6 13.4 4.3 30.7 10 30.7 29.7.0 22.7-18.3 32.9-37.8 32.9-14.1.0-28.3-5.2-37-14.2l15.6-15.9c4.7 6 13.5 10.5 21.3 10.5 7.3.0 13.7-2.8 13.7-10.7.0-7.5-7.5-9.9-20.5-14.1C291.6 60.3 279 53.9 279 36c0-21.9 19.8-31 38.2-31 11.2.0 23.7 4.2 32.4 12.1z" class="st9"/></g></g><g id="g34"><g id="g33"><path id="path32" d="m433.1 106.4-21.3-39.2h-8.1v39.2h-23.4V7.6H418c19 0 37.8 7.3 37.8 29.9.0 13.3-7.8 22.7-20.5 26.6l25.8 42.3zm-16.9-79.6h-12.7v23h11.3c7.7.0 17.3-2 17.3-12 0-9.2-8.7-11-15.9-11z" class="st9"/></g></g><g id="g35"><path id="path34" d="M522.2 106.4h-36.8V7.6H521c28 0 56.5 11.7 56.5 49.1.0 34.7-28.1 49.7-55.3 49.7zm-1.7-78.5h-11.9v57.8h11.3c17 0 32.8-7 32.8-29 0-22.2-15.8-28.8-32.2-28.8z" class="st9"/></g></g></g></svg></span><span class=navbar-brand__name>OSRD</span></a><div class="td-navbar-nav-scroll ms-md-auto" id=main_navbar><ul class=navbar-nav><li class=nav-item><a class=nav-link href=/en/about/><span>About</span></a></li><li class=nav-item><a class="nav-link active" href=/en/docs/><span>Documentation</span></a></li><li class=nav-item><a class=nav-link href=/en/blog/><span>Blog</span></a></li><li class=nav-item><a class=nav-link href=/en/join-us/><span>Join us</span></a></li><li class="nav-item dropdown d-none d-lg-block"><div class=dropdown><a class="nav-link dropdown-toggle" href=# role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false>English</a><ul class=dropdown-menu><li><a class=dropdown-item href=/fr/>Français</a></li></ul></div></li></ul></div><div class="d-none d-lg-block"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/offline-search-index.b8cc235f6a1c97c9cb4f0b6206826e95.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>This is the multi-page printable view of this section.
<a href=# onclick="return print(),!1">Click here to print</a>.</p><p><a href=/en/docs/reference/design-docs/train-sim-v3/>Return to the regular view of this page</a>.</p></div><h1 class=title>Train simulation v3</h1><div class=lead>Modeling and API design of train simulations</div><ul><li>1: <a href=#pg-75208b44cdb98a19efc52289861e0992>Overview</a></li><li>2: <a href=#pg-a618aff3d81e63b72972eaa2757214ef>Prior art</a></li><li>3: <a href=#pg-13f6adc8701acf3fadf4728bc3e5b866>Driving instructions</a></li><li>4: <a href=#pg-872558797ab5f636ed80300e29072940>Driver behavior modules</a></li></ul><div class=content><div class="pageinfo pageinfo-warning"><p>This work is pending implementation, and has not yet been adjusted to
reflect potential required adjustments.</p></div><p>These articles describe the design of the new train simulation system.</p><p>This system should be simpler and more stable than the current one,
and should enable more advanced features in the future.</p></div></div><div class=td-content><h1 id=pg-75208b44cdb98a19efc52289861e0992>1 - Overview</h1><div class="pageinfo pageinfo-warning"><p>This work is pending implementation, and has not yet been adjusted to
reflect potential required adjustments.</p></div><p>After two years of extending a fairly simple simulation engine, it appeared that fundamental
changes are required to meet expectations.</p><h2 id=system-requirements>System requirements</h2><p>The new system is expected to:</p><ol><li>handle reactions to signaling</li><li>handle rich train state (pantograph position, battery state)</li><li>allow for different margin algorithms</li><li>integrate driver behavior properties</li><li>be easy to integrate with <a href=../timetable/>timetable v2</a></li><li>handle both:<ul><li>simulations of a full trip, with a complete known path, possibly following a schedule</li><li>simulations where the path is discovered incrementally</li></ul></li><li>provide a low-level API, usable independently</li></ol><p>In the long-term, this system is also expected to:</p><ul><li>be used to drive multi-train simulations</li><li>handling switching rolling stock at stops</li></ul><h2 id=concepts>Concepts</h2><pre class=mermaid>flowchart TD
subgraph Input
    InitTrainState[initial train state]
    PathPhysicsProps[path physics properties]
    AbstractDrivingInstructions[abstract driving instructions]
    TargetSchedule[target schedule]
end

DrivingInstructionCompiler([driving instruction compiler])
ConcreteDrivingInstructions[driving instructions &#43; limits]
ScheduleController([schedule controller])
DriverBehaviorModule([driver behavior module])

TargetSchedule --&gt; ScheduleController
ScheduleController -- adjusts slowdown coefficient --&gt; DriverBehaviorModule
AbstractDrivingInstructions --&gt; DrivingInstructionCompiler
PathPhysicsProps --&gt; DrivingInstructionCompiler
ScheduleController -- tracks train state --&gt; TrainSim

DriverBehaviorModule -- makes decisions --&gt; TrainSim
ConcreteDrivingInstructions --&gt; DriverBehaviorModule
DrivingInstructionCompiler --&gt; ConcreteDrivingInstructions

InitTrainState --&gt; ScheduleController

TrainSim --&gt; SimResults

TrainSim([train simulator])
SimResults[simulation result curve]</pre><h3 id=target-schedule>Target schedule</h3><p>The target schedule is a list of target arrival times at points specified along the path.
To respect the schedule, the train may have to not use its maximum traction.</p><h3 id=train-state>Train state</h3><p>The train state is a vector of properties describing the train at a given point in time.</p><ul><li>position</li><li>speed</li><li>position of pantographs</li><li>driver reaction times ?</li><li>battery state ?</li><li>time elapsed since the last update</li></ul><h3 id=driving-instructions>Driving instructions</h3><p>Driving instructions model what the train has to do along its path.
They are linked to conditions on their application, and can interact with each other.
They are generated using domain constraints such as speed limits or stops.</p><p>See <a href=https://osrd.fr/en/docs/reference/design-docs/train-sim-v3/driving-instruction/>the dedicated page</a> for more details.</p><h3 id=path-properties>Path properties</h3><p>Path properties are the physical properties of the path, namely elevation, curves and electrification.</p><h3 id=driver-behavior-module>Driver behavior module</h3><p>The driver behavior modules update the train state based on:</p><ul><li>the current train state</li><li>the path properties</li><li>the driving instructions</li><li>a slowdown coefficient (1 = no slowdown, 0 = full stop)</li></ul><p>The train state changes should be physically realistic.</p><p>See <a href=https://osrd.fr/en/docs/reference/design-docs/train-sim-v3/driver-behavior-modules/>the dedicated page</a> for more details.</p><h3 id=schedule-controller>Schedule controller</h3><p>The schedule controller manages the slowdown coefficient given to the driver behavior module in order
to respect the target schedule.</p><p>It adjusts the slowdown coefficient iteratively, using a dichotomous search, re-simulating the train behavior
between two time-targeted points.</p><h3 id=simulation-results>Simulation results</h3><p>The output of the simulation is the list of train states at each time step.</p><h2 id=design-overview>Design overview</h2><p>The main idea of the new train simulator is to have a simulation which is computed step by step and not post-processed.
This would ensure the physical consistency of the simulation.</p><p>The challenge is then to add ways to lose some time, in order to respect the target schedule.<br>This is done by iterating over the sections between two scheduled points, while adjusting a slowdown factor.
This slowdown factor would be used to control how the driver behavior module would lose time while still being
physically realistic.<br>See <a href=https://osrd.fr/en/docs/reference/design-docs/train-sim-v3/driver-behavior-modules/>the driver behavior module dedicated page</a> for more details.</p><p>In order to accommodate an infrastructure which could change with time (like signals), we introduce driving instructions.
These instructions are generated from the path properties and the target schedule, and are used to update the train state.
Instructions can be conditional, and can interact with each other.<br>The algorithm is described in detail in the <a href=https://osrd.fr/en/docs/reference/design-docs/train-sim-v3/driving-instruction/>dedicated page</a>.</p><p><img src=../overview.svg alt="Algorithm flow chart"></p><h2 id=design-limits>Design limits</h2><ul><li>trains do not anticipate margin transitions: only the next target arrival time matters for finding the slowdown factor</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-a618aff3d81e63b72972eaa2757214ef>2 - Prior art</h1><p>The current implementation has a number of shortcomings making it pretty much impossible to evolve to
meet current system requirements. It also has a number of less severe flaws, such as the over-reliance
on floating point, especially for input and output.</p><p>The previous implementation cannot be changed to:</p><ul><li>react to signaling, as constraints stay the same as the simulation evolves</li><li>handle rich train state vectors, due to the way margins are implemented</li><li>be usable for both incremental simulation and batch</li></ul><p>These limitations are the primary reasons for this redesign.</p><h2 id=margins>Margins</h2><ul><li><p>are defined as post-processing filter passes on simulation results. This has a number of undesirable side effects:</p><ul><li><p>margin algorithms produce the final simulation results. They may produce physically unrealistic simulations results</p></li><li><p>because margins are applied after the simulation, the simulation can&rsquo;t adjust to impossible margin values. Thus the simulation fails instead of giving a &ldquo;best effort&rdquo; result.</p></li><li><p>margin algorithms have no choice but to piece together results of different simulations:</p><ul><li>engineering margins are defined such that their effect has to be entirely contained within their bounds.
even though it&rsquo;s a desirable property, it means that simulations become a multi-pass affair, with no obvious
way of keeping train behavior consistent across passes and boundaries.</li><li>this can only be done if the train state is entirely described by its location and speed,
otherwise simulation results cannot be pieced together.</li><li>piecing together simulation results is very hard to execute reliably, as there are many corner cases to be considered.
the algorithm is quite brittle.</li></ul></li></ul></li><li><p>how much time should be lost and where isn&rsquo;t defined in a way that makes scheduled points implementation easy</p></li><li><p>when a transition between two margin values occurs, slow downs occur before value changes, and speed ups
after value changes. This is nice in theory, because it makes the graphs look nicer. The downside is that it
makes margin values interdependent at each slow-down, as how much speed needs to be lost affects the time lost
in the section.</p></li></ul><h2 id=input-modeling>Input modeling</h2><p>With the previous implementation, the simulation takes sequence of constraint position and speed curves as an input
(continuous in position, can be discontinuous in speed), and produces a continuous curve.</p><p>The output is fine, but the input is troublesome:</p><ul><li>braking curves have to be part of constraint curves</li><li>these constraint curves don&rsquo;t have a direct match with actual constraints, such as speed limits, stops, or reaction to signal</li><li>constraints cannot evolve over time, and cannot be interpreted differently depending on when the train reached these constraints</li><li>constraints cannot overlap. the input is pre-processed to filter out obscured constraints</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-13f6adc8701acf3fadf4728bc3e5b866>3 - Driving instructions</h1><p>Driving instructions model what the train has to do, and under what conditions.
Driving instructions are generated using domain constraints such as:</p><ul><li>unsignaled line speed limits</li><li>permanent signaled speed limits</li><li>temporary speed limits</li><li>dynamic signaling:<ul><li>block / moving block</li><li>dynamically signaled speed restrictions</li></ul></li><li>neutral zones</li><li>stops</li><li>margins</li></ul><p>There are two types of driving instructions:</p><ul><li><strong>Abstract driving instructions</strong> model the high-level, rolling stock independent
range of acceptable behavior: reach 30km/h at this location</li><li><strong>Concrete driving instructions</strong> model the specific range of acceptable behavior
for a specific rolling stock, using limit curves: don&rsquo;t go faster than this curve</li></ul><pre class=mermaid>flowchart TD
Constraint[constraint]
AbstractDrivingInstruction[abstract driving instruction]
ConcreteDrivingInstruction[concrete driving instruction]
RollingStockIntegrator[rolling stock integrator]
Compiler([compiler])

Constraint -- generates one or more --&gt; AbstractDrivingInstruction
AbstractDrivingInstruction --&gt; Compiler
RollingStockIntegrator --&gt; Compiler
Compiler --&gt; ConcreteDrivingInstruction</pre><div class="pageinfo pageinfo-warning"><p>After reviewing the design document, the necessity to distinguish between abstract and concrete driving instructions was questioned.</p><p>Indeed, it isn&rsquo;t clear whether the limit curves are used for the driving instructions interpretation algorithm.
If it isn&rsquo;t, the computation of limit curves could be moved inside the <a href=https://osrd.fr/en/docs/reference/design-docs/train-sim-v3/driver-behavior-modules/>driver behavior module</a>.</p><p>TODO: remove this message or fix the design document after implementation.</p></div><h2 id=interpreting-driving-instructions>Interpreting driving instructions</h2><p>During the simulation, driving instructions are partitioned into 4 sets:</p><ul><li><code>PENDING</code> instructions may apply at some point in the future</li><li><code>RECEIVED</code> instructions aren&rsquo;t enforced yet, but will be unless overridden</li><li><code>ENFORCED</code> instructions influence train behavior</li><li><code>DISABLED</code> instructions don&rsquo;t ever have to be considered anymore. There are multiple ways instructions can be disabled:<ul><li><code>SKIPPED</code> instructions were not received</li><li><code>RETIRED</code> instructions expired by themselves</li><li><code>OVERRIDDEN</code> instructions were removed by another instruction</li></ul></li></ul><pre class=mermaid>flowchart TD

subgraph disabled
    skipped
    retired
    overridden
end

subgraph active
    received
    enforced
end

pending --&gt; received
pending --&gt; skipped
received --&gt; enforced
received --&gt; overridden
enforced --&gt; retired
enforced --&gt; overridden</pre><p>These sets evolve as follows:</p><ul><li>when an integration steps overlaps a <code>PENDING</code> instruction&rsquo;s received condition, it is <code>RECEIVED</code> and becomes a candidate to execution<ul><li>existing instructions may be <code>OVERRIDDEN</code> due to an <code>override_on_received</code> operation</li></ul></li><li>if an instruction cannot ever be received at any future simulation state, it transitions to the <code>SKIPPED</code> state</li><li>when simulation state exceeds an instruction&rsquo;s enforcement position, it becomes <code>ENFORCED</code>. Only enforced instructions influence train behavior.<ul><li>existing instructions may be <code>OVERRIDDEN</code> due to an <code>override_on_enforced</code> operation</li></ul></li><li>when simulation state exceeds an instruction&rsquo;s retirement position, it becomes <code>RETIRED</code></li></ul><h3 id=overrides>Overrides</h3><p>When an instruction transitions to the <code>RECEIVED</code> or <code>ENFORCED</code> state, it can disable active instructions
which match some metadata predicate. There are two metadata attributes which can be relied on for overrides:</p><ul><li>the <code>kind</code> allows overriding previous instructions for a given domain, such as spacing or block signaled speed limits</li><li>the <code>rank</code> can be used as a &ldquo;freshness&rdquo; or &ldquo;priority&rdquo; field. If two instructions overriding each other are received
(such as when a train sees two signals), the rank allows deciding which instruction should be prioritized.</li></ul><p>This is required to implement a number of signaling features, as well as stops, where the stop instruction is overridden
by the restart instruction.</p><h3 id=data-model>Data model</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#204a87;font-weight:700>struct</span> <span style=color:#000>ReceivedCond</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>position_in</span>: <span style=color:#204a87>Option</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>PosRange</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>time_in</span>: <span style=color:#204a87>Option</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>TimeRange</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>struct</span> <span style=color:#000>InstructionMetadata</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic>// state transitions
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>received_when</span>: <span style=color:#000>ReceivedCond</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>enforced_at</span>: <span style=color:#000>Position</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>retired_at</span>: <span style=color:#204a87>Option</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>Position</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic>// instruction metadata, used by override filters. if an instruction
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic>// has no metadata nor retiring condition, it cannot be overridden.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>kind</span>: <span style=color:#204a87>Option</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>InstructionKindId</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic>// could be SPACING, SPEED_LIMIT
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>rank</span>: <span style=color:#204a87>Option</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>usize</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic>// when the instruction transitions to a given state,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic>// instructions matching any filter are overridden
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>override_on_received</span>: <span style=color:#204a87>Vec</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>OverrideFilter</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>override_on_enforced</span>: <span style=color:#204a87>Vec</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>OverrideFilter</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>enum</span> <span style=color:#000>AbstractInstruction</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>NeutralZone</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>SpeedTarget</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000>at</span>: <span style=color:#000>Position</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000>speed</span>: <span style=color:#000>Speed</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>enum</span> <span style=color:#000>ConcreteInstruction</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>NeutralZone</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>SpeedTarget</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000>braking_curve</span>: <span style=color:#000>SpeedPosCurve</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>},</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>struct</span> <span style=color:#000>OverrideFilter</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>kind</span>: <span style=color:#000>InstructionKindId</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>rank</span>: <span style=color:#204a87>Option</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>RankRelation</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>usize</span><span style=color:#000;font-weight:700>)</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>enum</span> <span style=color:#000>RankRelation</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>LT</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>LE</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>EQ</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>GE</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>GT</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h2 id=design-decisions>Design decisions</h2><h3 id=lowering-constraints-to-an-intermediate-representation>Lowering constraints to an intermediate representation</h3><p>Early on, we started making lists of what domain constraints can have an impact on train behavior.
Meanwhile, to simulate train behavior, we figured out that we need to know which constraints apply at any given time.</p><p>There&rsquo;s a fundamental tension between these two design constraints, which can be resolved in one of two ways:</p><ul><li>either treat each type of constraint as its own thing during the simulation</li><li>abstract away constraints into a common representation, and then simulate that</li></ul><h4 id=hahahugoshortcode178s1hbhb-distinct-constraint-types>❌
Distinct constraint types</h4><p>When we first started drafting architecture diagrams, the train simulation API directly took
a bunch of constraint types as an input. It brought up a number of issues:</p><ul><li>the high diversity of constraint types makes it almost impossible to describe all interactions between all constraint types</li><li>the domain of some of these interactions is very complex (block signaling)</li><li>when simulating, it does not seem to matter why a constraint is there, only what to do about it</li></ul><p>We couldn&rsquo;t find clear benefits to dragging distinctions between constraint types deep into the implementation.</p><h4 id=hahahugoshortcode178s2hbhb-internal-constraint-types-abstraction>❌
Internal constraint types abstraction</h4><p>We then realized that abstracting over constraint types during simulation had immense benefits:</p><ul><li>it allows expressing requirements on what constraints need to be enforceable</li><li>it greatly simplifies the process of validating constraint semantics: instead of having to validate interactions between
every possible type of constraints, we only have to validate that the semantics of each constraint type can be transferred
to the abstract constraint type</li></ul><p>We decided to explore the possibility of keeping constraint types distinct in the external API,
but lowering these constraints into an intermediary representation internally. We found a number of downsides:</p><ul><li>the public simulation API would still bear the complexity of dealing with many constraint types</li><li>there would be a need to incrementally generate internal abstracted constraints to support the incremental API</li></ul><h4 id=hahahugoshortcode178s3hbhb-external-constraint-types-abstraction>✅
External constraint types abstraction</h4><p>We tried to improve over the previous proposal by moving the burden of converting many constraints into a common abstraction out of the simulation API.</p><p>Instead of having many constraint types as an input, the simulation API takes a collection of a single abstract constraint type. The task of converting
domain constraints to abstract driving instructions is left to the API user.</p><p>We found that doing so:</p><ul><li>reduces the API surface of the train simulation module</li><li>decouples behavior from constraint types: if a new constraint type needs to be added, the simulation
API only needs expansion if the expected behavior expected for this constraint isn&rsquo;t part of the API.</li></ul><h3 id=interpreting-driving-instructions-1>Interpreting driving instructions</h3><p>As the train progresses through the simulation, it reacts according to driving instructions
which depend on more than the bare train physics state (position, time, and speed):</p><ul><li>the behavior of a train on each block depends on the state of the last passed block signal</li><li>if a train encounters a yellow light, then a red light, stops before the red light, and the
red light turns green, the train may have to keep applying the driving instruction from the
yellow signal until the green light is passed</li></ul><p>Thus, given:</p><ul><li>set of all possible driving instructions (alongside applicability metadata)</li><li>the result of previous integration steps (which may be extended to hold metadata)</li></ul><p>There is a need to know what driving instructions are applicable to the current integration step.</p><p>Overrides are a way of modeling instructions which disable previous ones. Here are some examples:</p><ul><li>if a driver watches a signal change state, its new aspect&rsquo;s instruction might take precedence over the previous one</li><li>as block signaling slows a train down, new signals can override instructions from previous signals, as they encode information that is more up to date</li></ul><p>We identified multiple filtering needs:</p><ul><li>overrides happen as a given kind of restriction is updated: SPACING instructions might override other SPACING instructions,
but wish to leave other speed restrictions unaffected</li><li>as multiple block signals can be visible at once, there&rsquo;s a need to avoid overriding instructions of downstream signals with updates to upstream signals</li></ul><p>We quickly settled on adding a kind field, but had a lengthy discussion over how to discriminate upstream and downstream signals.
We explored the following options:</p><ul><li>❌
adding <code>source</code> metadata, which was rejected as it does not address the issue of upstream / downstream</li><li>❌
adding identifiers to instructions, and overriding specific instructions, which was rejected as it makes
instruction generation and processing more complex</li><li>✅
adding some kind of priority / rank field, which was adopted</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-872558797ab5f636ed80300e29072940>4 - Driver behavior modules</h1><h2 id=design-specs>Design specs</h2><h3 id=general-pitch>General pitch</h3><p>Driver behavior modules are responsible for making driving decisions.
Its main responsibility, given the state of the train and an instruction, is to react to the instruction.
This reaction is expressed as a new train state.</p><p>To perform this critical task, it needs access to additional context:</p><ul><li>the physical properties of the path, which are used to make coasting decisions, and to model natural forces.</li><li>a slowdown coefficient, which is used to adjust how much the train is slowed down compared to a
full power simulation.</li></ul><p>The driver behavior modules are supposed to have different implementations, which would interpret the slow down coefficient differently.</p><h3 id=api>API</h3><p>One driver behavior module is instantiated per driving instruction.
It takes at initialization:</p><ul><li>a slowdown coefficient</li><li>the driving instruction</li><li>the path properties</li></ul><p>It has two public methods:</p><ul><li><p><code>enact_decision(current_state: TrainState, t: float) -> (TrainState, float)</code></p><p>Which returns what the next train state would be if there was only this one instruction to follow, and the time delta
to reach this state.</p></li><li><p><code>truncate_integration_step(current_state: TrainState, potential_state: TrainState, t: float, dt: float) -> (TrainState, float)</code></p><p>Which returns a state and time delta which respects the instruction, and is as close as possible to the potential state.</p></li></ul><h3 id=loop>Loop</h3><p>At a given train state, we know which driving instructions are enforced.</p><p>For each enforced driving instruction, we query the corresponding driver behavior module.</p><p>This gives a set of different train states. From this, we coalesce a single train state which respects all instructions.</p><p>To do so, we:</p><ol><li>Find the states which are most constraining for &ldquo;constraining properties&rdquo; (speed and pantograph state).</li></ol><ul><li>Most constraining state regarding speed is the one with the lowest acceleration (taking sign into account).</li><li>Most constraining state regarding pantograph state is the one which sets the pantograph down the earliest.</li></ul><ol start=2><li>Interpolate the <strong>constraining</strong> states to the smallest <code>dt</code> they are associated with.</li><li>Merge the <strong>constraining</strong> states into a single <strong>potential state</strong>:</li></ol><ul><li>for speed, we take the lowest acceleration</li><li>for pantograph state, we take the earliest pantograph state</li><li>other properties should be identical</li></ul><ol start=4><li>Submit the <strong>potential state</strong> for truncation to all driver behavior modules, chaining the outputs of <code>truncate_integration_step</code>.</li></ol><div class="pageinfo pageinfo-warning"><p>There is a heavy underlying assumption that &ldquo;constraining properties&rdquo; can be combined in a new state which
is valid.
This underlies the step 3. It is not yet clear if this assumption will always be valid in the future.</p><p>Also: what component should be in charge of instantiating all the driver behavior modules with the right implementation ?</p></div><p>Here is a schema summarizing the process:</p><p><img src=../reconciliation.svg alt="Driver behavior modules"></p><h3 id=a-short-case-for-why-step-4-is-needed>A short case for why step 4 is needed.</h3><p><img src=../overshoot.svg alt="most constraining state overshoots"></p><p>Here the constraints are in red, and the next state chosen by the driver behavior modules are in black.</p><p>In this example, the most constraining state is A, since it&rsquo;s the one which accelerates the least.
However, it overshoots constraint B, thus we need to select the state which respects both constraints.</p><h2 id=decision-process>Decision process</h2><h3 id=unifying-driver-behavior-and-margin-distribution-algorithms>Unifying driver behavior and margin distribution algorithms</h3><p>When this design project started, driver behavior was left completely undefined.
We assumed that a set of driving instructions can be unambiguously interpreted given a starting point.
This assumption was then decided to be relied on to search which margin speed ceiling yields expected
arrival times.</p><p>We also knew this assumption to be false: there are many ways instructions can be interpreted.
Worse yet, different use cases for OSRD have different needs:</p><ul><li>some users might want to reproduce existing timetables, which exhibit naive driver behavior:
aggressive accelerations, aggressive breaking behavior.</li><li>some users want to evaluate the feasibility of timetables, and thus want somewhat realistic driver
behavior, with less aggressive acceleration and cautious breaking behavior.</li></ul><p>To resolve this tension, we thought of adding support for pluggable driver behavior.
Doing so, however, would create two ways a timetable can be loosened (loose time):</p><ul><li>lowering the margin speed ceiling</li><li>making driver behavior less aggressive</li></ul><p>Let&rsquo;s say we want to loosen the timetable by 1 minute on a given section. It could be achieved by:</p><ul><li>lowering the speed ceiling using margins while keeping aggressive driver behavior</li><li>making driving behavior very conservative, but using no margins at all</li><li>lowering the speed ceiling a little, and making driving behavior a little more conservative</li><li>any other combination of the two factors</li></ul><p>This is an issue, as it might make simulation results unstable: because there possibly are many ways
to achieve the requested schedule, it would be very challenging to reliably choose a solution which
matches expectations.</p><ul><li>❌
We considered ignoring the issue, as driver behavior was initially out of the scope
of this design project. We decided not to, as we expected the cost of making later changes to integrate
driver behavior to be significant.</li><li>✅
We decided to avoid this shortcoming by making margin distribution part of driver behavior.
Driver behavior modules are controlled by a slowdown coefficient between 0 (loose as much time as shall
be achieved) and 1 (loose no time).</li></ul><h3 id=interfacing-driver-behavior-driving-instructions-and-numerical-integration>Interfacing driver behavior, driving instructions, and numerical integration</h3><p>Driver behavior can be formally modeled as a local decision function <code>f</code>, which takes the state of the
train as an input, including position and speed, and returns an acceleration.</p><p>To best integrate this acceleration over the given time step, it is best not to use only the acceleration at (t).
Since it may vary a lot along [t, t+dt]. To approximate the acceleration within this interval,
we would need a better estimator, using a numerical method such as
<a href=https://en.wikipedia.org/wiki/Runge%E2%80%93Kutta_methods>RK4</a>. Such estimator then needs to call <code>f</code> multiple times.</p><p>A number of questions came up:</p><ul><li>should numerical integration within the driver behavior module, or outside</li><li>are driver behavior modules queried about their reaction to a specific instruction, or in general</li><li>does the driver behavior module return decisions, or parameters used to make decisions (such as curves)</li><li>if decisions are returned, is it a force, an acceleration, or a new state</li><li>if a new state is returned, how to deal with heterogenous time steps</li><li>do we check decisions for correctness? that is, if a decision causes the train to overshoot a limit curve,
do we do anything?</li></ul><h4 id=do-we-have-a-single-dbm-for-all-driving-instructions-or-one-per-driving-instruction>Do we have a single DBM for all driving instructions, or one per driving instruction?</h4><p>We identified that this API choice shouldn&rsquo;t constrain the implementation.
We decided to go the conservative route and have <em>one DBM per driving instructions</em> as it reduces the API surface
and relieves DBM from the responsibility of finding the most restrictive instruction.</p><h4 id=how-do-we-prevent-overshooting>How do we prevent overshooting?</h4><p>We identified that DBMs need the ability to follow internal target curves (distinct from limit curves).</p><p>To do so we could either:</p><ol><li>Have a way to short-circuit our integration scheme, to snap to target curves without overshooting.</li><li>Accept oscillations around target curves (and thus overshooting).</li><li>Setup a feedback loop mechanism to avoid overshooting.</li></ol><p>We decided that only the first option was desirable.</p><p>The design choices then are:</p><h5 id=hahahugoshortcode176s3hbhb-make-the-dbm-as-close-as-possible-to-a-decision-function>❌
Make the DBM as close as possible to a decision function</h5><p>Then the DBM would not be aware of the time step it is called with, and would return an acceleration. Then the module should expose two methods:</p><ul><li><p>One for taking decisions, akin to <code>f</code>.<br>Called several times depending on the integration method.</p></li><li><p>One for correcting an integration step (i.e. a time step and a new state), if it happened to overshoot its internal goal curves
(for example MARECO which sets it&rsquo;s own speed limits).<br>Called on the integration step results from this DBM, and the other DBMs integration step results.</p></li></ul><h5 id=hahahugoshortcode176s4hbhb-the-dbm-returns-a-new-state>✅
The DBM returns a new state</h5><p>The module would then expose two methods:</p><ul><li><p>One for taking decisions, which, given a train state and a desired/maximum time step, returns a new state (which does not overshoot) and a new current time.</p></li><li><p>One for correcting an integration step (i.e. a time step and a new state), if it happened to overshoot its internal goal curves
(for example MARECO which sets it&rsquo;s own speed limits).<br>Called only on other DBMs integration step results.</p></li></ul><h4 id=how-do-we-combine-the-decisions-from-all-dbms>How do we combine the decisions from all DBMs?</h4><ol><li>For each state property, find the most constraining value and <code>dt</code>.</li><li>Find the smallest <code>dt</code> amongst constraining properties. Interpolate remaining properties to this <code>dt</code>, to build a provisional state.</li><li>Submit this provisional state for truncation to all DBMs and take the truncation with the smallest <code>dt</code>.</li></ol><p>To understand how this algorithm is designed, we need to consider two example cases:</p><ul><li>For steps 1 and 2: if a neutral zone and a breaking instruction overlap, both are most constraining to different state properties:
the neutral zone affects pantograph state, and the breaking instruction affects speed. The final state has to be a combination of both.</li><li>For step 3: We need to truncate integration steps to avoid overshoots, and thus avoid the need for feedback loops.
Ideally, we want to truncate to the exact overshoot location. This overshoot location is not the same as the initial <code>dt</code> for the overshot constraint.</li></ul><h3 id=should-truncate_integration_step-depend-on-the-driver-behavior-module>Should <code>truncate_integration_step</code> depend on the driver behavior module?</h3><p>Yes: DBMs may use internal representations that the new state should not overshoot.
For instance, when passed a driving instruction with a speed limit of 60km/h,
a DBM wishing to lose time may reduce the speed to 50 km/h.</p></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="col-6 col-sm-4 text-xs-center order-sm-2"></div><div class="col-6 col-sm-4 text-end text-xs-center order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=GitHub aria-label=GitHub><a target=_blank rel=noopener href=https://github.com/OpenRailAssociation/osrd aria-label=GitHub><i class="fab fa-github"></i></a></li></ul></div><div class="td-footer__copyright-etc col-12 col-sm-4 text-center py-2 order-sm-2"><span>&copy; 2025 OSRD contributors. All Rights Reserved</span></div></div></div></footer></div><style>.markmap>svg{width:100%;height:300px}</style><script>window.markmap={autoLoader:{manual:!0,onReady(){const{autoLoader:e,builtInPlugins:t}=window.markmap;e.transformPlugins=t.filter(e=>e.name!=="prism")}}}</script><script src=https://cdn.jsdelivr.net/npm/markmap-autoloader></script><script src=https://cdn.jsdelivr.net/npm/mermaid@9.3.0/dist/mermaid.min.js integrity="sha512-ku2nmBrzAXY5YwohzTqLYH1/lvyMrpTVxgQKrvTabd/b/uesqltLORdmpVapYv6QhZVCLUX6wkvFaKOAY4xpUA==" crossorigin=anonymous></script><script src=/js/main.min.4261519102c0270f3bdd4edcd2b45867ee7a584a0ea82c94f59e4f991c6337a1.js integrity="sha256-QmFRkQLAJw873U7c0rRYZ+56WEoOqCyU9Z5PmRxjN6E=" crossorigin=anonymous></script><script defer src=/js/click-to-copy.min.f724d3de49218995223b7316aa2e53e2b34bf42026bf399ebb21bb02212402d1.js integrity="sha256-9yTT3kkhiZUiO3MWqi5T4rNL9CAmvzmeuyG7AiEkAtE=" crossorigin=anonymous></script><script src=/js/tabpane-persist.js></script></body></html>