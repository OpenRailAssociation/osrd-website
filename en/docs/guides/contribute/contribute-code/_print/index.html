<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=canonical type=text/html href=https://osrd.fr/en/docs/guides/contribute/contribute-code/><link rel=alternate type=application/rss+xml href=https://osrd.fr/en/docs/guides/contribute/contribute-code/index.xml><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Contribute code | OSRD</title>
<meta name=description content="Integrate changes into OSRD"><meta property="og:title" content="Contribute code"><meta property="og:description" content="Integrate changes into OSRD"><meta property="og:type" content="website"><meta property="og:url" content="https://osrd.fr/en/docs/guides/contribute/contribute-code/"><meta itemprop=name content="Contribute code"><meta itemprop=description content="Integrate changes into OSRD"><meta name=twitter:card content="summary"><meta name=twitter:title content="Contribute code"><meta name=twitter:description content="Integrate changes into OSRD"><link rel=preload href=/scss/main.min.4d9db1288b215f6876c21ef883bcd30df98e7409451895d47ac7aa0297a1a496.css as=style><link href=/scss/main.min.4d9db1288b215f6876c21ef883bcd30df98e7409451895d47ac7aa0297a1a496.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.6.3.min.js integrity="sha512-STof4xm1wgkfm7heWqFJVn58Hm3EtS31XFaagaa8VMReCXAkQnJZ+jEy8PCC/iT18dFy95WcExNHFTqLyp72eQ==" crossorigin=anonymous></script><script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script></head><body class=td-section><header><nav class="td-navbar navbar-dark js-navbar-scroll"><div class="container-fluid flex-column flex-md-row"><a class=navbar-brand href=/en/><span class="navbar-brand__logo navbar-logo"><svg xmlns="http://www.w3.org/2000/svg" id="svg36" width="110.767" height="22"><style id="style1">.st9{fill:#fff}</style><g id="ok" transform="scale(.1918)"><g id="g36"><g id="g29"><path id="path23" d="M38.5 83.4c-1.9 8.2-2.9 17-2.9 26.5v4.8h16.6c-2.8-13.2-7.8-23.4-13.7-31.3z" class="st9"/><path id="path24" d="M0 57.5v19.9c3.1 1.2 6.3 2.7 9.5 4.6 8.5 5.2 15 12.6 19.4 21.8v-31c-3.4-3-6.9-5.5-10.3-7.5-6.5-3.7-13-6.2-18.6-7.8z" class="st9"/><path id="path25" d="M35.6 69.9c4.3-11.3 10.6-21.1 18.9-29.4V0H35.6z" class="st9"/><path id="path26" d="M40.8 75.4c5.3 6.2 10.1 13.8 13.7 23.3V50.6C48.6 57.8 44 66.1 40.8 75.4z" class="st9"/><path id="path27" d="M100.7.0H61.3v34.5C73.1 25.2 86 20 96.9 17.2c1.8-.5 3.7.6 4.1 2.4.5 1.8-.6 3.6-2.4 4.1-11.4 2.9-25.3 8.6-37.2 19.7v31.8c2.9-6.3 6.7-11.7 11.4-16.4 9.4-9.3 21-14.1 30.5-16.6 1.8-.5 3.7.6 4.1 2.4.5 1.8-.6 3.6-2.4 4.1-4.7 1.2-10.1 3.1-15.3 6-19 10.3-28.2 28.4-28.2 55.2v4.8h39.3c7.8.0 14.1-6.3 14.1-14.1V14.1C114.7 6.3 108.4.0 100.7.0z" class="st9"/><path id="path28" d="M22 59.6c2.2 1.3 4.5 2.8 6.8 4.6V0H14.1C6.3.0.0 6.3.0 14.1v36.4c6.5 1.7 14.2 4.5 22 9.1z" class="st9"/><path id="path29" d="M5.4 87.5c-1.8-1.1-3.6-2-5.4-2.8v15.9c0 7.8 6.3 14.1 14.1 14.1h11.6c-3.6-12.2-10.4-21.3-20.3-27.2z" class="st9"/></g><g id="g30"><path id="path30" d="M201.7 109c-30.8.0-53.7-21.2-53.7-52.5.0-31.7 22.9-51.6 53.7-51.6 31 0 53.9 20 53.9 51.6-.1 31.3-23 52.5-53.9 52.5zm0-82.6c-16.7.0-28.2 12.8-28.2 30.1.0 17.9 11.6 30.7 28.2 30.7S230 74.4 230 56.6c0-17.3-11.6-30.2-28.3-30.2z" class="st9"/></g><g id="g32"><g id="g31"><path id="path31" d="M334.3 33.3c-4-5.2-11.4-8.5-17.6-8.5-6.2.0-13.8 2.1-13.8 9.9.0 6.6 5.9 8.7 15.2 11.6 13.4 4.3 30.7 10 30.7 29.7.0 22.7-18.3 32.9-37.8 32.9-14.1.0-28.3-5.2-37-14.2l15.6-15.9c4.7 6 13.5 10.5 21.3 10.5 7.3.0 13.7-2.8 13.7-10.7.0-7.5-7.5-9.9-20.5-14.1C291.6 60.3 279 53.9 279 36c0-21.9 19.8-31 38.2-31 11.2.0 23.7 4.2 32.4 12.1z" class="st9"/></g></g><g id="g34"><g id="g33"><path id="path32" d="m433.1 106.4-21.3-39.2h-8.1v39.2h-23.4V7.6H418c19 0 37.8 7.3 37.8 29.9.0 13.3-7.8 22.7-20.5 26.6l25.8 42.3zm-16.9-79.6h-12.7v23h11.3c7.7.0 17.3-2 17.3-12 0-9.2-8.7-11-15.9-11z" class="st9"/></g></g><g id="g35"><path id="path34" d="M522.2 106.4h-36.8V7.6H521c28 0 56.5 11.7 56.5 49.1.0 34.7-28.1 49.7-55.3 49.7zm-1.7-78.5h-11.9v57.8h11.3c17 0 32.8-7 32.8-29 0-22.2-15.8-28.8-32.2-28.8z" class="st9"/></g></g></g></svg></span><span class=navbar-brand__name>OSRD</span></a><div class="td-navbar-nav-scroll ms-md-auto" id=main_navbar><ul class=navbar-nav><li class=nav-item><a class=nav-link href=/en/about/><span>About</span></a></li><li class=nav-item><a class="nav-link active" href=/en/docs/><span>Documentation</span></a></li><li class=nav-item><a class=nav-link href=/en/blog/><span>Blog</span></a></li><li class="nav-item dropdown d-none d-lg-block"><div class=dropdown><a class="nav-link dropdown-toggle" href=# role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false>English</a><ul class=dropdown-menu><li><a class=dropdown-item href=/fr/docs/guides/contribute/contribute-code/>Français</a></li></ul></div></li></ul></div><div class="d-none d-lg-block"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/offline-search-index.a0ed946b9e1373ed9b9fffd6edd5eda5.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>This is the multi-page printable view of this section.
<a href=# onclick="return print(),!1">Click here to print</a>.</p><p><a href=/en/docs/guides/contribute/contribute-code/>Return to the regular view of this page</a>.</p></div><h1 class=title>Contribute code</h1><div class=lead>Integrate changes into OSRD</div><ul><li>1: <a href=#pg-20bcbda082d1db739aaf2707ad636133>General principles</a></li><li>2: <a href=#pg-1dc6aff750b242c67234a9fd8036834a>Back-end conventions</a></li><li>3: <a href=#pg-c00d970cd31ed499e445d0092488ea53>Front-end conventions</a></li><li>4: <a href=#pg-e860c4a45f93c7fb63441214882a9d83>Write code</a></li><li>5: <a href=#pg-e1c0c750b30e798f534acb8a5060da66>Commit conventions</a></li><li>6: <a href=#pg-686cc94482965b0e45aee58c42de5752>Share your changes</a></li><li>7: <a href=#pg-24dfcd6e0a300c88dde36000f0679f04>Tests</a></li></ul><div class=content><p>This chapter is about the process of integrating changes into the common code base. <strong>If you need help at any stage, open an issue or message us.</strong></p><p>OSRD application is split in multiple services written in several languages. We try to follow general code best practices and follow each language specificities when required.</p></div></div><div class=td-content style=page-break-before:always><h1 id=pg-20bcbda082d1db739aaf2707ad636133>1 - General principles</h1><div class=lead>Please read this first!</div><ul><li>Explain what you&rsquo;re doing and why.</li><li>Document new code with doc comments.</li><li>Include clear, simple tests.</li><li>Break work into digestible chunks.</li><li>Take the time to pick good names.</li><li>Avoid non well-known abbreviations.</li><li><strong>Control and consistency over 3rd party code reuse</strong>: Only add a dependency if it is absolutely necessary.</li><li>Every dependency we add decreases our autonomy and consistency.</li><li>We try to keep PRs bumping dependencies to a low number each week in each component, so grouping
dependency bumps in a batch PR is a valid option (see component&rsquo;s <code>README.md</code>).</li><li><strong>Don&rsquo;t reinvent every wheel</strong>: as a counter to the previous point, don&rsquo;t reinvent everything at all costs.</li><li>If there is a dependency in the ecosystem that is the &ldquo;de facto&rdquo; standard, we should heavily consider using it.</li><li>More code general recommendations in main repository <a href=https://github.com/osrd-project/osrd/blob/dev/CONTRIBUTING.md>CONTRIBUTING.md</a>.</li><li>Ask for any help that you need!</li></ul><p><em><a href=https://osrd.fr/en/docs/guides/contribute/contribute-code/backend-conventions/>Consult back-end conventions ‣</a></em></p><p><em><a href=https://osrd.fr/en/docs/guides/contribute/contribute-code/frontend-conventions/>Consult front-end conventions ‣</a></em></p><p><em><a href=https://osrd.fr/en/docs/guides/contribute/contribute-code/write-code/>Continue towards write code ‣</a></em></p><p><em><a href=https://osrd.fr/en/docs/guides/contribute/contribute-code/tests/>Continue towards tests ‣</a></em></p></div><div class=td-content style=page-break-before:always><h1 id=pg-1dc6aff750b242c67234a9fd8036834a>2 - Back-end conventions</h1><div class=lead>Coding style guide and best practices for back-end</div><h1 id=python>Python</h1><p>Python code is used for some packages and integration testing.</p><ul><li>Follow <a href=https://www.python.org/dev/peps/pep-0020/>the Zen of Python</a>.</li><li>Code is linted with <a href=https://github.com/csachs/pyproject-flake8>flake8</a>.</li><li>Code is formatted with <a href=https://github.com/psf/black>Black</a>.</li><li>Imports are sorted with <a href=https://github.com/PyCQA/isort>Isort</a>.</li><li>Python tests are written using <a href=https://docs.pytest.org/>pytest</a>.</li><li>Typing is checked using <a href=https://google.github.io/pytype/>pytype</a>.</li></ul><h1 id=rust>Rust</h1><ul><li>As a reference for our API development we are using the <a href=https://rust-lang.github.io/api-guidelines/about.html>Rust API guidelines</a>.
Generally, these should be followed.</li><li>Prefer granular imports over glob imports like <code>diesel::*</code>.</li><li>Tests are written with the <a href=https://doc.rust-lang.org/book/ch11-01-writing-tests.html>built-in testing framework</a>.</li><li>Use the <a href=https://doc.rust-lang.org/rust-by-example/meta/doc.html>documentation example</a> to know how to phrase and format your documentation.</li><li>Use consistent comment style:<ul><li><code>///</code> doc comments belong above <code>#[derive(Trait)]</code> invocations.</li><li><code>//</code> comments should generally go above the line in question, rather than in-line.</li><li>Start comments with capital letters. End them with a period if they are sentence-like.</li></ul></li><li>Use comments to organize long and complex stretches of code that can&rsquo;t sensibly be refactored into separate functions.</li><li>Code is linted with <a href=https://github.com/rust-lang/rust-clippy>clippy</a>.</li><li>Code is formatted with <a href=https://github.com/rust-lang/rustfmt>fmt</a>.</li></ul><h1 id=java>Java</h1><ul><li>Code is formatted with <a href=https://checkstyle.sourceforge.io/>checkstyle</a>.</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-c00d970cd31ed499e445d0092488ea53>3 - Front-end conventions</h1><div class=lead>Coding style guide and best practices for front-end</div><p>We use <strong>ReactJS</strong> and all files must be written in <strong>Typescript</strong>.</p><p>The code is <strong>linted</strong> with <a href=https://eslint.org/>eslint</a>, and <strong>formatted</strong> with <a href=https://prettier.io/>prettier</a>.</p><h2 id=nomenclature>Nomenclature</h2><p><img src=/images/docs/contribute/nomenclature-front-end.svg alt="Infrastructure diagram"></p><p>The <strong>applications</strong> (osrd eex, osrd stdcm, infra editor, rolling-stock editor) offer <strong>views</strong> (project management, study management, etc.) linked to <strong>modules</strong> (project, study, etc.) which contain the components.</p><p>These <strong>views</strong> are made up of <strong>components</strong> and sub-components <u>all derived from the modules</u>.
In addition to containing the <strong>views</strong> files for the applications, they may also contain a <strong>scripts</strong> directory which offers scripts related to these views. The <strong>views</strong> determine the logic and <u>access to the store</u>.</p><p><strong>Modules</strong> are collections of <strong>components</strong> attached to an <strong>object</strong> (a scenario, a rolling stock, a TrainSchedule). They contain :</p><ul><li>a <em>components</em> directory hosting <u>all</u> components</li><li>an optional <em>styles</em> directory <u>per module</u> for styling components in scss</li><li>an optional <em>assets</em> directory <u>per module</u> (which contains assets, e.g. default datasets, specific to the module)</li><li>an optional <em>reducers</em> file <u>per module</u></li><li>an optional <em>types</em> file <u>per module</u></li><li>an optional <em>consts</em> file <u>per module</u></li></ul><p>An <strong>assets</strong> directory (containing images and other files).</p><p>Last but not least, a <strong>common</strong> directory offering :</p><ul><li>a <em>utils</em> directory for utility functions common to the entire project</li><li>a <em>types</em> file for types common to the entire project</li><li>a <em>consts</em> file for constants common to the entire project</li></ul><h2 id=implementation-principles>Implementation principles</h2><h3 id=routing--slug>Routing & SLUG</h3><p><em>In progress</em></p><p><code>projects/{nom du projet}/studies/{nom de l'étude}/scenarios/{nom du scenario}</code></p><h3 id=styles--scss>Styles & SCSS</h3><blockquote><p>WARNING: in CSS/React, the scope of a class does not depend on where the file is imported, but is valid for the entire application. If you import an <code>scss</code> file in the depths of a component (which we strongly advise against), its classes will be available to the whole application and may therefore cause side effects.</p></blockquote><p>It is therefore highly recommended to be able to easily follow the tree structure of applications, views, modules and components also within the SCSS code, and in particular to nest class names to avoid edge effects, as the compiler will take care of making the necessary hierarchy.</p><p>If, for example, we have a <code>rollingStockSelector</code> component which proposes a list of rolling stock <code>rollingStockList</code> represented by <code>rollingStockCard</code> containing an image representing the rolling stock <code>rollingStockImg</code> we should have the following SCSS structure:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scss data-lang=scss><span style=display:flex><span><span style=color:#000>.rollinStockSelector</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>.rollingStockList</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>.rollingStockCard</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>.rollingStockImg</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#c4a000>width</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>5</span><span style=color:#204a87;font-weight:700>rem</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>        <span style=color:#c4a000>height</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#ce5c00>auto</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>This ensures that the image contained in the rolling stock card inherits the correct css properties <code>.rollinStockSelector.rollingStockList.rollingStockCard.rollingStockImg</code>.</p><h4 id=css-modules>CSS Modules</h4><p>CSS modules allow scoping CSS styles to a specific component, thereby avoiding conflicts with global class names.</p><p>Vite natively supports CSS modules. Ensure that your CSS file has the <code>.module.css</code> extension, for example, <code>styles.module.css</code>.</p><h5 id=using-css-modules-in-components>Using CSS Modules in Components</h5><ol><li><strong>Create an SCSS file with the <code>.module.scss</code> extension</strong>:</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-css data-lang=css><span style=display:flex><span><span style=color:#8f5902;font-style:italic>/* MyComponent.module.scss */</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>.</span><span style=color:#000>container</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>background-color</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>white</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>.</span><span style=color:#000>title</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>font-size</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>24</span><span style=color:#204a87;font-weight:700>px</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>color</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>#333</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><ol start=2><li><strong>Use the classes in your React component</strong>:</li></ol><p>Vite transforms classes into objects that contain hashed classes (e.g., <code>_container_h3d8bg</code>) and uses them during bundle generation, making the classes unique.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tsx data-lang=tsx><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>React</span> <span style=color:#204a87;font-weight:700>from</span> <span style=color:#4e9a06>&#34;react&#34;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>styles</span> <span style=color:#204a87;font-weight:700>from</span> <span style=color:#4e9a06>&#34;./MyComponent.module.scss&#34;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>export</span> <span style=color:#204a87;font-weight:700>function</span> <span style=color:#000>MyComponent() {</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000;font-weight:700>(</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>div</span> <span style=color:#c4a000>className</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000;font-weight:700>{</span><span style=color:#000>styles</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>container</span><span style=color:#000;font-weight:700>}&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>h1</span> <span style=color:#c4a000>className</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000;font-weight:700>{</span><span style=color:#000>styles</span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;title&#34;</span><span style=color:#000;font-weight:700>]}&gt;</span><span style=color:#000>My</span> <span style=color:#000>Title</span><span style=color:#000;font-weight:700>&lt;/</span><span style=color:#204a87;font-weight:700>h1</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>&lt;/</span><span style=color:#204a87;font-weight:700>div</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>For more information, you can refer to the <a href=https://vitejs.dev/guide/features.html#css-modules>Vite.js documentation</a>.</p><h4 id=class-names-using-cx>Class names, using <code>cx()</code>.</h4><p>Classes are normally added one after the other, in the <code>className=""</code> property.</p><p>However, when necessary - class usage tests, concatenation, etc. - we use the <a href=https://github.com/JedWatson/classnames>classnames library</a>, which recommends the following usage:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>div</span> <span style=color:#c4a000>className</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;rollingStockSelector&#34;</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>div</span> <span style=color:#c4a000>className</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;rollingStockList&#34;</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>div</span> <span style=color:#c4a000>className</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;rollingStockCard w-100 my-2&#34;</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>img</span>
</span></span><span style=display:flex><span>        <span style=color:#c4a000>className</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000;font-weight:700>{</span><span style=color:#000>cx</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;rollingStockImg&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;m-2&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;p-1&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;bg-white&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>          <span style=color:#000>valid</span>: <span style=color:#204a87;font-weight:700>isValid</span><span style=color:#000;font-weight:700>(),</span>
</span></span><span style=display:flex><span>          <span style=color:#000>selected</span>: <span style=color:#204a87;font-weight:700>rollingStockID</span> <span style=color:#ce5c00;font-weight:700>===</span> <span style=color:#000>selectedRollingStockID</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>})}</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>&lt;/</span><span style=color:#204a87;font-weight:700>div</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>&lt;/</span><span style=color:#204a87;font-weight:700>div</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>&lt;/</span><span style=color:#204a87;font-weight:700>div</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span></code></pre></div><p>Classes are <strong>separated</strong> each in a <code>string</code> and Boolean or other operations are performed in an object that will return - or not - the property name as the class name to be used in CSS.</p><h3 id=storeredux>Store/Redux</h3><p>Everything that is <em>selector</em> is managed by the <strong>view</strong> and passed as props to components and sub-components.</p><p>Consequently, read and write calls to the store must be made at view level, irrigating the components proposed by the view with <em>props</em> and <em>states</em>.</p><h3 id=rtk>RTK</h3><p>Use generated endpoints from <code>openapi.yaml</code> files to consume the backend.</p><h4 id=operation-of-rtk-query-cache>Operation of RTK Query cache</h4><p>When the data is retrieved from the back, RTK is caching it into the store. If the same endpoint is called again with same parameters, RTK will use the cache data instead of making a new call to the back.</p><p>In the store, you will see the <code>editoastApi</code> key containing the cached data of all editoast endpoints:</p><p><img src=/images/docs/contribute/store-redux-main.png alt="store Redux"></p><p>Here for example, the <code>getProjects</code> endpoint is called.</p><p>RTK stores the endpoint&rsquo;s name, as well as the call&rsquo;s parameters, to form an unique key <code>nomDuEndpoint({ paramètres })</code>. (here <code>getProjects({"ordering":"LastModifiedDesc","pageSize":1000})</code>).</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#4e9a06>&#39;getProjectsByProjectIdStudiesAndStudyId({&#34;projectId&#34;:13,&#34;studyId&#34;:16})&#39;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>status</span> <span style=color:#ce5c00;font-weight:700>:</span><span style=color:#4e9a06>&#34;fulfilled&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#000>etc</span><span style=color:#a40000>…</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>  <span style=color:#4e9a06>&#39;getProjectsByProjectIdStudiesAndStudyId({&#34;projectId&#34;:13,&#34;studyId&#34;:14})&#39;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#a40000>…</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>In this second example, the same endpoint has been called with the ssame <code>projectId</code> parameter, but a different <code>studyId</code> parameter.</p><h5 id=serialization-of-keys-in-the-cache>Serialization of keys in the cache</h5><p>The strings used as keys in the cache are essentially the parameter object passed through the <code>JSON.stringify</code> function, which converts a JS object into a string (thus serialized).</p><p>Normally, serialization does not preserve the order of object keys. For example, <code>JSON.stringify</code> will not produce the same string with these two objects: <code>{ a: 1, b: 2 }</code> and <code>{ b: 2, a: 1 }</code>.</p><p>RTK will optimize caching by ensuring that the result of a call with <code>{"projectId":13,"studyId":16}</code> or <code>{"studyId":16, "projectId":13}</code> is stored under the same key in the cache.</p><p>To see the detailed operation, here is the code for this serialization function:</p><details><summary>RTK Serialization Function</summary><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>defaultSerializeQueryArgs</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000>SerializeQueryArgs</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>any</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>({</span>
</span></span><span style=display:flex><span>    <span style=color:#000>endpointName</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#000>queryArgs</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>})</span> <span style=color:#000;font-weight:700>=&gt;</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>let</span> <span style=color:#000>serialized</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>cached</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>cache</span><span style=color:#ce5c00;font-weight:700>?</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>get</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>queryArgs</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>typeof</span> <span style=color:#000>cached</span> <span style=color:#ce5c00;font-weight:700>===</span> <span style=color:#4e9a06>&#39;string&#39;</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>serialized</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>cached</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>else</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>stringified</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>JSON</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>stringify</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>queryArgs</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>key</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>value</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>=&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#000>isPlainObject</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>value</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>          <span style=color:#ce5c00;font-weight:700>?</span> <span style=color:#204a87>Object</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>keys</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>value</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>              <span style=color:#000;font-weight:700>.</span><span style=color:#000>sort</span><span style=color:#000;font-weight:700>()</span> <span style=color:#8f5902;font-style:italic>// keys are reordered here
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>              <span style=color:#000;font-weight:700>.</span><span style=color:#000>reduce</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>any</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>((</span><span style=color:#000>acc</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>key</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>=&gt;</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>                <span style=color:#000>acc</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>key</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>value</span> <span style=color:#000>as</span> <span style=color:#000>any</span><span style=color:#000;font-weight:700>)[</span><span style=color:#000>key</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span>                <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>acc</span>
</span></span><span style=display:flex><span>              <span style=color:#000;font-weight:700>},</span> <span style=color:#000;font-weight:700>{})</span>
</span></span><span style=display:flex><span>          <span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000>value</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>isPlainObject</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>queryArgs</span><span style=color:#000;font-weight:700>))</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>cache</span><span style=color:#ce5c00;font-weight:700>?</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>set</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>queryArgs</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>stringified</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>      <span style=color:#000>serialized</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>stringified</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>// Sort the object keys before stringifying, to prevent useQuery({ a: 1, b: 2 }) having a different cache key than useQuery({ b: 2, a: 1 })
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#4e9a06>`</span><span style=color:#4e9a06>${</span><span style=color:#000>endpointName</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>(</span><span style=color:#4e9a06>${</span><span style=color:#000>serialized</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>)`</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div></details><h5 id=data-subscription>Data subscription</h5><p>In RTK Query terminology, when a React component calls an endpoint defined in RTK Query, it <em>subscribes</em> to the data.</p><p>RTK counts the number of references to the same pair (endpoint, {parameters}). When two components subscribe to the same data, they share the same key in the cache.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#000>osrdEditoastApi</span> <span style=color:#000;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>from</span> <span style=color:#4e9a06>&#34;./api.ts&#34;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>function</span> <span style=color:#000>Component1() {</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// component subscribes to the data
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>const</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#000>data</span> <span style=color:#000;font-weight:700>}</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>osrdEditoastApi</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>useGetXQuery</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>div</span><span style=color:#000;font-weight:700>&gt;...&lt;/</span><span style=color:#204a87;font-weight:700>div</span><span style=color:#000;font-weight:700>&gt;;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>function</span> <span style=color:#000>Component2() {</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// component subscribes to the data
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>const</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#000>data</span> <span style=color:#000;font-weight:700>}</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>osrdEditoastApi</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>useGetXQuery</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>div</span><span style=color:#000;font-weight:700>&gt;...&lt;/</span><span style=color:#204a87;font-weight:700>div</span><span style=color:#000;font-weight:700>&gt;;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>function</span> <span style=color:#000>Component3() {</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// component subscribes to the data
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>const</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#000>data</span> <span style=color:#000;font-weight:700>}</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>osrdEditoastApi</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>useGetXQuery</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>div</span><span style=color:#000;font-weight:700>&gt;...&lt;/</span><span style=color:#204a87;font-weight:700>div</span><span style=color:#000;font-weight:700>&gt;;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>function</span> <span style=color:#000>Component4() {</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// component subscribes to the *same* data as ComponentThree,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#8f5902;font-style:italic>// as it has the same query parameters
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>const</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#000>data</span> <span style=color:#000;font-weight:700>}</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>osrdEditoastApi</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>useGetXQuery</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>div</span><span style=color:#000;font-weight:700>&gt;...&lt;/</span><span style=color:#204a87;font-weight:700>div</span><span style=color:#000;font-weight:700>&gt;;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>Here, <code>Component3</code> and <code>Component4</code> will generate only one call to the backend. They subscribe to the same data (same endpoint and same parameter <code>3</code>). They will share the same key in the cache.</p><p>In total, there will be three calls to the backend here, with parameters <code>1</code>, <code>2</code>, and <code>3</code>.</p><p>As long as at least one mounted React component calls the <code>osrdEditoastApi.endpoints.getProjectsByProjectId.useQuery</code> hook, for example, the data will be retained in the cache.</p><p>Once the last component is unmounted, the data is removed from the cache after 60 seconds (default value).</p><h3 id=translation>Translation</h3><p>Application translation is performed on <a href=https://explore.transifex.com/osrd/osrd/>Transifex</a>. The default language is French.
If you add a new translation key, it can be added directly to the code, in all available languages. Please note that if you need to correct a translation, we recommend that you use Transifex, to avoid any conflict.</p><h2 id=rules-and-important-elements>Rules and important elements</h2><h4 id=no-component-should-be-responsible-for-updating-the-data-it-uses>No component should be responsible for updating the data it uses</h4><p>Only <u>views</u> contain the store selectors, which are then given as props to the components of the module linked to the view.</p><h4 id=scss-is-not-scoped>SCSS is not scoped</h4><p>A <code>.scss</code> file buried in the tree structure doesn&rsquo;t guarantee that the classes it contains can only be accessed there, even by importing react (formally forbidden by the way: you must use SCSS import), all declared classes are accessible everywhere.</p><p>Prefer a judicious choice of root class name for a given module, and use the tree structure available in the SCSS file.</p><h4 id=imports-must-follow-a-specific-order>Imports must follow a specific order</h4><p>ESLint is setup to automatically sort imports in four import groups, each of them sorted in alphabetical order :</p><ul><li>React</li><li>External libraries</li><li>Internal absolute path files</li><li>Internal relative path files</li></ul><p>Each of these groups will be separated by an empty line.</p><p>ESLint will trigger a warning if you don&rsquo;t follow these guidelines.</p><h4 id=import-links-must-be-absolute>Import links must be absolute</h4><p>You must use the <u>full path</u> for all your imports.</p><blockquote><p>Import links can be relative only if the file to be imported is in the same directory.</p></blockquote><h2 id=typescript>TypeScript</h2><h3 id=import--export>import & export</h3><p>ESLint and Typescript are setup to enforce typed imports for an exported type.</p><p>This current setup allows to :</p><ul><li>Auto typing the import when using a type in a file with autocompletion.</li><li>Getting 2 errors from each package asking to use type import if you didn&rsquo;t.</li></ul><p>When an <code>import</code> or <code>export</code> contains only types, indicate it with the <code>type</code> keyword.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#204a87;font-weight:700>export</span> <span style=color:#204a87;font-weight:700>type</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#000>Direction</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>DirectionalTrackRange</span> <span style=color:#204a87;font-weight:700>as</span> <span style=color:#000>TrackRange</span> <span style=color:#000;font-weight:700>};</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#204a87;font-weight:700>type</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#000>typedEntries</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>ValueOf</span> <span style=color:#000;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>from</span> <span style=color:#4e9a06>&#34;utils/types&#34;</span><span style=color:#000;font-weight:700>;</span>
</span></span></code></pre></div><p>When an <code>import</code> contains not only types, it will be structured like below, in alphabetical order.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>osrdEditoastApi</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>type</span> <span style=color:#000>ScenarioCreateForm</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>from</span> <span style=color:#4e9a06>&#34;common/api/osrdEditoastApi&#34;</span><span style=color:#000;font-weight:700>;</span>
</span></span></code></pre></div><p>This allows to:</p><ul><li>Improve the performance and analysis process of the compiler and the linter.</li><li>Make these declarations more readable; we can clearly see what we are importing.</li><li>Avoid dependency cycles:</li></ul><p><img src=/images/docs/contribute/dependency-cycle.png alt="dependency cycle"></p><p>The error disappears with the <code>type</code> keyword</p><p><img src=/images/docs/contribute/dependency-cycle-gone.png alt="dependency cycle"></p><ul><li>Make final bundle lighter (all types disappear at compilation)</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-e860c4a45f93c7fb63441214882a9d83>4 - Write code</h1><div class=lead>Integrate changes into OSRD</div><ol><li><p>If you are not used to Git, <a href=https://learngitbranching.js.org/>follow this tutorial</a></p></li><li><p><strong>Create a branch</strong><br>If you intend to contribute regularly, you can request access to the <a href=https://github.com/osrd-project/osrd>main repository</a>. Otherwise, <a href=https://github.com/osrd-project/osrd/fork>create a fork</a>.</p></li><li><p><strong>Add changes to your branch</strong><br>Before you start working, try to split your work into macroscopic steps.
At the end of each stop, save your changes into a commit.
Try to make commits of logical and atomic units.
Try to follow <a href=../conventions/>style conventions</a>.</p></li><li><p><strong>Keep your branch up-to-date</strong></p><pre tabindex=0><code>git switch &lt;your_branch&gt;
git fetch
git rebase origin/dev
</code></pre></li></ol><p><em><a href=https://osrd.fr/en/docs/guides/contribute/contribute-code/commit-conventions/>Continue towards commit style ‣</a></em></p></div><div class=td-content style=page-break-before:always><h1 id=pg-e1c0c750b30e798f534acb8a5060da66>5 - Commit conventions</h1><div class=lead>A few advises and rules about commit messages</div><h2 id=commit-style>Commit style</h2><p>The overall format for git commits is as follows:</p><pre tabindex=0><code>component1, component2: imperative description of the change

Detailed or technical description of the change and what motivates it,
if it is not entirely obvious from the title.
</code></pre><ul><li><strong>the commit message, just like the code, must be in english</strong> (only ASCII characters for the title)</li><li>there can be multiple components separated by <code>:</code> in case of hierarchical relationships, with <code>,</code> otherwise</li><li>components are lower-case, using <code>-</code>, <code>_</code> or <code>.</code> if necessary</li><li>the imperative description of the change begins with a lower-case verb</li><li>the title must not contain any link (<code>#</code> is forbidden)</li></ul><p>Ideally:</p><ul><li>the title should be self-explanatory: no need to read anything else to understand it</li><li>the commit title is all lower-case</li><li>the title is clear to a reader not familiar with the code</li><li>the body of the commit contains a detailled description of the change</li></ul><div class="alert alert-info" role=alert>An automated check is performed to enforce as much as possible this formating.</div><h3 id=counter-examples-of-commit-titles>Counter-examples of commit titles</h3><p>To be avoided entirely:</p><ul><li><code>component: update ./some/file.ext</code>: specify the update itself rather than the file, the files
are technical elements welcome in the <em>body</em> of the commit</li><li><code>component: fix #42</code>: specify the problem fixed in the title, links (to issue, etc.) are very
welcome in commit&rsquo;s <em>body</em></li><li><code>wip</code>: describe the work (and finish it)</li></ul><p>Welcome to ease review, but do not merge:</p><ul><li><code>fixup! previous commit</code>: an <a href=../share-changes>autosquash</a> must be run before the merge</li><li><code>Revert "previous commit of the same PR"</code>: both commits must be dropped before merging</li></ul><h2 id=the-developer-certificate-of-origin-dco>The Developer Certificate of Origin (DCO)</h2><p>All of OSRD&rsquo;s projects use the DCO (Developer Certificate of Origin) to address
legal matters. The DCO helps confirm that you have the rights to the code you
contribute. For more on the history and purpose of the DCO, you can read <a href=https://bssw.io/blog_posts/the-developer-certificate-of-origin>The
Developer Certificate of Origin</a>
by Roscoe A. Bartlett.</p><p>To comply with the DCO, <strong>all commits must include a Signed-off-by line</strong>.</p><h3 id=how-to-sign-a-commit-using-git-in-a-shell->How to sign a commit using git in a shell ?</h3><p>To sign off a commit, simply add the <code>-s</code> flags to your <code>git commit</code> command,
like so:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>git commit -s -m <span style=color:#4e9a06>&#34;Your commit message&#34;</span>
</span></span></code></pre></div><p>This also applies when using the <code>git revert</code> command.</p><h3 id=how-to-do-sign-a-commit-using-git-in-visual-studio-code-vs-code->How to do sign a commit using git in Visual Studio Code (VS Code) ?</h3><p>Now, go in <code>Files</code> -> <code>Preferences</code> -> <code>Settings</code>, search for and activate
the <strong>Always Sign Off</strong> setting.</p><p>Finally, when you&rsquo;ll commit your changes via the VS Code interface, your commits
will automaticaly be signed-off.</p><p><em><a href=https://osrd.fr/en/docs/guides/contribute/contribute-code/share-changes/>Continue towards sharing your changes ‣</a></em></p></div><div class=td-content style=page-break-before:always><h1 id=pg-686cc94482965b0e45aee58c42de5752>6 - Share your changes</h1><div class=lead>How to submit your code modifications for review?</div><p>The author of a <em>pull request (PR)</em> is responsible for its &ldquo;life cycle&rdquo;. He is responsible for contacting the various parties involved, following the review, responding to comments and correcting the code following review (you could also check <a href=https://osrd.fr/en/docs/guides/contribute/code-review/>dedicated page about code review</a>).</p><blockquote><p>In the case of a large PR, don&rsquo;t hesitate to ask several reviewers to organize themselves, or even to carry out the review together, reviewers and author.</p></blockquote><ol><li><p><strong>Open a <em>pull request</em></strong><br>Once your changes are ready, you have to request integration with the <code>dev</code> branch.</p><p>If possible:</p><ul><li>Make PR of logical and atomic units too (avoid mixing refactoring, new features and bug fix at the same time).</li><li>Add a description to PRs to explain what they do and why.</li><li>Help the reviewer by following advice given in <a href=https://mtlynch.io/code-review-love/>mtlynch article</a>.</li><li>Add tags <code>area:&lt;affected_area></code> to show which part of the application have been impacted. It can be done through <a href=https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/proposing-changes-to-your-work-with-pull-requests/creating-a-pull-request>the web interface</a>.</li></ul></li><li><p><strong>Take feedback into account</strong><br>Once your PR is open, <a href=https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/reviewing-changes-in-pull-requests/about-pull-request-reviews>other contributors can review your changes</a>:</p><ul><li>Any user can review your changes.</li><li>Your code has to be approved by <a href=https://github.com/osrd-project/osrd/blob/dev/.github/CODEOWNERS>a contributor familiar with the code</a>.</li><li>All users are expected to take comments into account.</li><li>Comments tend to be written in an open and direct manner.
The intent is to efficiently collaborate towards a solution we all agree on.</li><li>Once all discussions are resolved, a maintainer integrates the change.</li></ul></li></ol><blockquote><p>For large PRs that are bound to evolve over time, keeping <em>corrections</em> during review in separate
<em>commits</em> helps reviewers. In the case of multiple reviews by the same person, this can save full
re-review (ask for help if necessary):</p><ul><li><em>Add fixup</em>, amend, squash or reword commits using the
<a href=https://git-scm.com/docs/git-commit#Documentation/git-commit.txt---fixupamendrewordltcommitgt>git commit documentation</a>.</li><li><em>Automatically merge corrections</em> into the original commits of your PR and check the result, using
<a href=https://git-scm.com/docs/git-rebase#Documentation/git-rebase.txt---autosquash><code>git rebase -i --autosquash origin/dev</code></a>
(just before the merge and once review process is complete).</li><li><em>Push your changes</em> with
<a href=https://git-scm.com/docs/git-push#Documentation/git-push.txt---no-force-with-lease><code>git push --force-with-lease</code></a>
because you are not just pushing new commits, you are pushing changes to existing commits.</li></ul></blockquote><ol start=3><li><strong>If you believe somebody forgot to review / merge your change, please speak out, multiple times if needs be.</strong></li></ol><h2 id=suggested-workflow>Suggested workflow</h2><p>Here&rsquo;s a suggested workflow.</p><p><strong>It can be useful to communicate via instant messaging (Matrix, Slack, etc.) in order to guarantee the smooth flow of PR validation.</strong></p><pre class=mermaid>sequenceDiagram
  actor A as PR author
  actor R as Reviewer/Maintainer
  
  A-&gt;&gt;R: Asks for a review, notifying some people
  R-&gt;&gt;A: Answers yes or no
  
  loop Loop between author and reviewer
    R--&gt;&gt;A: Comments, asks for changes
    A--&gt;&gt;R: Answers to comments or requested changes
    A--&gt;&gt;R: Makes necessary changes in dedicated &#34;fixups&#34;
    R--&gt;&gt;A: Reviews, tests changes, and comments again
    R--&gt;&gt;A: Resolves requested changes/conversations if ok
  end
 
  A-&gt;&gt;R: Rebase and apply fixups
  R-&gt;&gt;A: Checks commits history
  R-&gt;&gt;A: Approves or closes the PR
  Note left of R: &amp; Merges if maintainer</pre><p><em><a href=https://osrd.fr/en/docs/guides/contribute/contribute-code/tests/>Finally continue towards tests ‣</a></em></p></div><div class=td-content style=page-break-before:always><h1 id=pg-24dfcd6e0a300c88dde36000f0679f04>7 - Tests</h1><div class=lead>Recommandations for testing purpose</div><h2 id=back-end>Back-end</h2><ul><li>Integration tests are written with <a href=https://docs.pytest.org/>pytest</a> in the <code>/tests</code> folder.</li><li>Each route described in the <code>openapi.yaml</code> files must have an integration test.</li><li>The test must check both the format and content of valid and invalid responses.</li></ul><h2 id=front-end>Front-end</h2><p>The functional writing of the tests is carried out with the <em>Product Owners</em>, and the developers choose a technical implementation that precisely meets the needs expressed and fits in with the recommendations presented here.</p><p>We use <a href=https://playwright.dev/>Playwright</a> to write end-to-end tests, and <a href=https://vitest.dev/>vitest</a> to write unit tests.</p><p>The browsers tested are currently <a href=https://www.mozilla.org/fr/firefox/switch/>Firefox</a> and Chromium.</p><h3 id=basic-principles>Basic principles</h3><ul><li>Tests must be <strong>short</strong> (1min max) and go <strong>straight to the point</strong>.</li><li>Arbitrary timeouts are outlawed; a test must systematically wait for a specific event. It is possible to use <em>polling</em> (retry an action - a click for example - after a certain time) proposed in the <a href=https://playwright.dev/>Playwright&rsquo;s</a> API.</li><li>All tests must be parallelizable.</li><li>Tests must not point to or wait for text elements from the translation, prefer the <em>DOM</em> tree structure or place specific <code>id</code>.</li><li>We&rsquo;re not testing the data, but the application and its functionality. Data-specific tests should be developed in parallel.</li></ul><h4 id=data>Data</h4><p><strong>The data tested must be public data</strong>.
The data required (infrastructure and rolling stock) for the tests are offered in the application&rsquo;s <code>json</code> files, <em>injected</em> at the start of each test and deleted at the end, regardless of its result or how it is stopped, including with <code>CTRL+C</code>.</p><p>This is done by API calls in typescript before launching the actual test.</p><p>The data tested is the same, both locally and via continuous integration.</p><h4 id=atomicity-of-a-test>Atomicity of a test</h4><p>Each test must be <strong>atomic</strong>: it is self-sufficient and cannot be divided.</p><p>A test will target a single feature or component, provided it is not too large. A test will not test an entire module or application; it will necessarily be a set of tests, in order to preserve test atomicity.</p><p>If a test needs elements to be created or added, these operations must be carried out by API calls in typescript upstream of the test, as is done for adding data. These elements must be deleted at the end of the test, regardless of the result or how it is stopped, including by <code>CTRL+C</code>.</p><p>This allows tests to be parallelized.</p><p>However, in certain cases where it is relevant, a test may contain several clearly explained and justified test subdivisions (several <code>test()</code> in a single <code>describe()</code>).</p><h3 id=example-of-a-test>Example of a test</h3><p>The requirement: &ldquo;We want to test the addition of a train to a timetable&rdquo;.</p><ol><li>add the test infrastructure and rolling stock to the database <strong>by API calls</strong>.</li><li>create project, study and scenario with choice of test infrastructure <strong>by API calls</strong>.</li><li>start the test, clicking on &ldquo;add one or more trains&rdquo; until the presence of the trains in the timetable is verified</li><li>the test passes, fails or is stopped, the project, study and scenario are deleted, along with the test rolling stock and infrastructure <strong>by API calls</strong>.</li></ol><p><em>NB: the test will not test all the possibilities offered by the addition of trains; this should be a specific test which would test the response of the interface for all scenarios without adding trains.</em></p><p><em><a href=https://osrd.fr/en/docs/guides/contribute/contribute-code/write-code/>Continue towards write code ‣</a></em></p></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="col-6 col-sm-4 text-xs-center order-sm-2"></div><div class="col-6 col-sm-4 text-end text-xs-center order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=GitHub aria-label=GitHub><a target=_blank rel=noopener href=https://github.com/osrd-project/osrd aria-label=GitHub><i class="fab fa-github"></i></a></li></ul></div><div class="td-footer__copyright-etc col-12 col-sm-4 text-center py-2 order-sm-2"><span>&copy; 2024 OSRD contributors. All Rights Reserved</span></div></div></div></footer></div><style>.markmap>svg{width:100%;height:300px}</style><script>window.markmap={autoLoader:{manual:!0,onReady(){const{autoLoader:e,builtInPlugins:t}=window.markmap;e.transformPlugins=t.filter(e=>e.name!=="prism")}}}</script><script src=https://cdn.jsdelivr.net/npm/markmap-autoloader></script><script src=https://cdn.jsdelivr.net/npm/mermaid@9.3.0/dist/mermaid.min.js integrity="sha512-ku2nmBrzAXY5YwohzTqLYH1/lvyMrpTVxgQKrvTabd/b/uesqltLORdmpVapYv6QhZVCLUX6wkvFaKOAY4xpUA==" crossorigin=anonymous></script><script src=/js/main.min.4261519102c0270f3bdd4edcd2b45867ee7a584a0ea82c94f59e4f991c6337a1.js integrity="sha256-QmFRkQLAJw873U7c0rRYZ+56WEoOqCyU9Z5PmRxjN6E=" crossorigin=anonymous></script><script defer src=/js/click-to-copy.min.f724d3de49218995223b7316aa2e53e2b34bf42026bf399ebb21bb02212402d1.js integrity="sha256-9yTT3kkhiZUiO3MWqi5T4rNL9CAmvzmeuyG7AiEkAtE=" crossorigin=anonymous></script><script src=/js/tabpane-persist.js></script></body></html>